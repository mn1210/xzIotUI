webpackJsonp([27],{"+B0/":function(t,e){},"6h2F":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("3cXf"),a=s.n(i),n=s("lRwf"),r=s.n(n),u={data:function(){return{searchForm:{deviceType:"",areaId:"",runningStatus:"",healthState:""},projectList:[],typeList:[],areaList:[]}},methods:{getDtuListByImei:function(t,e){this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{imei:t},success:function(t){e(t.data.map(function(t){return{value:t.imei}}))}})},getEquipmentList:function(t,e){return this.$RequestUtil.post({url:"/device/equipment/getEquipmentList",params:{equName:t},success:function(t){e&&e(t.data.map(function(t){return{value:t.equName}}))}})},getProjectList:function(){var t=this;return this.$RequestUtil.post({url:"/device/project/getProjectList",params:{},success:function(e){t.projectList=e.data}})},getTypeList:function(){var t=this;return this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeList",params:{},success:function(e){t.typeList=e.data}})},getAreaList:function(){var t=this;return this.$RequestUtil.post({url:"/device/area/getAreaList",params:{},success:function(e){t.areaList=e.data}})}},mounted:function(){this.getProjectList(),this.getTypeList(),this.getAreaList()}},o=s("LlZA"),l={color:["#32b16c","#32b16c"],tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{type:"pie",radius:[37,43],hoverAnimation:!1,label:{normal:{show:!1}},data:[{value:125,name:"dtu在线数"},{value:109,name:"其它",itemStyle:{opacity:.1}}]}]},c={name:"homeIndex",mixins:[u],data:function(){return{searchForm:{dtuImei:"",projectId:"",equTypeId:"",areaId:"",runningState:"",healthState:"",projectList:[],equName:""},currentEqu:{},map:{},cluster:{},markers:[],selectedMarker:{},infoWindow:null,isShowUl:!1,dtus:[],equList:[],dtuStore:[],dtuTotal:0,dtuNormalCount:0,dtuAbnormalCount:0,dtuUnactiveCount:0,dtuBindingEquipmentCount:0,hasDtu:!1,dtu:{},dtuUl:{isShow:!1,searchContent:""},dtuDetailDialog:{isShow:!1,title:"DTU详情"},dtuList:[],equipmentList:[],styleSear:"style-sear1",btnBoxShow:!1,hidebtn:!1,showbtn:!0,searchclass:"",amapWrapper:"amap-wrapper",amapWrapper1:"amap-wrapper1",oldDevice:"",posNum:5e-5}},computed:{transEquNodeType:function(){return 4==this.currentEqu.equNodeType?"API设备":2==this.currentEqu.equNodeType?"非直连设备":"DTU"}},mounted:function(){var t=this,e=window.innerWidth>1366?937:625;window.innerHeight>e?(this.amapWrapper="amap-wrapper2",this.amapWrapper1="amap-wrapper3"):(this.amapWrapper="amap-wrapper",this.amapWrapper1="amap-wrapper1"),this.initAmap(),this.getDtuListByImei(),this.getEquipList(),window.addEventListener("resize",function(){window.innerHeight>e?(t.amapWrapper="amap-wrapper2",t.amapWrapper1="amap-wrapper3"):(t.amapWrapper="amap-wrapper",t.amapWrapper1="amap-wrapper1")})},methods:{show:function(){this.hidebtn=!0,this.showbtn=!1,this.btnBoxShow=!0,this.searchclass="serheightZ",this.styleSear="style-sear"},hide:function(){this.hidebtn=!1,this.showbtn=!0,this.btnBoxShow=!1,this.searchclass="serheightS",this.styleSear="style-sear1"},deviceDetail:function(t){this.$router.push({path:"/Device/DeviceList/DeviceDetails",query:{equId:t.equId}})},getDtuListByImei:function(){var t=this;this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{imei:""},success:function(e){t.dtuList=[],e.data.forEach(function(e){t.dtuList.push({value:e.imei})})}})},getEquipList:function(){var t=this;this.$RequestUtil.post({url:"/device/equipment/getEquipmentList",params:{equName:""},success:function(e){t.equipmentList=[],e.data.forEach(function(e){t.equipmentList.push({value:e.equName})})}})},getSelectEquipmentList:function(t,e){if(0!=this.equipmentList.length){var s=this.equipmentList.filter(function(e){return e.value.toUpperCase().indexOf(t.toUpperCase())>-1});e(this.$_.compact(s))}},getSelectDtuList:function(t,e){if(0!=this.dtuList.length){var s=this.dtuList.map(function(e){if(e.value.toUpperCase().indexOf(t.toUpperCase())>-1&&0==e.isEnable)return{value:e.value}});e(this.$_.compact(s))}},search:function(){var t=this;this.$RequestUtil.post({url:"/device/equipment/getEquipmentList",params:this.searchForm,success:function(e){if(t.currentEqu={},t.dtuUl.isShow=!1,t.equList=[],t.map.clearMap(),t.map.setZoomAndCenter(4,[106.632599,35.417384]),t.cluster.clearMarkers(),t.markers=[],0!==e.data.length){var s=e.data;null!=s&&s.length>0&&(t.hasDtu=!0,t.equList=s,t.equList.sort(function(t,e){return t.equLongitude-e.equLongitude}),t.dtuStore=JSON.parse(a()(s)),t.equList.forEach(function(e,s){null!=e.equLongitude&&null!=e.equLatitude&&t.addMarker(e)}))}}})},clear:function(){this.searchForm.projectId="",this.searchForm.dtuImei="",this.searchForm.equTypeId="",this.searchForm.areaId="",this.searchForm.runningState="",this.searchForm.healthState="",this.searchForm.equName=""},initAmap:function(){var t=this;o.lazyAMapApiLoaderInstance.load().then(function(){t.map=new AMap.Map("amapContainer",{features:["road","point","bg"],center:[106.632599,35.417384],zoom:4}),t.map.on("click",t.mapClickEvent);var e=t;e.cluster=new AMap.MarkerClusterer(e.map,e.markers,{gridSize:80,maxZoom:15,renderClusterMarker:e._renderCluserMarker}),t.search()})},_renderCluserMarker:function(t){var e=document.createElement("div");e.style.backgroundColor="rgba(18,100,200,0.8)";var s=30;s=String(t.count).length<4?30:String(t.count).length<6?50:70,e.style.width=e.style.height=s+"px",e.style.borderRadius=s/2+"px",e.style.boxShadow="0px 0px 0px 10px rgba(18,100,200,0.25)",e.innerHTML=t.count,e.style.lineHeight=s+"px",e.style.color="#fff",e.style.fontSize="14px",e.style.textAlign="center",t.marker.setOffset(new AMap.Pixel(-s/2,-s/2)),t.marker.setContent(e)},initEquList:function(){var t=this;this.$RequestUtil.post({url:"/device/equipment/getEquipmentList",params:this.searchForm,success:function(e){var s=e.data;null!=s&&s.length>0&&(t.equipmentList=[],t.hasDtu=!0,t.equList=s,t.dtuStore=JSON.parse(a()(s)),t.markers={},t.equList.forEach(function(e,s){null!=e.longitude&&null!=e.latitude&&t.addMarker(e)}))}})},initLeftEcharts:function(){var t=this,e=r.a.prototype.$echarts;this.$RequestUtil.post({url:"/test/dtuSummaryInformationByOrganization",params:{},success:function(s){t.dtuTotal=s.dtuTotal,t.dtuNormalCount=s.dtuNormalTotal,t.dtuAbnormalCount=s.abnormalTotal,t.dtuUnactiveCount=s.dtuNotActiveTotal,t.dtuBindingEquipmentCount=s.dtuBindingEquipmentTotal;var i=e.init(document.getElementById("dtuNormalCount"));l.color=["#32b16c","#32b16c"],l.series[0].data=[{value:t.dtuNormalCount,name:"dtu在线数"},{value:t.dtuTotal-t.dtuNormalCount,name:"其它",itemStyle:{opacity:.1}}],i.setOption(l),i=e.init(document.getElementById("dtuExceptionCount")),l.color=["#fa4843","#fa4843"],l.series[0].data=[{value:t.dtuAbnormalCount,name:"DTU异常数"},{value:t.dtuTotal-t.dtuAbnormalCount,name:"其它",itemStyle:{opacity:.1}}],i.setOption(l),i=e.init(document.getElementById("dtuUnactiveCount")),l.color=["#999999","#999999"],l.series[0].data=[{value:t.dtuUnactiveCount,name:"DTU未激活数"},{value:t.dtuTotal-t.dtuUnactiveCount,name:"其它",itemStyle:{opacity:.1}}],i.setOption(l)}})},addMarker:function(t){var e=t.runningState,s=t.healthState,i=document.createElement("div");1==s?i.setAttribute("class","dtu-marker-error"):1==e?i.setAttribute("class","dtu-marker-offline"):i.setAttribute("class","dtu-marker-online"),i.classList.add("dtu-marker");var a=document.createElement("div");a.setAttribute("class","dtuInfo"),a.textContent=t.equName,i.appendChild(a);var n=Number(t.equLongitude),r=Number(t.equLatitude);if(this.oldDevice!=t.equLongitude)this.oldDevice=t.equLongitude,this.posNum=5e-5;else{n+=Math.ceil(10*Math.random())>5?0-this.posNum:this.posNum,r+=Math.ceil(10*Math.random())>5?0-this.posNum:this.posNum,this.posNum=Math.abs(this.posNum)+5e-5}var u=new AMap.Marker({content:i,position:[n,r]});u.data=t,u.on("click",this.markerClickEvent),this.cluster.addMarker(u),this.markers[t.id]=u},markerClickEvent:function(t){var e=this,s=t.target.data;this.$RequestUtil.post({url:"/device/equipment/getEquipmentDetailById",params:{id:s.equId},success:function(t){e.currentEqu=t.data[0],e.dtuUl.isShow=!0}})},mapClickEvent:function(){null!=this.infoWindow&&this.infoWindow.getIsOpen()&&this.infoWindow.close()},getMarker:function(t){return this.markers[t]},setMapCenter:function(t,e){var s=new AMap.LngLat(t,e);this.map.setCenter(s)},openInfoWindow:function(t){var e=['<div class="dtu-infowindow-wrapper"><div class="dtu-detail-content"><span>编号：</span><span>'+t.code+'</span></div><div class="dtu-detail-wrapper" title="详情" id="dtuDetail"><i class="dtu-detail"></i></div></div>'];this.infoWindow=new AMap.InfoWindow({isCustom:!0,content:e.join("<br>"),offset:new AMap.Pixel(-5,-30)}),this.infoWindow.open(this.map,[t.lng,t.lat]);var s=document.getElementById("dtuDetail"),i=this;AMap.event.addDomListener(s,"click",function(){i.$router.push({path:"/Dtu/DtuList/DtuDetails",name:"DtuDetails",query:{id:t.id}})})},selectDtuLi:function(t){if(0===t.status)this.$message({type:"info",message:"该DTU尚未激活"});else{if(null!=t.lng&&null!=t.lat)return this.setMapCenter(t.lng,t.lat),void this.openInfoWindow(t);this.$message({type:"info",message:"该DTU未上报经纬度数据"})}null!=this.infoWindow&&this.infoWindow.getIsOpen()&&this.infoWindow.close()},formmatDtuCode:function(t){return t.length>=10?t.substr(0,10)+"...":t},toggleDtuUl:function(){this.dtuUl.isShow?this.dtuUl.isShow=!1:this.dtuUl.isShow=!0},searchDtuLikeCode:function(){var t=this.dtuUl.searchContent;if(""===t)this.dtus=this.dtuStore;else{var e=[];this.dtuStore.forEach(function(s,i){-1!==s.code.indexOf(t)&&e.push(s)}),this.dtus=e}0===this.dtus.length?this.hasDtu=!1:this.hasDtu=!0},getDtuStatusStyle:function(t){return"0"===t?"dtu-unactive":"1"===t?"dtu-normal":"dtu-error"},getDtuStatus:function(t){return"0"===t?"未激活":"1"===t?"在线":"异常"}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{position:"relative"},attrs:{id:"homeIndex"}},[s("div",{staticClass:"searchbar"},[s("el-row",{staticClass:"other-mian",class:t.searchclass},[s("el-row",{staticClass:"seheight1"},[s("div",{staticClass:"style-sear",class:["style-left"]},[t._v("设备名称：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-autocomplete",{staticClass:"form__input",attrs:{"fetch-suggestions":t.getSelectEquipmentList,placeholder:"请输入内容"},model:{value:t.searchForm.equName,callback:function(e){t.$set(t.searchForm,"equName",e)},expression:"searchForm.equName"}})],1),t._v(" "),s("div",{staticClass:"style-sear",class:["style-left1"]},[t._v("DTU IMEI：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-autocomplete",{staticClass:"form__input",attrs:{"fetch-suggestions":t.getSelectDtuList,placeholder:"请输入内容"},model:{value:t.searchForm.dtuImei,callback:function(e){t.$set(t.searchForm,"dtuImei",e)},expression:"searchForm.dtuImei"}})],1),t._v(" "),s("div",{staticClass:"style-sear",class:["style-left1"]},[t._v("项目：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-select",{staticClass:"form__input",model:{value:t.searchForm.projectId,callback:function(e){t.$set(t.searchForm,"projectId",e)},expression:"searchForm.projectId"}},[s("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(t.projectList,function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.projectName}})})],2)],1),t._v(" "),s("div",{staticClass:"ser-but"},[t.showbtn?s("div",{staticClass:"hideAndShow",on:{click:function(e){return t.show()}}},[t._v("展开"),s("i",{staticClass:"el-icon-arrow-down",staticStyle:{right:"-1px",color:"#5584bf !important"}})]):t._e(),t._v(" "),t.hidebtn?s("div",{staticClass:"hideAndShow",on:{click:function(e){return t.hide()}}},[t._v("收缩"),s("i",{staticClass:"el-icon-arrow-up",staticStyle:{right:"-1px",color:"#5584bf !important"}})]):t._e(),t._v(" "),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.search}},[t._v("查询")]),t._v(" "),s("el-button",{attrs:{size:"small"},on:{click:t.clear}},[t._v("清空")])],1)]),t._v(" "),t.btnBoxShow?s("el-row",{staticClass:"seheight2"},[s("div",{staticClass:"style-sear",class:["style-left"]},[t._v("设备品类：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-select",{staticClass:"form__input",model:{value:t.searchForm.equTypeId,callback:function(e){t.$set(t.searchForm,"equTypeId",e)},expression:"searchForm.equTypeId"}},[s("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(t.typeList,function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.typeName}})})],2)],1),t._v(" "),s("div",{staticClass:"style-sear",class:["style-left1"]},[t._v("区域：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-select",{staticClass:"form__input",model:{value:t.searchForm.areaId,callback:function(e){t.$set(t.searchForm,"areaId",e)},expression:"searchForm.areaId"}},[s("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(t.areaList,function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.areaName}})})],2)],1),t._v(" "),s("div",{staticClass:"style-sear",class:["style-left1"]},[t._v("运行状态：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-select",{staticClass:"form__input",model:{value:t.searchForm.runningState,callback:function(e){t.$set(t.searchForm,"runningState",e)},expression:"searchForm.runningState"}},[s("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),s("el-option",{attrs:{value:"0",label:"在线"}}),t._v(" "),s("el-option",{attrs:{value:"1",label:"离线"}})],1)],1)]):t._e(),t._v(" "),t.btnBoxShow?s("el-row",{staticClass:"seheight3"},[s("div",{staticClass:"style-sear",class:["style-left"]},[t._v("健康状态：")]),t._v(" "),s("div",{staticClass:"searchInput"},[s("el-select",{staticClass:"form__input",model:{value:t.searchForm.healthState,callback:function(e){t.$set(t.searchForm,"healthState",e)},expression:"searchForm.healthState"}},[s("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),s("el-option",{attrs:{value:"0",label:"正常"}}),t._v(" "),s("el-option",{attrs:{value:"1",label:"故障"}})],1)],1)]):t._e()],1)],1),t._v(" "),s("div",{staticClass:"statistics"},[s("div",{staticClass:"tjClassOne"},[s("div",{staticClass:"tjFont"},[t._v("在线数")]),t._v(" "),s("div",{staticClass:"tjImg"},[t._m(0),t._v(" "),s("div",{staticClass:"imgFont"},[t._v(t._s(t.equList.filter(function(t){return!t.runningState}).length))])])]),t._v(" "),s("div",{staticClass:"tjClassOne"},[s("div",{staticClass:"tjFont"},[t._v("离线数")]),t._v(" "),s("div",{staticClass:"tjImg"},[t._m(1),t._v(" "),s("div",{staticClass:"imgFont"},[t._v(t._s(t.equList.filter(function(t){return t.runningState}).length))])])]),t._v(" "),s("div",{staticClass:"tjClassOne"},[s("div",{staticClass:"tjFont"},[t._v("故障数")]),t._v(" "),s("div",{staticClass:"tjImg"},[t._m(2),t._v(" "),s("div",{staticClass:"imgFont"},[t._v(t._s(t.equList.filter(function(t){return t.healthState}).length))])])]),t._v(" "),s("div",{staticClass:"tjClassOne"},[s("div",{staticClass:"tjFont"},[t._v("设备总数")]),t._v(" "),s("div",{staticClass:"tjImg"},[t._m(3),t._v(" "),s("div",{staticClass:"imgFont"},[t._v(t._s(t.equList.length))])])])]),t._v(" "),s("div",{class:1==t.btnBoxShow?t.amapWrapper:t.amapWrapper1,attrs:{id:"amapContainer"}}),t._v(" "),s("div",{staticClass:"dtu-wrapper",class:1==t.btnBoxShow?"boxShow":""},[s("div",{staticClass:"dtu-toggleSign",on:{click:t.toggleDtuUl}},[s("i",{class:{"dtu-hide":!t.dtuUl.isShow}})]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.dtuUl.isShow,expression:"dtuUl.isShow"}],staticStyle:{width:"300px"}},[s("div",{staticClass:"dtu-list-content",class:1==t.btnBoxShow?"boxShow":""},[s("el-scrollbar",{staticStyle:{width:"100%",height:"100%"}},[s("div",{staticStyle:{"padding-left":"18px"}},[s("div",{staticClass:"infoLine"},[s("div",{staticClass:"infoTitle"},[t._v("设备信息")])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("设备编号：")]),t._v(" "),s("div",{staticClass:"link",on:{click:function(e){return t.deviceDetail(t.currentEqu)}}},[t._v(t._s(t.currentEqu.equCode))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("设备名称：")]),t._v(" "),s("div",{staticClass:"link",on:{click:function(e){return t.deviceDetail(t.currentEqu)}}},[t._v(t._s(t.currentEqu.equName))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("地址：")]),t._v(" "),s("div",[t._v(t._s(t.currentEqu.equAddress))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("品类：")]),t._v(" "),s("div",[t._v(t._s(t.currentEqu.typeName))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v(" 项目：")]),t._v(" "),s("div",[t._v(t._s(t.currentEqu.projectName))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("区域：")]),t._v(" "),s("div",[t._v(t._s(t.currentEqu.areaName))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("运行状态：")]),t._v(" "),s("div",{style:"在线"==t.currentEqu.runningStateName?"color:#29C55A":"color:#F73F3F"},[t._v(t._s(t.currentEqu.runningStateName))])]),t._v(" "),s("div",{staticClass:"infoLine"},[s("div",[t._v("健康状态：")]),t._v(" "),s("div",{style:"正常"==t.currentEqu.healthStateName?"color:#29C55A":"color:#F73F3F"},[t._v(t._s(t.currentEqu.healthStateName))])]),t._v(" "),1===t.currentEqu.equNodeType|3===t.currentEqu.equNodeType?s("div",{staticClass:"infoLine"},[s("div",[t._v(t._s("绑定的"+t.transEquNodeType)+"：")]),t._v(" "),s("div",[t._v(t._s(t.currentEqu.dtuImei))])]):t._e(),t._v(" "),2===t.currentEqu.equNodeType?s("div",{staticClass:"infoLine"},[s("div",[t._v(t._s("绑定的"+t.transEquNodeType)+"：")]),t._v(" "),s("div",[s("div",[t._v(t._s(t.currentEqu.nodeParentEquCode))])])]):t._e()])])],1)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"imgDiv"},[e("img",{staticClass:"img",attrs:{src:"/static/img/cirzc.png"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"imgDiv"},[e("img",{staticClass:"img",attrs:{src:"/static/img/cirlx.png"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"imgDiv"},[e("img",{staticClass:"img",attrs:{src:"/static/img/cirjg.png"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"imgDiv"},[e("img",{staticClass:"img",attrs:{src:"/static/img/dyaz.png"}})])}]};var p=s("C7Lr")(c,d,!1,function(t){s("+B0/"),s("ISOY")},"data-v-4f6e267b",null);e.default=p.exports},ISOY:function(t,e){}});