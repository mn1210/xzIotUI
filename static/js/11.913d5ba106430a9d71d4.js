webpackJsonp([11,21],{"/yE9":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("ZLEe"),r=a.n(i),s=a("3cXf"),o=a.n(s),l=a("HzJ8"),n=a.n(l),d=a("IHPB"),u=a.n(d),c=a("lC5x"),p=a.n(c),m=a("J0Oq"),h=a.n(m),f=a("gUGA"),v=a.n(f),g={name:"devicelist",components:{devDecting:a("Zz8z").default},data:function(){return{addrLoading:!1,loading:!1,addrOption:[],runningState:["在线","离线"],healthState:["正常","故障"],equPointDetail:[],currentRow:{},imageUrl:"",token:localStorage.getItem("token"),equInfo:{},detailModel_dialogVisible:!1,rawDataModel_dialogVisible:!1,bind_dialogVisible:!1,time:null,dtu_id:"",myAllTree:[],searchform:{equCode:"",equName:"",bindDtu:"",equManufacturers:"",runningStatus:"",healthState:"",projectId:"",areaId:"",deviceType:"",nodeType:""},queryParams:{equCode:"",equName:"",bindDtu:"",equManufacturers:"",runningStatus:"",healthState:"",projectId:"",areaId:"",deviceType:"",nodeType:"",orderColumn:"gmtModified",orderType:"DESC"},tableData:[],pagination:{currentPage:1,totalPage:0,pagesize:10},fileList:[],protocalList:{},projectList:[],areaList:[],modelList:[],modelDetail:"",rawData:[],addForm:{name:"",code:"",model:"",radius:"",deviceType:"",equManufacturers:"",addr:"",areaId:"",projectId:"",equType:"",typePrList:[],equPic:""},editForm:{id:"",radius:"",name:"",code:"",model:"",deviceType:"",equManufacturers:"",addr:"",areaId:"",projectId:"",equType:"",typePrList:[],equPic:"",dtuImei:""},bindForm:{dtuImei:""},rules:{code:[{required:!0,message:"请填入设备编号",trigger:"blur"},{validator:function(e,t,a){commonUtils.regExp.hasChinese(t)?a(new Error("不能输入汉字")):commonUtils.regExp.noSpecialChar(t)?a():a("不能有特殊字符")},trigger:"blur"}],name:[{required:!0,message:"请填入设备名称",trigger:"blur"},{validator:function(e,t,a){commonUtils.regExp.noSpecialChar(t.toString().trim())||a(new Error("不能有特殊字符")),a()},trigger:"blur"}],protocol:[{required:!0,message:"请选择协议",trigger:"blur"}],model:[{required:!0,message:"请选择设备模型",trigger:"change"}],radius:[{required:!1,validator:function(e,t,a){null!=t&&""!==t&&(/^-?\d+(\.\d+)?$/.test(t)||a(new Error("只能输入数值")),v()(t)<0&&a(new Error("输入数值不得小于0")),v()(t)>1e4&&a(new Error("输入数值不超过10000"))),a()},trigger:"blur"}],deviceType:[{required:!0,message:"请选择节点类型",trigger:"change"}],addr:[{required:!0,message:"请输入设备地址",trigger:"change"}],equManufacturers:[{required:!1,validator:function(e,t,a){void 0==t||commonUtils.regExp.noSpecialChar(t.toString().trim())||a(new Error("不能有特殊字符")),a()},trigger:"blur"}],equType:[{required:!0,message:"请选择设备品类",trigger:"blur"}]},multipleSelection:[],add_dialogVisible:!1,edit_dialogVisible:!1,attribute_dialogVisible:!1,modelMatchVisable:!1,styleSear:"style-sear1",btnBoxShow:!1,hidebtn:!1,showbtn:!0,searchclass:"",searchArr:[],forbiddenDtuList:[],choicedAddress:{},addrObj:{}}},computed:{dialogWidth:function(){return window.innerWidth<=1366?"55%":"50%"},formLabelWidth:function(){return window.innerWidth<=1366?"100px":"130px"},hasImei:function(){return function(e){var t=void 0;switch(e.isDeleted){case 0:case 5:t="";break;case 2:t="(绑定中)";break;case 3:t="(解绑中)";break;default:t=e.dtuImei?"":"未绑定"}return(4===e.equNodeType||4===e.parentNodeType&&2===e.equNodeType&&null!==e.nodeParent&&null===e.dtuImei)&&(t="已绑定"),t}},needDisabled:function(){return!!this.editForm.dtuImei}},beforeMount:function(){},mounted:function(){var e=h()(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searchArr=[{id:"1",label:"设备编号",value:"equCode",type:"input",maxLen:"50"},{id:"2",label:"设备名称",value:"equName",type:"input",maxLen:"50"},{id:"3",label:"绑定DTU",value:"bindDtu",type:"autoInput"},{id:"4",label:"节点类型",value:"nodeType",type:"select",data:[{value:"1",label:"PLC设备"},{value:"2",label:"非直连设备"},{value:"3",label:"直连设备"},{value:"4",label:"API设备"}]},{id:"5",label:"设备品类",value:"deviceType",type:"select",data:[]},{id:"6",label:"运行状态",value:"runningStatus",type:"select",data:[{value:"0",label:"在线"},{value:"1",label:"离线"}]},{id:"7",label:"健康状态",value:"healthState",type:"select",data:[{value:"0",label:"正常"},{value:"1",label:"故障"}]},{id:"8",label:"设备厂家",value:"equManufacturers",type:"input"},{id:"9",label:"区域",value:"areaId",type:"select",data:[]},{id:"10",label:"项目",value:"projectId",type:"select",data:[]}],this.search(),e.next=4,this.getModelList();case 4:return e.next=6,this.getProjectList();case 6:return e.next=8,this.getAreaList();case 8:this.searchArr[4].data=this.modelList,this.searchArr[8].data=this.areaList,this.searchArr[9].data=this.projectList,this.getForbiddenDtuList();case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),updated:function(){},beforeDestroy:function(){},methods:{getForbiddenDtuList:function(){var e=this;this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{imei:""},success:function(t){e.forbiddenDtuList=t.data.reduce(function(e,t){return 0==t.isEnable?[].concat(u()(e),[t.imei]):e},[])}})},sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},show:function(){this.hidebtn=!0,this.showbtn=!1,this.btnBoxShow=!0,this.searchclass="serheightZ",this.styleSear="style-sear"},hide:function(){this.hidebtn=!1,this.showbtn=!0,this.btnBoxShow=!1,this.searchclass="serheightS",this.styleSear="style-sear1"},beforeUpload:function(e){if(e.size>1048576)return this.$message.error("文件不能大于1M"),!1},nodeTypeFormate:function(e){switch(e.equNodeType){case 1:return"PLC设备";case 2:return"非直连设备";case 3:return"直连设备";case 4:return"API设备"}},handleAvatarSuccess:function(e,t){this.addForm.equPic=e.data.url,this.editForm.equPic=e.data.url,this.imageUrl=URL.createObjectURL(t.raw)},removeImg:function(){this.addForm.equPic="",this.editForm.equPic="",this.imageUrl=""},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},attrValid:function(e){switch(e){case"int":return[{pattern:"^[0-9]+$",message:"请输入整数",trigger:"blur"}];case"float":return[{pattern:"^[0-9]+(.[0-9]+)?$",message:"请输入数值",trigger:"blur"}];case"string":return[{message:"请输入",trigger:"blur"},{validator:function(e,t,a){void 0==t||commonUtils.regExp.noSpecialChar(t.toString().trim())||a(new Error("不能有特殊字符")),a()},trigger:"blur"}];case"boolean":return[{message:"请选择",trigger:"blur"}]}return[]},closeDetailModel:function(){this.modelDetail="",this.rawData=[],this.rawDataModel_dialogVisible=!1,clearInterval(this.time)},queryAddrAsync:function(e,t){var a=this;if(!e)return[];this.$method.amapPOI(e).then(function(e){a.addrOption=e.data.pois.map(function(e){return{value:e.name,location:e.location}}),t(a.addrOption)}).finally(function(){})},queryBindDtu:function(e,t){this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{imei:e},success:function(e){t(e.data.map(function(e){return{value:e.imei}}))}})},queryBindDtu2:function(e,t){this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{imei:e},success:function(e){var a=[];0!=e.data.length&&(a=e.data.reduce(function(e,t){return 1==t.isEnable?[].concat(u()(e),[{value:t.imei}]):e},[])),t(a)}})},getModelList:function(){var e=this;return this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.typeName,value:e.id,equipmentTypeContent:e.equipmentTypeContent})}),e.modelList=a}})},getProjectList:function(){var e=this;return this.$RequestUtil.post({url:"/device/project/getProjectList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.projectName,value:e.id})}),e.projectList=a}})},getAreaList:function(){var e=this;return this.$RequestUtil.post({url:"/device/area/getAreaList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.areaName,value:e.id})}),e.areaList=a}})},getEquipmentProperty:function(e){var t=this;return this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentPropertyList",params:{equId:e.equId},success:function(e){t.editForm.typePrList=e.data}})},formatterValue:function(e){return parseInt(e.value).toFixed(2)},opBindDialog:function(){if(0===this.multipleSelection.length)this.$message.warning("请先选择设备");else{var e=!0,t=!0,a=!1,i=void 0;try{for(var r,s=n()(this.multipleSelection);!(t=(r=s.next()).done);t=!0){var o=r.value;if(2===o.equNodeType){e=!1,this.$message.warning("非直连设备不能直接绑定DTU");break}if(this.forbiddenDtuList.includes(o.dtuImei)){e=!1,this.$message.warning("此DTU已禁用，无法执行此操作");break}if(2==o.isDeleted||3==o.isDeleted){e=!1;var l=2==o.isDeleted?"绑定中":"解绑中";this.$message.warning(l+"的设备无法绑定");break}}}catch(e){a=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw i}}e&&(this.bind_dialogVisible=!0)}},unBind:function(){var e=this;if(0===this.multipleSelection.length)this.$message.warning("请先选择设备");else{var t=!0,a=!0,i=!1,r=void 0;try{for(var s,o=n()(this.multipleSelection);!(a=(s=o.next()).done);a=!0){var l=s.value;if(2===l.equNodeType){t=!1,this.$message.warning("非直连设备不能直接解绑DTU");break}if(!l.dtuImei&&2!=l.isDeleted){t=!1,this.$message.warning("未绑定的设备无法解绑");break}if(2==l.isDeleted||3==l.isDeleted){t=!1;var d=2==l.isDeleted?"绑定中":"解绑中";this.$message.warning(d+"的设备无法解绑");break}if(this.forbiddenDtuList.includes(l.dtuImei)){t=!1,this.$message.warning("此DTU已禁用，无法执行此操作");break}}}catch(e){i=!0,r=e}finally{try{!a&&o.return&&o.return()}finally{if(i)throw r}}t&&this.$confirm("是否解绑?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$RequestUtil.post({url:"/device/dtu/dtuCancelBindEquipmentBatch",params:{bindingRecordList:e.multipleSelection.map(function(e){return{equId:e.equId,equNodeType:e.equNodeType}})},success:function(t){"warn"!=t.result?"success"==t.result&&(e.$eventBus.$emit("triggerMsg",t.data),e.$message({type:"success",message:t.msg}),e.refresh()):e.$message({type:"warning",message:t.msg})}})}).catch()}},edit_device:function(e){var t=this;return h()(p.a.mark(function a(){return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.currentRow=e,t.addrObj.address=e.equAddress,t.addrObj.longitude=e.equLongitude,t.addrObj.latitude=e.equLatitude,a.next=6,t.getEquipmentProperty(e);case 6:return t.editForm.name=e.equName,t.editForm.code=e.equCode,t.editForm.equId=e.equId,t.editForm.radius=e.equRadius,t.editForm.deviceType=e.equNodeType,t.editForm.addr=e.equAddress,t.editForm.equManufacturers=e.equManufacturers,t.editForm.projectId=e.equProjectId,t.editForm.areaId=e.equAreaId,t.imageUrl=e.equPic,t.editForm.equPic=e.equPic,t.editForm.dtuImei=e.dtuImei,t.editForm.equType=t.modelList.filter(function(t){return t.value===e.equTypeId})[0],a.next=21,t.modelList.forEach(function(e){if(e.value==t.editForm.equType.value){var a={};e.equipmentTypeContent.forEach(function(e){a[e.propertyName]=e.propertyRemarks}),t.editForm.typePrList=t.editForm.typePrList.map(function(e){return e.propertyRemarks=a[e.propertyName],e})}});case 21:t.edit_dialogVisible=!0,t.$nextTick(function(){t.$refs.editForm.clearValidate()});case 23:case"end":return a.stop()}},a,t)}))()},getProtocol:function(e){},editSub:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.$RequestUtil.postSync({url:"/device/equipment/updateEquipment",params:{id:t.editForm.equId,equCode:t.editForm.code,modelId:t.editForm.model,equTypeId:t.editForm.equType.value,nodeType:t.editForm.deviceType,radius:t.editForm.radius,equName:t.editForm.name,address:t.choicedAddress,equManufacturers:t.editForm.equManufacturers,areaId:t.editForm.areaId,projectId:t.editForm.projectId,typePrList:t.editForm.typePrList,equPic:t.editForm.equPic},type:"sync",success:function(e){"success"==e.result?(t.$message({type:"success",message:e.msg}),t.refresh(),t.edit_dialogVisible=!1):t.$message({type:"error",message:e.msg})}})})},closeBindDtu:function(){this.$refs.bindForm.resetFields(),this.bind_dialogVisible=!1},bindSub:function(){var e=this;this.$refs.bindForm.validate(function(t){t&&e.$RequestUtil.postSync({url:"/device/dtu/dtuBindEquipment",params:{isDeleted:0,bindingRecordList:e.multipleSelection.map(function(e){return{equId:e.equId,equNodeType:e.equNodeType,equName:e.equName}}),dtuImei:e.bindForm.dtuImei},success:function(t){"warn"!=t.result?"success"==t.result&&(e.$eventBus.$emit("triggerMsg",t.data),e.$message({type:"success",message:t.msg}),e.$refs.bindForm.resetFields(),e.refresh(),e.bind_dialogVisible=!1):e.$message({type:"warning",message:t.msg})}})})},selectDeviceType:function(e){this.addForm.typePrList=this.editForm.typePrList=JSON.parse(o()(e.equipmentTypeContent))},deviceDistinguish:function(e){this.$router.push({path:"/Dtu/DeviceList/DeviceDetecting",name:"DeviceDetecting",query:{id:e.id}})},searchPart:function(e){var t=this;this.pagination.currentPage=1,r()(e).forEach(function(a){t.queryParams[a]=e[a]}),this.search()},clearPart:function(e){var t=this;r()(e).forEach(function(a){t.queryParams[a]=e[a]})},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/equipment/getEquipmentListPage",params:{page:this.pagination.currentPage,rows:this.pagination.pagesize,equCode:this.queryParams.equCode.trim(),equName:this.queryParams.equName.trim(),equManufacturers:this.queryParams.equManufacturers.trim(),dtuImei:this.queryParams.bindDtu,equTypeId:this.queryParams.deviceType,runningState:this.queryParams.runningStatus,healthState:this.queryParams.healthState,projectId:this.queryParams.projectId,areaId:this.queryParams.areaId,nodeType:this.queryParams.nodeType,orderType:this.queryParams.orderType,orderColumn:this.queryParams.orderColumn},success:function(t){e.tableData=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1,e.$nextTick(function(){})}}).catch(function(){e.loading=!1})},refresh:function(){this.pagination.currentPage=1,this.queryParams.serialNum="",this.queryParams.equManufacturers="",this.choicedAddress={},this.editForm.addr="",this.search()},modelMatch:function(e){this.$router.push({path:"./DeviceList/DeviceDetecting",query:{id:e.id}})},protocolConfiguration:function(e){this.forbiddenDtuList.includes(e.dtuImei)?this.$message.warning("此DTU已禁用，无法执行此操作"):4===e.equNodeType?this.$router.push({path:"./DeviceList/DeviceApiConfig",query:{id:e.equId}}):this.$router.push({path:"./DeviceList/DeviceDetecting",query:{id:e.equId}})},deviceDetail:function(e){this.$router.push({path:"/Device/DeviceList/DeviceDetails",query:{equId:e.equId}})},queryData:function(e){var t=this;return h()(p.a.mark(function a(){var i;return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=t,t.currentRow=e,i.rawDataModel_dialogVisible=!0,i.$RequestUtil.post({url:"/device/equipmentRealtime/getEquipmentRealtimeList",params:{equId:e.equId},success:function(e){0!=e.data.length&&(t.currentRow.realtime=e.data[0].eventTime,i.rawData=JSON.parse(e.data[0].realtimePayload))}});case 4:case"end":return a.stop()}},a,t)}))()},getExportTemplate:function(){document.getElementById("ifile").src="/device/equipment/exportEquipmentTemplate?token="+localStorage.getItem("token")},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],e.forEach(function(e){t.multipleSelection.push(e)})},del:function(e){var t=this;e.dtuImei?this.$confirm("请先解绑DTU！","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"}):this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$RequestUtil.post({url:"/device/equipment/deleteEquipment",params:{id:e.equId},success:function(e){t.pagination.currentPage=1,t.search(),"success"==e.result?t.$message({type:"success",message:e.msg}):t.$message({type:"error",message:e.msg})}})}).catch(function(){})},edit_handleClose:function(e){this.resetEditFields(),e()},handleClose:function(e){this.resetAddFields(),e()},resetAddFields:function(){var e=this;this.addForm.code="",this.addForm.protocol=[],this.addForm.model="",this.addForm.radius="",this.addForm.name="",this.addForm.addr="",this.addForm.deviceType="",this.addForm.equManufacturers="",this.addForm.projectId="",this.addForm.areaId="",this.addForm.areaId="",this.addForm.equType="",this.addForm.equPic="",this.addForm.typePrList=this.editForm.typePrList=[],this.imageUrl="",this.$nextTick(function(){e.$refs.addForm.clearValidate()})},resetEditFields:function(){var e=this;this.editForm.code="",this.editForm.protocol=[],this.editForm.model="",this.editForm.radius="",this.editForm.name="",this.editForm.addr="",this.editForm.equPic="",this.imageUrl="",this.$nextTick(function(){e.$refs.editForm&&e.$refs.editForm.clearValidate()})},sureAdd:function(){var e=this;this.$refs.addForm.validate(function(t){t&&e.$RequestUtil.postSync({url:"/device/equipment/addEquipment",params:{equCode:e.addForm.code,modelId:e.addForm.model,equTypeId:e.addForm.equType.value,nodeType:e.addForm.deviceType,radius:e.addForm.radius,equName:e.addForm.name,address:e.choicedAddress,equManufacturers:e.addForm.equManufacturers,areaId:e.addForm.areaId,projectId:e.addForm.projectId,typePrList:e.addForm.typePrList,equPic:e.editForm.equPic},type:"sync",success:function(t){if("success"===t.result){e.$message({type:"success",message:t.msg}),e.resetAddFields();e.add_dialogVisible=!1,e.refresh()}else"fail"===t.result&&e.$message({type:"error",message:t.msg})}})})},checkTree:function(e,t){for(var a in t)e.push({id:t[a].id,pid:t[a].pId}),null!=t[a].children&&t[a].children.length>0&&this.checkTree(e,t[a].children)},getProtocalInfo:function(e){var t=0;for(var a in this.myAllTree)if(e==this.myAllTree[a].id){t=this.myAllTree[a].pid;break}this.editForm.protocol.unshift(e),this.getParentId(this.editForm.protocol,t)},getParentId:function(e,t){for(var a in this.myAllTree){if(1===t)return;if(t===this.myAllTree[a].id){e.unshift(this.myAllTree[a].id),this.getParentId(e,this.myAllTree[a].pid);break}}}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window"},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{"search-arr":e.searchArr},on:{clear:function(t){e.clearPart(t)},search:function(t){e.searchPart(t)},querySelect:function(t){var a=t.queryString,i=t.cb;e.queryBindDtu(a,i)}}})],1),e._v(" "),e.$PERMISSION.EQUIPMENT_WRITE?a("div",{staticClass:"operatebar"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(){return e.add_dialogVisible=!0}}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.opBindDialog}},[e._v("绑定DTU")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.unBind}},[e._v("解绑DTU")])],1):e._e(),e._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-sort":{prop:e.queryParams.orderColumn,order:"descending"},"header-row-class-name":"table-header-color"},on:{"sort-change":e.sortChangeEvent,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",selectable:function(e){return![2,4].includes(e.equNodeType)},width:"45"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"140","show-overflow-tooltip":"",prop:"equCode",label:"设备编号",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"140","show-overflow-tooltip":"",prop:"equName",label:"设备名称",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"150",prop:"dtuImei","show-overflow-tooltip":"",label:"绑定DTU",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{type:"text",size:"mini"}},[e._v(e._s(t.row.dtuImei&&4!==t.row.equNodeType?t.row.dtuImei:"")+"\n            "),a("span",{class:2==t.row.isDeleted?"colorGreen":3==t.row.isDeleted?"colorRed":""},[e._v(e._s(e.hasImei(t.row)))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",prop:"runningState",label:"运行状态",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:0===t.row.runningState?"colorGreen":"colorRed",attrs:{type:"text",size:"mini"}},[e._v(e._s(null===t.row.runningState?"":e.runningState[t.row.runningState]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100",prop:"healthState","show-overflow-tooltip":"",label:"健康状态",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:1===t.row.healthState?"colorRed":"colorGreen",attrs:{type:"text",size:"mini"}},[e._v(e._s(null===t.row.healthState?"":e.healthState[t.row.healthState]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",prop:"equNodeType",formatter:e.nodeTypeFormate,label:"节点类型",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"80","show-overflow-tooltip":"",prop:"areaName",label:"区域",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120","show-overflow-tooltip":"",prop:"projectName",label:"项目",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",prop:"typeName",label:"设备品类",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:2===t.row.equNodeType||!t.row.dtuImei&&4!==t.row.equNodeType,type:"text",size:"mini"},on:{click:function(a){return e.protocolConfiguration(t.row)}}},[e._v("协议点位配置")]),e._v(" "),a("span",{staticClass:"vertical"}),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deviceDetail(t.row)}}},[e._v("详情")]),e._v(" "),e.$PERMISSION.EQUIPMENT_WRITE?a("span",[a("span",{staticClass:"vertical"}),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.edit_device(t.row)}}},[e._v("编辑")])],1):e._e(),e._v(" "),a("span",{staticClass:"vertical"}),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.queryData(t.row)}}},[e._v("查看设备数据")]),e._v(" "),e.$PERMISSION.EQUIPMENT_WRITE?a("span",{staticClass:"vertical"}):e._e(),e._v(" "),e.$PERMISSION.EQUIPMENT_WRITE?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.del(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"新增设备",visible:e.add_dialogVisible,width:e.dialogWidth,"before-close":e.handleClose},on:{"update:visible":function(t){e.add_dialogVisible=t}}},[a("el-form",{ref:"addForm",staticStyle:{display:"flex"},attrs:{model:e.addForm,rules:e.rules,"label-width":e.formLabelWidth}},[a("div",{staticClass:"basicData"},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备编号：",prop:"code"}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:"50",placeholder:"请输入设备编号"},model:{value:e.addForm.code,callback:function(t){e.$set(e.addForm,"code",t)},expression:"addForm.code"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备名称：",prop:"name"}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:"50",placeholder:"请输入设备名称"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name","string"==typeof t?t.trim():t)},expression:"addForm.name"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"节点类型：",prop:"deviceType"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请选择节点类型"},model:{value:e.addForm.deviceType,callback:function(t){e.$set(e.addForm,"deviceType",t)},expression:"addForm.deviceType"}},[a("el-option",{attrs:{value:1,label:"PLC设备"}}),e._v(" "),a("el-option",{attrs:{value:2,label:"非直连设备"}}),e._v(" "),a("el-option",{attrs:{value:3,label:"直连设备"}}),e._v(" "),a("el-option",{attrs:{value:4,label:"API设备"}})],1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"活动半径（米）：",maxlength:10,prop:"radius"}},[a("el-input",{staticClass:"form__input",attrs:{placeholder:"请输入活动半径(米)"},model:{value:e.addForm.radius,callback:function(t){e.$set(e.addForm,"radius","string"==typeof t?t.trim():t)},expression:"addForm.radius"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备地址：",prop:"addr"}},[a("addressChoice",{attrs:{model:e.addForm.addr,"ori-addr":e.choicedAddress,"row-class":"form__input"},on:{"update:model":function(t){return e.$set(e.addForm,"addr",t)},"update:oriAddr":function(t){e.choicedAddress=t},"update:ori-addr":function(t){e.choicedAddress=t}}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备厂家：",prop:"equManufacturers"}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:"255",placeholder:"请输入设备厂家"},model:{value:e.addForm.equManufacturers,callback:function(t){e.$set(e.addForm,"equManufacturers","string"==typeof t?t.trim():t)},expression:"addForm.equManufacturers"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{rules:[{required:!0,message:"请选择区域"}],label:"区域：",prop:"areaId"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请选择区域"},model:{value:e.addForm.areaId,callback:function(t){e.$set(e.addForm,"areaId",t)},expression:"addForm.areaId"}},e._l(e.areaList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{rules:[{required:!0,message:"请选择项目"}],label:"项目：",prop:"projectId"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请选择项目"},model:{value:e.addForm.projectId,callback:function(t){e.$set(e.addForm,"projectId",t)},expression:"addForm.projectId"}},e._l(e.projectList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备品类：",prop:"equType"}},[a("el-select",{staticClass:"form__input",attrs:{"value-key":"value",placeholder:"请选择设备品类"},on:{change:e.selectDeviceType},model:{value:e.addForm.equType,callback:function(t){e.$set(e.addForm,"equType",t)},expression:"addForm.equType"}},e._l(e.modelList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"uploadDiv"},[a("el-upload",{staticClass:"uploader",attrs:{accept:".png, .jpg, .bmp, .gif","show-file-list":!1,action:"wuyuan/upload/uploadPicture","before-upload":e.beforeUpload,data:{pictureType:"organization"},"on-success":e.handleAvatarSuccess,headers:{Authorization:"Bearer "+e.token}}},[a("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("上传图片")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("不超过1M")])],1),e._v(" "),a("div",{staticClass:"img el-upload-list--picture-card "},[e.imageUrl?a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.imageUrl,alt:""}}):e._e(),e._v(" "),e.imageUrl?a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-delete",on:{click:e.removeImg}},[a("i",{staticClass:"el-icon-delete"})])]):e._e()]),e._v(" "),a("span",{staticStyle:{"font-weight":"600"}},[e._v("品类详情")]),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),e.addForm.typePrList?a("el-scrollbar",{staticClass:"vertical-scrollbar",staticStyle:{height:"200px"}},e._l(e.addForm.typePrList,function(t,i){return a("el-form-item",{key:t.id,attrs:{rules:e.attrValid(t.propertyType),"label-width":"90px",prop:"typePrList["+i+"].propertyValue",label:t.propertyName+"："}},[a("div",{staticClass:"flexBox"},["boolean"!==t.propertyType?a("el-input",{staticStyle:{width:"90px"},attrs:{maxlength:"50"},model:{value:e.addForm.typePrList[i].propertyValue,callback:function(t){e.$set(e.addForm.typePrList[i],"propertyValue",t)},expression:"addForm.typePrList[index].propertyValue"}}):a("el-select",{staticStyle:{width:"90px"},model:{value:e.addForm.typePrList[i].propertyValue,callback:function(t){e.$set(e.addForm.typePrList[i],"propertyValue",t)},expression:"addForm.typePrList[index].propertyValue"}},[a("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),a("el-option",{attrs:{value:"false",label:"否"}})],1),e._v(" "),a("div",{staticClass:"modelTypeRemarks flexBox"},[a("span",[e._v("备注：")]),e._v(" "),a("textareaCheckRows",{staticStyle:{width:"65%"},attrs:{ellipsis:!1,"input-type":"pre","text-value":e.addForm.typePrList[i].propertyRemarks}})],1)],1)])}),1):e._e()],1)]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.sureAdd}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑设备","close-on-click-modal":!1,visible:e.edit_dialogVisible,width:e.dialogWidth,"before-close":e.edit_handleClose},on:{"update:visible":function(t){e.edit_dialogVisible=t}}},[a("el-form",{ref:"editForm",staticStyle:{display:"flex"},attrs:{model:e.editForm,rules:e.rules,"label-width":e.formLabelWidth,"label-position":"left"}},[a("div",{staticClass:"basicData"},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备编号：",prop:"code"}},[a("el-input",{staticClass:"form__input",attrs:{disabled:"",maxlength:"50",placeholder:"请输入设备编号"},model:{value:e.editForm.code,callback:function(t){e.$set(e.editForm,"code",t)},expression:"editForm.code"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备名称：",prop:"name"}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:"50",placeholder:"请输入设备名称"},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name","string"==typeof t?t.trim():t)},expression:"editForm.name"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"节点类型：",prop:"deviceType"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请选择节点类型",disabled:e.needDisabled},model:{value:e.editForm.deviceType,callback:function(t){e.$set(e.editForm,"deviceType",t)},expression:"editForm.deviceType"}},[a("el-option",{attrs:{value:1,label:"PLC设备"}}),e._v(" "),a("el-option",{attrs:{value:2,label:"非直连设备"}}),e._v(" "),a("el-option",{attrs:{value:3,label:"直连设备"}}),e._v(" "),a("el-option",{attrs:{value:4,label:"API设备"}})],1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"活动半径（米）：",prop:"radius"}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:10,placeholder:"请输入活动半径(米)"},model:{value:e.editForm.radius,callback:function(t){e.$set(e.editForm,"radius","string"==typeof t?t.trim():t)},expression:"editForm.radius"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备地址：",prop:"addr"}},[a("addressChoice",{attrs:{"ori-data":e.addrObj,model:e.editForm.addr,"ori-addr":e.choicedAddress,"row-class":"form__input"},on:{"update:model":function(t){return e.$set(e.editForm,"addr",t)},"update:oriAddr":function(t){e.choicedAddress=t},"update:ori-addr":function(t){e.choicedAddress=t}}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备厂家：",prop:"equManufacturers"}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:"255",placeholder:"请输入设备厂家"},model:{value:e.editForm.equManufacturers,callback:function(t){e.$set(e.editForm,"equManufacturers","string"==typeof t?t.trim():t)},expression:"editForm.equManufacturers"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{required:"",label:"区域：",prop:"areaId"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请输入区域"},model:{value:e.editForm.areaId,callback:function(t){e.$set(e.editForm,"areaId",t)},expression:"editForm.areaId"}},e._l(e.areaList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{required:"",label:"项目：",prop:"projectId"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请输入项目"},model:{value:e.editForm.projectId,callback:function(t){e.$set(e.editForm,"projectId",t)},expression:"editForm.projectId"}},e._l(e.projectList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备品类：",prop:"equType"}},[a("el-select",{staticClass:"form__input",attrs:{"value-key":"value",placeholder:"请选择设备品类"},on:{change:e.selectDeviceType},model:{value:e.editForm.equType,callback:function(t){e.$set(e.editForm,"equType",t)},expression:"editForm.equType"}},e._l(e.modelList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"uploadDiv"},[a("el-upload",{staticClass:"uploader",attrs:{"show-file-list":!1,accept:".png, .jpg, .bmp, .gif",action:"wuyuan/upload/uploadPicture","before-upload":e.beforeUpload,data:{pictureType:"organization"},"on-success":e.handleAvatarSuccess,headers:{Authorization:"Bearer "+e.token}}},[a("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("上传图片")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("不超过1M")])],1),e._v(" "),a("div",{staticClass:"img el-upload-list--picture-card "},[e.imageUrl?a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.imageUrl,alt:""}}):e._e(),e._v(" "),e.imageUrl?a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-delete",on:{click:e.removeImg}},[a("i",{staticClass:"el-icon-delete"})])]):e._e()]),e._v(" "),a("span",{staticStyle:{"font-weight":"600"}},[e._v("品类详情")]),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),e.editForm.typePrList?a("el-scrollbar",{staticClass:"vertical-scrollbar",staticStyle:{height:"200px"}},e._l(e.editForm.typePrList,function(t,i){return a("el-form-item",{key:t.id,attrs:{rules:e.attrValid(t.propertyType),"label-width":"80px",prop:"typePrList["+i+"].propertyValue",label:t.propertyName+"："}},[a("div",{staticClass:"flexBox"},["boolean"!==t.propertyType?a("el-input",{staticStyle:{width:"100px"},attrs:{maxlength:"50"},model:{value:e.editForm.typePrList[i].propertyValue,callback:function(t){e.$set(e.editForm.typePrList[i],"propertyValue",t)},expression:"editForm.typePrList[index].propertyValue"}}):a("el-select",{staticStyle:{width:"100px"},model:{value:e.editForm.typePrList[i].propertyValue,callback:function(t){e.$set(e.editForm.typePrList[i],"propertyValue",t)},expression:"editForm.typePrList[index].propertyValue"}},[a("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),a("el-option",{attrs:{value:"false",label:"否"}})],1),e._v(" "),a("div",{staticClass:"modelTypeRemarks flexBox"},[a("span",[e._v("备注：")]),e._v(" "),a("textareaCheckRows",{staticStyle:{width:"65%"},attrs:{ellipsis:!1,"input-type":"pre","text-value":e.editForm.typePrList[i].propertyRemarks}})],1)],1)])}),1):e._e()],1)]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editSub("editForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"绑定DTU","close-on-click-modal":!1,visible:e.bind_dialogVisible,width:"500px","before-close":e.edit_handleClose},on:{"update:visible":function(t){e.bind_dialogVisible=t},close:e.closeBindDtu}},[a("el-form",{ref:"bindForm",attrs:{model:e.bindForm,"label-width":"110px"}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"选择DTU：",rules:[{required:!0,message:"请选择DTU"}],prop:"dtuImei"}},[a("el-autocomplete",{staticClass:"form__input",attrs:{"fetch-suggestions":e.queryBindDtu2,placeholder:"请选择要绑定的DTU"},model:{value:e.bindForm.dtuImei,callback:function(t){e.$set(e.bindForm,"dtuImei",t)},expression:"bindForm.dtuImei"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.bindSub()}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"设备数据",visible:e.rawDataModel_dialogVisible,width:"900px"},on:{"update:visible":function(t){e.rawDataModel_dialogVisible=t},close:e.closeDetailModel}},[a("el-row",{staticClass:"info",attrs:{type:"flex"}},[a("el-col",{staticClass:"label",attrs:{span:3}},[e._v("设备编号：")]),e._v(" "),a("el-col",{staticClass:"value",attrs:{span:5}},[e._v(e._s(e.currentRow.equCode))]),e._v(" "),a("el-col",{staticClass:"label",attrs:{span:3}},[e._v("设备名称：")]),e._v(" "),a("el-col",{staticClass:"value",attrs:{span:5}},[e._v(e._s(e.currentRow.equName))]),e._v(" "),a("el-col",{staticClass:"label",attrs:{span:3}},[e._v("更新时间：")]),e._v(" "),a("el-col",{staticClass:"value",attrs:{span:5}},[e._v(e._s(e._f("UTC+8")(e.currentRow.realtime)))])],1),e._v(" "),a("br"),e._v(" "),a("el-row",{staticClass:"info",attrs:{type:"flex"}},[a("el-col",{staticClass:"label",attrs:{span:3}},[e._v("运行状态：")]),e._v(" "),a("el-col",{staticClass:"value",style:{color:0===e.currentRow.runningState?"rgb(41, 197, 90)":"red"},attrs:{span:5}},[e._v(e._s(e.runningState[e.currentRow.runningState]))]),e._v(" "),a("el-col",{staticClass:"label",attrs:{span:3}},[e._v("健康状态：")]),e._v(" "),a("el-col",{staticClass:"value",style:{color:1===e.currentRow.healthState?"red":"rgb(41, 197, 90)"},attrs:{span:5}},[e._v(e._s(e.healthState[e.currentRow.healthState]))]),e._v(" "),a("el-col",{staticClass:"label",attrs:{span:3}},[e._v("地址：")]),e._v(" "),a("el-col",{staticClass:"value",attrs:{span:5}},[e._v(e._s(e.currentRow.equAddress))])],1),e._v(" "),a("br"),e._v(" "),a("div",{staticClass:"business-css"},[e._v("业务数据：")]),e._v(" "),a("el-table",{staticClass:"businessTable",attrs:{data:e.rawData}},[a("el-table-column",{attrs:{prop:"businessMeaning",label:"业务涵义"}}),e._v(" "),a("el-table-column",{attrs:{formatter:function(e){return e.value+(e.unit?e.unit:"")},label:"值"}})],1)],1)],1)},staticRenderFns:[]};var y=a("C7Lr")(g,b,!1,function(e){a("2Nn4"),a("q5BV")},"data-v-97057322",null);t.default=y.exports},"2Nn4":function(e,t){},CPWA:function(e,t){},Zz8z:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("3cXf"),r=a.n(i),s=a("IHPB"),o=a.n(s),l=a("ZLEe"),n=a.n(l),d=a("lC5x"),u=a.n(d),c=a("J0Oq"),p=a.n(c),m={name:"ipaddress-input",props:{value:{type:String,default:"0.0.0.0"}},data:function(){return{ipaddressInput:[{value:"0"},{value:"0"},{value:"0"},{value:"0"}]}},watch:{value:function(e){this.ipaddressInput=e.split(".").map(function(e){return{value:e}})}},methods:{checkIpVal:function(e,t){var a=this,i=t.target.value;i=i?i.trim():i,i=parseInt(i,10),i=isNaN(i)?0:(i=i<0?0:i)>255?255:i,this.ipaddressInput[e].value=i,this.$nextTick(function(e){a.$emit("input",a.getIpAddress())})},getIpAddress:function(){for(var e=this.$refs.ipInput,t="",a=0;a<e.length;a++)0!=a&&(t+="."),t+=e[a].value;return t}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{display:"flex",width:"240px"}},e._l(e.ipaddressInput,function(t,i){return a("div",{key:i,staticStyle:{display:"flex",width:"60px"}},[a("el-input",{ref:"ipInput",refInFor:!0,attrs:{size:"mini"},nativeOn:{input:function(t){return e.checkIpVal(i,t)}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}}),e._v(" "),3!=i?a("div",[e._v("-")]):e._e()],1)}),0)])},staticRenderFns:[]};var f=a("C7Lr")(m,h,!1,function(e){a("p5jz")},"data-v-7042ac3d",null).exports,v=a("E4hq"),g=a("XZht"),b={name:"devicelist",components:{IPAddressInput:f,pointConf:v.a},data:function(){return{watchNum:0,hasChange:!1,equInfo:{},equData:[],pointData:[],pointDetailData:[],protocolDialog:{isShow:!1,devices:null,configDialog:{isShow:!0,stepActive:0,ptlId:null},btns:{preBtn:{isShow:!1},nextBtn:{name:"下一步"}}},templateStyles:[{id:1,prop:"address",label:"地址"},{id:2,prop:"length",label:"长度"},{id:3,prop:"equSubId",label:"数据来源于",width:160},{id:4,prop:"dataId",label:"数据ID",width:170},{id:5,prop:"uploadStatus",label:"上传状态",width:140},{id:6,prop:"type",label:"数据类型",width:160},{id:7,prop:"bigEndian",label:"大端模式"},{id:8,prop:"bit",label:"Bit位"}],apiTemplateStyles:[{id:1,prop:"requestParams",label:"请求参数"},{id:2,prop:"requestParamsValue",label:"请求参数值",width:160},{id:3,prop:"responseParams",label:"返回参数",width:170},{id:4,prop:"equSubId",label:"数据来源于",width:160},{id:5,prop:"dataId",label:"数据ID",width:170}],editRules:{ipAddress:[{required:!0,message:"ip地址不能为空"},{validator:function(e,t,a){"0.0.0.0"==t||"1.1.1.1"==t?a("请填写正确的ip地址"):a()}}],protocol:[{required:!0,message:"请选择"},{validator:function(e,t,a){0!=t.length&&t[0]?a():a("请选择")}}],portNumber:[{required:!0,message:"不能为空"},{validator:function(e,t,a){commonUtils.regExp.portReg(t)&&0!==t?a():a("请输入正确的端口号")},trigger:"blur"}],frequency:[{required:!0,type:"number",message:"请输入正确的上传频率",trigger:"blur"},{validator:function(e,t,a){t<0?a("上传频率不能为负数"):a()},trigger:"blur"}]},configForm:{rules:{},configName:"",configInfo:"",pointConf:{},ip:"",port:"",deviceId:null,deviceCode:"",protocolId:null,protocolName:"",protocolFileName:"",templateUrl:"",templateType:""},loading:!1,dtu_id:"",myAllTree:[],token:{token:localStorage.getItem("token")},searchform:{serialnum:"",bindDtu:"",equManufacturers:"",runningStatus:"",deviceType:"",pointId:""},queryParams:{serialNum:"",equManufacturers:""},dialogTableData:{},pagination:{currentPage:1,totalPage:0},fileList:[],protocalList:{},editForm:{name:"",code:"",model:"",protocol:[],radius:"",deviceType:"",frequency:"",frequencyUnit:"second",addr:"",ipAddress:"0.0.0.0",portNumber:""},rules:{code:[{required:!0,message:"请填入设备编号",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"},{validator:function(e,t,a){/[\u4e00-\u9fa5]/.test(t)?a(new Error("不能输入汉字")):a()},trigger:"blur"}],protocol:[{required:!0,message:"请选择协议",trigger:"blur"}],model:[{required:!0,message:"请选择设备模型",trigger:"change"}],radius:[{required:!0,validator:function(e,t,a){/^\d{1,4}(\.\d+)?$/.test(t.toString().trim())||a(new Error("请输入不超过10000的数值")),a()},trigger:"blur"}],deviceType:[{required:!0,message:"请选择设备类型",trigger:"change"}],addr:[{required:!0,message:"请输入设备地址",trigger:"blur"}]},add_dialogVisible:!1,edit_dialogVisible:!1,pointTableData:[{index:1,arr:[{name:"采集块ID",value:"",font:"collectId",maxLen:"10"},{name:"设备地址",value:"",font:"slaveAddr",maxLen:"9"},{name:"采集块起始地址",value:"",font:"startAddr",maxLen:"9"}]}],unfinishedTableData:[{index:1,arr:[{name:"采集块ID",value:"",font:"collectId",maxLen:"10"},{name:"设备地址",value:"",font:"slaveAddr",maxLen:"9"},{name:"采集块起始地址",value:"",font:"startAddr",maxLen:"9"}]}],showTableIndex:[1],showDialogTableIndex:[1],tdNum:{},cpNum:0,clickIndex:0,allTableIndex:[],detailVisible:!1,hasUnfinished:!1,dataTypeArr:[{label:"布尔量",value:"1"},{label:"无符号单字节",value:"2"},{label:"有符号单字节",value:"3"},{label:"无符号单字",value:"4"},{label:"有符号单字",value:"5"},{label:"有符号双字",value:"6"},{label:"无符号双字",value:"7"},{label:"32位浮点型",value:"8"}],uploadArr:[{label:"定时上传",value:"1"},{label:"差异上传",value:"2"},{label:"定时且差异",value:"3"}],notLeave:!1,oldCheckValue:[],unfinishedPro:[{label:"设备编号：",value:"",id:1,code:"equCode"},{label:"设备名称：",value:"",id:2,code:"equName"},{label:"协议组：",value:"",id:3,code:"protocol"},{label:"ip地址：",value:"",id:4,code:"ipAddress"},{label:"端口号：",value:"",id:5,code:"portNumber"},{label:"上传频率：",value:"",id:6,code:"frequency"}],singlePointId:"",pointRowH:370,registerPointData:[],isAllPoint:!0,isMessage:!1,isSave:!1,showTable:!0}},computed:{setTemplateUrl:function(){return"/wuyuan/device/equipment/exportEquipmentTemplate?token="+localStorage.getItem("token")},setUploadUrl:function(){return"/wuyuan/resource/loadPointConfigTemplate?type=1"},dialogWidth:function(){return window.innerWidth<=1366?"80%":"75%"},whichTemplateStyles:function(){return 4===this.equInfo.nodeType?this.apiTemplateStyles:this.templateStyles},frequencyM:function(){var e=this.editForm.frequency;switch(this.editForm.frequencyUnit){case"second":e/=60;break;case"hour":e*=60;break;case"day":e=60*e*24}return e}},watch:{pointTableData:{handler:function(e,t){this.allTableIndex=e.map(function(e){return e.index})},deep:!0},editForm:{deep:!0,handler:function(e,t){this.watchNum++,this.watchNum>1&&!this.hasChange&&(this.hasChange=!0)}}},mounted:function(){var e=p()(u.a.mark(function e(){var t=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.$RequestUtil.post({url:"/device/protocol/getProtocolTree",params:{},success:function(e){t.$set(t.protocalList,"data",e.data.tree.children),t.checkTree(t.myAllTree,t.protocalList.data),"fail"===e.result&&t.$message({type:"error",message:e.msg})}});case 3:return e.next=5,this.search();case 5:if(this.equData.push(this.equInfo),1!==this.equInfo.nodeType&&4!==this.equInfo.nodeType){e.next=9;break}return e.next=9,this.$RequestUtil.post({url:"/device/equipment/getEquipmentList",params:{nodeType:2,id:this.equInfo.id},success:function(e){t.equData=t.equData.concat(e.data),"fail"===e.result&&t.$message({type:"error",message:e.msg})}});case 9:this.pointSearch("mounted"),this.$RequestUtil.post({url:"/device/pointTemplate/getPointManageList",params:{},success:function(e){var a=[],i=[];e.data.forEach(function(e){1==e.scopeType&&a.push(e),2==e.scopeType&&i.push(e)}),t.pointData=a,t.registerPointData=i,"fail"===e.result&&t.$message({type:"error",message:e.msg})}}),Object(g.b)(document.getElementById("pointRow"),this.resizePointRow),window.onbeforeunload=function(e){if(t.hasChange)return(e=e||window.event).returnValue="当前页面有修改，确认离开？","当前页面有修改，确认离开？"};case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),beforeDestroy:function(){},methods:{addUnload:function(){var e=this,t=setTimeout(function(){window.onbeforeunload=function(t){if(e.hasChange)return(t=t||window.event).returnValue="当前页面有修改，确认离开？","当前页面有修改，确认离开？"},clearTimeout(t),t=null},1e3)},removeUnload:function(){window.onbeforeunload=null},resizePointRow:function(){this.pointRowH=window.innerWidth<=1366?370:document.getElementById("pointRow").offsetHeight},clickInput:function(){this.$forceUpdate()},pointSearch:function(e){var t=this;this.$RequestUtil.post({url:"/device/equipment/getEquipmentPointDetail",params:{equId:this.$route.query.id},success:function(a){if("fail"!==a.result){t.pointTableData=[{index:1,arr:[{name:"采集块ID",value:"",font:"collectId",maxLen:"10"},{name:"设备地址",value:"",font:"slaveAddr",maxLen:"9"},{name:"采集块起始地址",value:"",font:"startAddr",maxLen:"9"}]}];var i=a.data[0]?a.data[0]:a.data[3]?a.data[3]:[];i&&0!=i.length?t.getPointConfData(i,e,"finished"):t.$nextTick(function(){t.$refs.pointTable1&&t.$refs.pointTable1.addTD(1)}),a.data[1]&&0!=a.data[1].length&&(t.detailVisible=!0,t.hasUnfinished=!0,t.getPointConfData(a.data[1],e,"unfinished")),t.loading=!1,"add"==e&&(t.hasChange=!1)}else t.$message({type:"error",message:a.msg})}})},getSamePointData:function(e){for(var t={},a=[],i=1,r=0;r<e.length;r++){var s=e[r],o=e[r+1];s.collectId+s.slaveAddr+s.startAddr==(e[r+1]?o.collectId+o.slaveAddr+o.startAddr:"")?a.push(e[r]):(a.push(e[r]),t[i]=a.concat(),i++,a=[])}return t},getPointTableData:function(e,t){var a={index:t+1,arr:[{name:"采集块ID",value:"",font:"collectId",maxLen:"10"},{name:"设备地址",value:"",font:"slaveAddr",maxLen:"9"},{name:"采集块起始地址",value:"",font:"startAddr",maxLen:"9"}]};return a.arr[0].value=e[0].collectId,a.arr[1].value=e[0].slaveAddr,a.arr[2].value=e[0].startAddr,this.showTableIndex.indexOf(t+1)<0&&(this.showTableIndex.push(t+1),this.allTableIndex.push(t+1)),a},getPointConfData:function(e,t,a){var i=this,s={},l={};"finished"!=a&&(this.dialogTableData={}),e.sort(function(e,t){return e.collectId-t.collectId});var d=this.getSamePointData(e),u=0,c=0,p=0;n()(d).forEach(function(e){"finished"==a?(i.tdNum[e]=d[e].length,i.pointTableData[u]=i.getPointTableData(d[e],u),l[e]=d[e].reduce(function(e,a){return["null","undefined",""].includes(String(a.dataId))?c++:(a.equSubId=a.equSubId||a.equCode,a.bigEndian=Boolean(a.bigEndian),a.type=Number(a.type),"upload"!=t&&(a.timerState=Boolean(a.timerState),a.realtimeState=Boolean(a.realtimeState)),a.uploadStatus=String(a.uploadStatus)),["null","undefined",""].includes(String(a.dataId))?e:[].concat(o()(e),[a])},[])):(i.unfinishedTableData[u]=i.getPointTableData(d[e],u),s[e]=d[e].reduce(function(e,a){return["null","undefined",""].includes(String(a.dataId))?p++:(a.equSubId=a.equSubId||a.equCode,a.type=Number(a.type),"upload"!=t&&(a.timerState=Boolean(a.timerState),a.realtimeState=Boolean(a.realtimeState))),["null","undefined",""].includes(String(a.dataId))?e:[].concat(o()(e),[a])},[])),u++}),"finished"==a?(c>0&&this.messageShow(c,"finished"),this.configForm.pointConf=l):(p>0&&this.messageShow(p,"unFinished"),this.dialogTableData=s);var m={equ:this.equInfo.equCode,finished:c,unFinished:p},h=localStorage.getItem("emptyNum")?JSON.parse(localStorage.getItem("emptyNum")):{};h[this.equInfo.equCode]=m,localStorage.setItem("emptyNum",r()(h)),this.cpNum=Math.random(),this.$nextTick(function(){i.$refs.pointTable&&i.$refs.pointTable.clearRules()}),"add"==t&&(this.hasChange=!1)},messageShow:function(e,t){if(!this.isMessage){if(localStorage.getItem("emptyNum"))e!=JSON.parse(localStorage.getItem("emptyNum"))[this.equInfo.equCode][t]&&(this.$message({message:"受KPI影响，当前点位已更新",type:"warning"}),this.isMessage=!0);!localStorage.getItem("emptyNum")&&e>0&&(this.$message({message:"受KPI影响，当前点位已更新",type:"warning"}),this.isMessage=!0)}},pointDetail:function(e,t,a,i){var r=this;this.$RequestUtil.post({url:"/device/pointTemplate/getPointDetailData",params:{pointId:t},success:function(e){"fail"!==e.result?("collect"==a?(r.isAllPoint=!0,r.singlePointId="",r.getPointConfData(e.data,"mounted","finished")):(r.isAllPoint=!1,r.singlePointDetail(e.data,i)),r.hasChange=!0):r.$message({type:"error",message:e.msg})}})},singlePointDetail:function(e,t){var a=this,i={};i[t]=e.map(function(e){return{address:e.address,length:String(e.length),equSubId:e.equSubId,dataId:e.dataId,uploadStatus:String(e.uploadStatus),type:e.type,bigEndian:e.bigEndian,bit:e.bit}}),this.configForm.pointConf=i,this.hasChange=!0,this.tableData=this.configForm.pointConf,this.cpNum=Math.random(),this.$nextTick(function(){a.$refs.pointTable.clearRules()})},beforeUpload:function(e){if(e.size>10485760)return this.$message.error("文件不能大于10M"),!1},upLoadSuccess:function(e,t,a){if("success"!=e.result)this.$message({type:"error",message:e.msg}),this.$refs.upload.clearFiles();else{this.hasChange=!0;var i={"定时上传":"1","差异上传":"2","定时且差异":"3"},r={"布尔量":1,"无符号单字节":2,"有符号单字节":3,"无符号单字":4,"有符号单字":5,"无符号双字":6,"有符号双字":7,"32位浮点型":8};e.data.forEach(function(e){switch("是"==e.大端模式?e.大端模式=!0:e.大端模式=!1,e.上传状态=i[e.上传状态],e.数据类型=r[e.数据类型],e.数据类型){case 1:case 2:case 3:e.length=1;break;case 4:case 5:e.length=2;break;case 6:case 7:case 8:e.length=4;break;default:e.length=""}}),e.data;var s={"地址":"address","采集块ID":"collectId","长度":"length","数据ID":"dataId","设备地址":"slaveAddr","数据类型":"type","Bit位":"bit","数据来源于(编号)":"equSubId","大端模式":"bigEndian","上传状态":"uploadStatus","采集块起始地址":"startAddr"},o=e.data.map(function(e){return commonUtils.toChsKeys(e,s)});0!=o.length&&(this.errorMsg={},this.getPointConfData(o,"upload","finished"))}},queryAddrAsync:function(e,t){this.$method.amapPOI(e).then(function(e){t(e.data.pois.map(function(e){return{value:e.name}}))})},search:function(e){var t=this;return this.$RequestUtil.post({url:"/device/equipment/infoToEquipment",params:{id:this.$route.query.id},success:function(a){var i={},r={};0!=a.data.list.length&&a.data.list.forEach(function(e){i=0===e.preinstall||3===e.preinstall?e:i,r=1==e.preinstall?e:r}),t.equInfo=a.data,t.editForm.ipAddress=i&&i.ipAddress?i.ipAddress:"0.0.0.0",t.editForm.portNumber=i&&i.portNumber?i.portNumber:0,t.editForm.frequency=i&&i.frequency?Number(i.frequency):0,t.editForm.frequencyUnit=i&&i.frequencyUnit?i.frequencyUnit:"second",i?t.getProtocalInfo(i.protocolId):t.editForm.protocol=[],r&&t.unfinishedPro.forEach(function(e){e.value="protocol"==e.code?r.protocolName:"frequency"==e.code?r[e.code]+t.transFU(r.frequencyUnit):["portNumber","ipAddress"].includes(e.code)?r[e.code]:a.data[e.code]}),e&&"refresh"==e&&(t.hasChange=!1)}})},transFU:function(e){var t=void 0;switch(e){case"second":t="秒";break;case"minute":t="分钟";break;case"hour":t="小时";break;case"day":t="天"}return t},refresh:function(){this.pagination.currentPage=1,this.queryParams.serialNum="",this.queryParams.equManufacturers="",this.showTable=!0,this.search("refresh"),this.hasChange=!1},getExportTemplate:function(){document.getElementById("ifile").src="/device/equipment/exportEquipmentTemplate?token="+localStorage.getItem("token")},sureAdd:function(){var e=this;this.isAllPoint=!0;var t=this;this.$refs.baseForm.validate(function(a){if(a){if(e.frequencyM>e.equInfo.offLineDuration)return void e.$message.error("上传频率不能超过DTU离线间隔时间（"+e.equInfo.offLineDuration+"）分钟");e.$refs.pointTable1.beforeSubmit().then(function(a){var i=a;0!=a.length?t.$RequestUtil.postSync({url:"/device/equipment/updateEquipmentDetail",params:{equId:t.$route.query.id,protocolId:t.editForm.protocol[t.editForm.protocol.length-1],ipAddress:t.editForm.ipAddress,portNumber:t.editForm.portNumber,frequencyUnit:t.editForm.frequencyUnit,equipmentPointList:i,frequency:t.editForm.frequency,equNodeType:t.equInfo.nodeType,equCode:t.equInfo.equCode},type:"sync",success:function(a){if("success"===a.result){e.showTable=!1,t.$eventBus.$emit("triggerMsg",a.data),t.$message({type:"success",message:a.msg});t.add_dialogVisible=!1,e.isSave=!0;var i=setTimeout(function(){t.refresh(),clearTimeout(i)},100);t.pointSearch("add"),e.watchNum=0,e.configForm.pointConf={}}else"fail"===a.result?t.$message({type:"error",message:a.msg}):"warn"===a.result&&t.$message({type:"warning",message:a.msg})}}):e.$message.error("请至少增加一行设备点位")})}})},changeHasChange:function(){var e=this;if(this.hasChange=!this.isSave,1==this.isSave)var t=setTimeout(function(){e.isSave=!1,clearTimeout(t)},1e3)},checkTree:function(e,t){for(var a in t)e.push({id:t[a].id,pid:t[a].pId}),null!=t[a].children&&t[a].children.length>0&&this.checkTree(e,t[a].children)},getProtocalInfo:function(e){this.editForm.protocol=[];var t=0;for(var a in this.myAllTree)if(e==this.myAllTree[a].id){t=this.myAllTree[a].pid;break}this.editForm.protocol.unshift(e),this.getParentId(this.editForm.protocol,t)},getParentId:function(e,t){for(var a in this.myAllTree){if(1===t)return;if(t===this.myAllTree[a].id){e.unshift(this.myAllTree[a].id),this.getParentId(e,this.myAllTree[a].pid);break}}}},beforeRouteLeave:function(e,t,a){var i=this;if(this.hasChange){var r=setTimeout(function(){i.$confirm("当前页面有修改，确认离开？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a()}).catch(function(){}),clearTimeout(r),r=null},300);Object(g.a)(document.getElementById("pointRow"),this.resizePointRow),window.onbeforeunload=null}else a()}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window",class:e.pointRowH>500?"listWindowPR":""},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"searchbar"},[a("el-form",{ref:"baseForm",staticClass:"demo-form-inline",attrs:{rules:e.editRules,inline:!0,model:e.editForm,"label-width":"100px","label-position":"left"}},[a("el-row",{staticStyle:{padding:"10px 10px"}},[a("span",{staticClass:"bigTitle"},[e._v("基本信息")])]),e._v(" "),a("el-row",{staticClass:"searchPad"},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"设备编号："}},[a("span",{staticClass:"line-span"},[e._v(e._s(e.equInfo.equCode))])])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"设备名称："}},[a("span",{staticClass:"line-span"},[e._v(e._s(e.equInfo.equName))])])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{ref:"prot",attrs:{label:"协议组：",prop:"protocol"}},[a("el-cascader",{ref:"cas",staticClass:"form__input",attrs:{placeholder:"请选择协议组",options:e.protocalList.data,props:{value:"id",label:"label",children:"children"},"show-all-levels":!1},model:{value:e.editForm.protocol,callback:function(t){e.$set(e.editForm,"protocol",t)},expression:"editForm.protocol"}})],1)],1)],1),e._v(" "),a("el-row",{staticClass:"searchPad"},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"ip地址：","label-width":"100px",prop:"ipAddress"}},[a("IPAddressInput",{model:{value:e.editForm.ipAddress,callback:function(t){e.$set(e.editForm,"ipAddress",t)},expression:"editForm.ipAddress"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"端口号：",prop:"portNumber"}},[a("el-input",{staticClass:"form__input port",attrs:{placeholder:"请输入端口号",size:"small",maxlength:"15"},model:{value:e.editForm.portNumber,callback:function(t){e.$set(e.editForm,"portNumber",t)},expression:"editForm.portNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"上传频率：",prop:"frequency"}},[a("el-input",{staticClass:"form__input input-with-select",attrs:{size:"small",maxlength:"9"},model:{value:e.editForm.frequency,callback:function(t){e.$set(e.editForm,"frequency",e._n(t))},expression:"editForm.frequency"}},[a("el-select",{attrs:{slot:"append",placeholder:"请选择上传频率"},slot:"append",model:{value:e.editForm.frequencyUnit,callback:function(t){e.$set(e.editForm,"frequencyUnit",t)},expression:"editForm.frequencyUnit"}},[a("el-option",{attrs:{label:"秒",value:"second"}}),e._v(" "),a("el-option",{attrs:{label:"分钟",value:"minute"}}),e._v(" "),a("el-option",{attrs:{label:"小时",value:"hour"}}),e._v(" "),a("el-option",{attrs:{label:"天",value:"day"}})],1)],1)],1)],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{padding:"10px 10px"}},[a("span",{staticClass:"bigTitle"},[e._v("设备点位")])]),e._v(" "),a("el-row",{staticStyle:{padding:"10px 40px"}},[a("el-row",{staticStyle:{padding:"5px 5px"}},[a("a",{staticClass:"marRight10",attrs:{href:e.setTemplateUrl}},[a("el-button",{attrs:{size:"small"},nativeOn:{mousedown:function(t){return e.removeUnload(t)},mouseup:function(t){return e.addUnload(t)}}},[e._v("模板下载")])],1),e._v(" "),a("el-upload",{ref:"upload",staticClass:"marRight10",staticStyle:{display:"inline"},attrs:{action:e.setUploadUrl,"show-file-list":!1,method:"post",accept:".xlsx","before-upload":e.beforeUpload,"on-success":e.upLoadSuccess}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1),e._v(" "),a("div",{staticStyle:{display:"inline-block","text-align":"center","font-size":"13px",color:"#606266"}},[e._v("系统全点位模板选择：")]),e._v(" "),a("el-select",{staticClass:"form__input marRight10",on:{change:function(t){return e.pointDetail(t,e.searchform.pointId,"collect","")}},model:{value:e.searchform.pointId,callback:function(t){e.$set(e.searchform,"pointId",t)},expression:"searchform.pointId"}},e._l(e.pointData,function(e){return a("el-option",{key:e.id,attrs:{label:e.pointName,value:e.id}})}),1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.hasUnfinished,expression:"hasUnfinished"}],staticClass:"marRight10",attrs:{plain:"",type:"primary",size:"small"},on:{click:function(t){e.detailVisible=!0}}},[e._v("\n          未完成点位配置详情\n        ")])],1),e._v(" "),a("el-row",{staticStyle:{padding:"5px 5px"},attrs:{id:"pointRow"}},[e.showTable?a("pointConf",{ref:"pointTable1",attrs:{"point-conf-item-data":e.pointTableData,"show-table-index":e.showTableIndex,"conf-template-styles":e.whichTemplateStyles,"point-config-form":e.configForm.pointConf,"equ-data":e.equData,"now-td-num":e.tdNum,"validate-collect":e.isAllPoint,"is-add":e.hasChange,"is-save":e.isSave},on:{clickAddTd:function(t){e.clickIndex=t},isChange:e.changeHasChange},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"flexCenter singlePoint"},[e._v("系统寄存器模板选择：")]),e._v(" "),a("el-select",{staticClass:"singleInput  marRight10",on:{change:function(a){return e.pointDetail(a,e.singlePointId,"single",t.index)}},model:{value:e.singlePointId,callback:function(t){e.singlePointId=t},expression:"singlePointId"}},e._l(e.registerPointData,function(e){return a("el-option",{key:e.id,attrs:{label:e.pointName,value:e.id}})}),1)]}}],null,!1,1085740075)}):e._e(),e._v(" "),a("div",{staticStyle:{width:"100%","text-align":"center","margin-top":"20px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.sureAdd}},[e._v("提交")])],1)],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"detailDialog",attrs:{"close-on-click-modal":!1,visible:e.detailVisible,width:e.dialogWidth},on:{"update:visible":function(t){e.detailVisible=t}}},[a("template",{slot:"title"},[a("div",{},[a("span",{staticClass:"detailBigTitle"},[e._v("未完成点位详情")]),e._v(" "),a("span",{staticClass:"detailSmallTitle"},[e._v("(关闭后可点击相应按钮打开)")])])]),e._v(" "),a("div",{staticClass:"flexBox flexWrap basic"},e._l(e.unfinishedPro,function(t){return a("div",{key:t.id,staticClass:"unProDiv"},[a("span",{class:[1,2,4,5].includes(t.id)?"title":"title2"},[e._v(e._s(t.label))]),e._v(" "),a("span",{staticClass:"content"},[e._v(e._s(t.value))])])}),0),e._v(" "),a("pointConf",{ref:"pointTable",staticClass:"detailScroll",attrs:{"point-conf-item-data":e.unfinishedTableData,"show-table-index":e.showDialogTableIndex,"conf-template-styles":e.whichTemplateStyles,"point-config-form":e.dialogTableData,"need-scroll":!0,"has-collect":!0,"is-read-only":!0}})],2)],1)},staticRenderFns:[]};var q=a("C7Lr")(b,y,!1,function(e){a("CPWA"),a("dtiz")},"data-v-36bef44e",null);t.default=q.exports},dtiz:function(e,t){},p5jz:function(e,t){},q5BV:function(e,t){}});