webpackJsonp([32],{"1QfU":function(e,t){},RKBd:function(e,t){},TkB5:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("lC5x"),s=a.n(l),r=a("J0Oq"),i=a.n(r),o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"AlarmDetail"},[a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"模板管理详情",visible:e.$parent.detailShow,width:"40%"},on:{"update:visible":function(t){return e.$set(e.$parent,"detailShow",t)}}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("模板名称：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:6}},[e._v(e._s(e.templateInfo.templateName))]),e._v(" "),a("el-col",{attrs:{span:1}}),e._v(" "),a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("模板编号：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:7}},[e._v(e._s(e.templateInfo.templateCode))])],1),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("模板标题：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:6}},[e._v(e._s(e.templateInfo.templateHeadline))]),e._v(" "),a("el-col",{attrs:{span:1}}),e._v(" "),a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("审核状态：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:7}},[e._v(e._s(0==e.templateInfo.state?"审核未通过":"审核已通过"))])],1),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("设备类型：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:6}},[e._v(e._s(0==e.templateInfo.deviceType?"设备告警":"DTU告警"))]),e._v(" "),a("el-col",{attrs:{span:1}}),e._v(" "),a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("审核时间：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:7}},[e._v(e._s(e.$method.formatterTime(e.templateInfo.checkTime)))])],1),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("模板类型：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:6}},[e._v(e._s(1==e.templateInfo.templateType?"短信":"邮件"))]),e._v(" "),a("el-col",{attrs:{span:1}}),e._v(" "),a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("创建时间：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:7}},[e._v(e._s(e.$method.formatterTime(e.templateInfo.gmtCreate)))])],1),e._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("模板内容：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:6}},[e._v(e._s(e.templateInfo.templateInfo))]),e._v(" "),a("el-col",{attrs:{span:1}}),e._v(" "),a("el-col",{staticClass:"span-col",attrs:{span:5}},[e._v("模板样例：")]),e._v(" "),a("el-col",{staticClass:"span-col-font",attrs:{span:7}},[e._v(e._s(e.templateInfo.templateSample))])],1)],1)],1)},staticRenderFns:[]};var n={name:"templateManagement",components:{MessageTemplateInfo:a("C7Lr")({name:"messageTemplateInfo",props:["messageTemplateInfo"],data:function(){return{detailShow:!1,templateInfo:[]}},methods:{getDetail:function(e){this.$parent.detailShow=!0,this.getMessageTemplateInfo(e)},getMessageTemplateInfo:function(e){var t=this;return this.$RequestUtil.post({url:"/device/messageTemplate/getMessageTemplateInfo",params:{id:e.id},success:function(e){t.templateInfo=e.data}})}}},o,!1,function(e){a("1QfU")},"data-v-0235c48f",null).exports},data:function(){return{auditTemplateDialog:!1,auditTemplateForm:{remark:""},loading:!1,searchForm:{templateName:"",templateCode:"",state:""},queryParams:{templateName:"",templateCode:"",state:"",orderColumn:"gmtModified",orderType:"DESC"},tableData:[],stateDisabled:!0,deviceTypeList:[{id:0,typeName:"设备告警"},{id:1,typeName:"DTU告警"}],pagination:{currentPage:1,totalPage:0,pagesize:10},detailShow:!1,currentRow:{},addTemplateFlag:!1,addTemplateForm:{templateName:"",templateHeadline:"",templateInfo:"",equType:"",templateType:""},editTemplateFlag:!1,editTemplateForm:{templateName:"",templateHeadline:"",templateInfo:"",equType:"",id:"",templateType:""},tempTypeArr:[{value:2,label:"邮件"}],templateVariable:"",templateVariableFlase:"",templateVariableTrue:"",rules:{templateName:[{required:!0,message:"请输入模板名称",trigger:"blur"},{validator:function(e,t,a){commonUtils.regExp.noSpecialChar(t.toString().trim())||a(new Error("不能有特殊字符")),a()},trigger:"blur"}],templateHeadline:[{required:!0,message:"请输入模板标题",trigger:"blur"},{validator:function(e,t,a){commonUtils.regExp.noSpecialChar(t.toString().trim())||a(new Error("不能有特殊字符")),a()},trigger:"blur"}],templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],templateInfo:[{required:!0,message:"请输入模板内容",trigger:"blur"}],deviceType:[{required:!0,message:"请选择模板类型",trigger:"blur"},{validator:function(e,t,a){commonUtils.regExp.noSpecialChar(t.toString().trim())||a(new Error("不能有特殊字符")),a()},trigger:"blur"}]},searchArr:[]}},mounted:function(){this.searchArr=[{id:"1",label:"模板名称",value:"templateName",type:"input"},{id:"2",label:"模板编号",value:"templateCode",type:"input"},{id:"3",label:"审批状态",value:"state",type:"select",data:[{value:0,label:"未通过"},{value:1,label:"已通过"}]}],this.search(),this.getTemplateVariable()},methods:{sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},templateDetail:function(e){this.$refs.myMessageTemplateInfo.getDetail(e)},transTempType:function(e){return 1==e.templateType?"短信":2==e.templateType?"邮件":""},transType:function(e){return 0==e.templateIsDefault?"自定义":1==e.templateIsDefault?"默认":""},btnSearch:function(e){this.pagination.currentPage=1,this.queryParams.templateName=e.templateName,this.queryParams.templateCode=e.templateCode,this.queryParams.state=e.state,this.search()},clearPart:function(){this.queryParams.templateName="",this.queryParams.templateCode="",this.queryParams.state=""},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/messageTemplate/getMessageTemplateListPage",params:{page:this.pagination.currentPage,rows:this.pagination.pagesize,templateName:this.queryParams.templateName,templateCode:this.queryParams.templateCode,state:this.queryParams.state,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(t){e.tableData=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1}}).catch(function(){e.loading=!1})},delectTemplate:function(e){var t=this;this.$RequestUtil.post({url:"/device/alarmRule/coutTemplateAlarmRuleNum",params:{alarmSendTemplateId:e.id},success:function(a){0==e.seedNeed?t.delNotAlarmRuleSend(a.data,e):t.delBingAlarmRuleSend(a.data,e)}})},delNotAlarmRuleSend:function(e,t){var a=this;this.$confirm(0==e?" 确认删除?":"此模板绑定了"+e+"个告警规则，删除会解绑规则，确认需要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$RequestUtil.post({url:"/device/messageTemplate/deleteMessageTemplate",params:{id:t.id},success:function(e){"success"==e.result&&(a.$message.success(e.msg),a.addTemplateFlag=!1,a.search())}})}).catch(function(){})},delBingAlarmRuleSend:function(e,t){var a=this;e>0?this.$confirm("该模板下有"+e+"个告警规则, 请解绑后再删除！","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"}):this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$RequestUtil.post({url:"/device/messageTemplate/deleteMessageTemplate",params:{id:t.id},success:function(e){"success"==e.result&&(a.$message.success(e.msg),a.addTemplateFlag=!1,a.search())}})}).catch(function(){})},openAddForm:function(){this.addTemplateFlag=!0,this.pitchType(0),this.addTemplateForm.deviceType=0},addTemplate:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.$RequestUtil.post({url:"/device/messageTemplate/addMessageTemplate",params:{templateName:t.addTemplateForm.templateName,templateHeadline:t.addTemplateForm.templateHeadline,templateInfo:t.addTemplateForm.templateInfo,deviceType:t.addTemplateForm.deviceType,templateType:t.addTemplateForm.templateType},success:function(e){"success"==e.result?(t.$message.success(e.msg),t.addTemplateFlag=!1,t.search()):(t.$message.warning(e.msg),t.addTemplateFlag=!1)}})})},pitchType:function(e){this.templateVariable=0==e?this.templateVariableFlase:this.templateVariableTrue},getTemplateVariable:function(e){var t=this;return this.$RequestUtil.post({url:"/device/messageTemplate/getTemplateVariable",params:{},success:function(e){e.data.filter(function(e){0==e.deviceType&&(t.templateVariableFlase+=e.name+":"+e.meaning+"; "),1==e.deviceType&&(t.templateVariableTrue+=e.name+":"+e.meaning+"; ")})}})},resetAdd:function(){this.templateVariable="",this.addTemplateForm=[];var e=this.$refs.addTemplateForm;null!=e&&e.resetFields()},openEditForm:function(e){this.getTemplateInfo(e),this.editTemplateFlag=!0},getTemplateInfo:function(e){var t=this;return this.$RequestUtil.post({url:"/device/messageTemplate/getMessageTemplateInfo",params:{id:e.id},success:function(e){t.editTemplateForm=e.data,t.pitchType(e.data.deviceType)}})},updateTemplate:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.$RequestUtil.post({url:"/device/messageTemplate/updateMessageTemplate",params:{id:t.editTemplateForm.id,templateName:t.editTemplateForm.templateName,templateHeadline:t.editTemplateForm.templateHeadline,templateInfo:t.editTemplateForm.templateInfo,templateType:t.editTemplateForm.templateType,deviceType:t.editTemplateForm.deviceType},success:function(e){"success"==e.result?(t.$message.success(e.msg),t.editTemplateFlag=!1,t.search()):(t.$message.warning(e.msg),t.addTemplateFlag=!1)}})})},resetEdit:function(){this.templateVariable="",this.addTemplateForm=[],this.auditTemplateForm.remark="";var e=this.$refs.editTemplateForm;null!=e&&e.resetFields()},showAuditTemplate:function(e){this.currentRow=e,this.auditTemplateDialog=!0},auditTemplate:function(e){var t=this;return i()(s.a.mark(function a(){var l;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(l=1,e){a.next=6;break}if(""!==t.auditTemplateForm.remark.trim()){a.next=5;break}return t.$message.error("请输入备注"),a.abrupt("return");case 5:l=2;case 6:t.$RequestUtil.post({url:"/device/messageTemplate/updateMessageState",params:{id:t.currentRow.id,state:l,remarks:t.auditTemplateForm.remark},success:function(e){t.$message.success(e.msg),t.auditTemplateDialog=!1,t.search()}});case 7:case"end":return a.stop()}},a,t)}))()}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window"},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{"search-arr":e.searchArr},on:{clear:function(t){e.clearPart()},search:function(t){e.btnSearch(t)}}})],1),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_WRITE?a("div",{staticClass:"operatebar"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.openAddForm}},[e._v("新增")])],1):e._e(),e._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-row-class-name":"table-header-color","default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent}},[a("el-table-column",{attrs:{prop:"templateName",label:"模板名称",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"templateCode",label:"模板编号",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"templateType",label:"模板类型","min-width":"50",formatter:e.transTempType,sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"state",label:"审批状态",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:{color:1===t.row.state?"rgb(41, 197, 90)":null},attrs:{type:"text",size:"mini"}},[e._v("\n            "+e._s(t.row.state.toString().replace("0","未通过").replace("1","已通过"))+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"templateIsDefault",label:"类型","min-width":"50",formatter:e.transType,sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"gmtCreate","min-width":"80",formatter:function(t){return e.$method.formatterTime(t.gmtCreate)},label:"创建时间",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.templateDetail(t.row)}}},[e._v("详情")]),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_WRITE?a("span",{staticClass:"vertical"}):e._e(),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_WRITE?a("el-button",{attrs:{type:"text",disabled:1===t.row.state},on:{click:function(){return e.openEditForm(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_EXAMINE?a("span",{staticClass:"vertical"}):e._e(),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_EXAMINE?a("el-button",{attrs:{type:"text",disabled:1===t.row.state},on:{click:function(){return e.showAuditTemplate(t.row)}}},[e._v("审核")]):e._e(),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_WRITE?a("span",{staticClass:"vertical"}):e._e(),e._v(" "),e.$PERMISSION.MESSAGE_TMMPLATE_WRITE?a("el-button",{attrs:{disabled:1===t.row.templateIsDefault,type:"text"},on:{click:function(){return e.delectTemplate(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),[a("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})]],2),e._v(" "),a("el-dialog",{attrs:{title:"新增模板",width:"30%",visible:e.addTemplateFlag,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addTemplateFlag=t},close:e.resetAdd}},[a("el-form",{ref:"addTemplateForm",staticStyle:{width:"85%"},attrs:{model:e.addTemplateForm,rules:e.rules,"label-width":"95px"}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备类型：",prop:"deviceType"}},[a("el-select",{attrs:{placeholder:"请选择设备类型"},on:{change:e.pitchType},model:{value:e.addTemplateForm.deviceType,callback:function(t){e.$set(e.addTemplateForm,"deviceType",t)},expression:"addTemplateForm.deviceType"}},e._l(e.deviceTypeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.typeName,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板类型：",prop:"templateType"}},[a("el-select",{attrs:{placeholder:"请选择模板类型"},model:{value:e.addTemplateForm.templateType,callback:function(t){e.$set(e.addTemplateForm,"templateType",t)},expression:"addTemplateForm.templateType"}},e._l(e.tempTypeArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板名称：",prop:"templateName"}},[a("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入模板名称"},model:{value:e.addTemplateForm.templateName,callback:function(t){e.$set(e.addTemplateForm,"templateName","string"==typeof t?t.trim():t)},expression:"addTemplateForm.templateName"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板标题：",prop:"templateHeadline"}},[a("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入模板标题"},model:{value:e.addTemplateForm.templateHeadline,callback:function(t){e.$set(e.addTemplateForm,"templateHeadline","string"==typeof t?t.trim():t)},expression:"addTemplateForm.templateHeadline"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"变量说明："}},[e._v(e._s(this.templateVariable))]),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板内容：",prop:"templateInfo"}},[a("el-input",{staticClass:"search-input-wat",attrs:{type:"textarea",maxlength:"200",placeholder:"请输入模板内容"},model:{value:e.addTemplateForm.templateInfo,callback:function(t){e.$set(e.addTemplateForm,"templateInfo",t)},expression:"addTemplateForm.templateInfo"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addTemplate("addTemplateForm")}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑模板",width:"30%",visible:e.editTemplateFlag,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editTemplateFlag=t},close:e.resetEdit}},[a("el-form",{ref:"editTemplateForm",staticStyle:{width:"85%"},attrs:{rules:e.rules,model:e.editTemplateForm,"label-width":"95px"}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备类型：",prop:"deviceType"}},[a("el-select",{attrs:{placeholder:"请选择设备类型"},on:{change:e.pitchType},model:{value:e.editTemplateForm.deviceType,callback:function(t){e.$set(e.editTemplateForm,"deviceType",t)},expression:"editTemplateForm.deviceType"}},e._l(e.deviceTypeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.typeName,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板类型：",prop:"templateType"}},[a("el-select",{attrs:{placeholder:"请选择模板类型"},model:{value:e.editTemplateForm.templateType,callback:function(t){e.$set(e.editTemplateForm,"templateType",t)},expression:"editTemplateForm.templateType"}},e._l(e.tempTypeArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板名称：",prop:"templateName"}},[a("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入模板名称"},model:{value:e.editTemplateForm.templateName,callback:function(t){e.$set(e.editTemplateForm,"templateName","string"==typeof t?t.trim():t)},expression:"editTemplateForm.templateName"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板标题：",prop:"templateHeadline"}},[a("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入模板标题"},model:{value:e.editTemplateForm.templateHeadline,callback:function(t){e.$set(e.editTemplateForm,"templateHeadline","string"==typeof t?t.trim():t)},expression:"editTemplateForm.templateHeadline"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"变量说明："}},[e._v(e._s(this.templateVariable))]),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"模板内容：",prop:"templateInfo"}},[a("el-input",{staticClass:"search-input-wat",attrs:{type:"textarea",maxlength:"200",placeholder:"请输入模板内容"},model:{value:e.editTemplateForm.templateInfo,callback:function(t){e.$set(e.editTemplateForm,"templateInfo",t)},expression:"editTemplateForm.templateInfo"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateTemplate("editTemplateForm")}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"审核",width:"30%",visible:e.auditTemplateDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.auditTemplateDialog=t},close:e.resetEdit}},[a("el-form",{ref:"auditTemplate",attrs:{model:e.auditTemplateForm}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{placeholder:"",type:"textarea",maxlength:"255"},model:{value:e.auditTemplateForm.remark,callback:function(t){e.$set(e.auditTemplateForm,"remark",t)},expression:"auditTemplateForm.remark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.auditTemplate(!1)}}},[e._v("不通过")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.auditTemplate(!0)}}},[e._v("通过")])],1)],1),e._v(" "),a("MessageTemplateInfo",{ref:"myMessageTemplateInfo"})],1)},staticRenderFns:[]};var m=a("C7Lr")(n,p,!1,function(e){a("RKBd")},"data-v-172972fa",null);t.default=m.exports}});