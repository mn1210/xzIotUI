webpackJsonp([48],{DJUd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("3cXf");var r=a("rVsN"),o=a.n(r),i=a("lC5x"),l=a.n(i),s=a("J0Oq"),n=a.n(s),d={name:"device-model",components:{},data:function(){var e=this;return{loading:!1,addModel_dialogVisible:!1,attribute_dialogVisible:!1,detailModel_dialogVisible:!1,searchform:{modelName:""},queryParams:{modelName:"",orderColumn:"gmtModified",orderType:"DESC"},modelForm:{modelName:"",modelRemark:"",attributes:[],modeType:"add"},tableData:[],modelDetail:{},currentRow:{},pagination:{totalPage:0,currentPage:1,pagesize:10},attributeNameRule:[{validator:function(t,a,r){for(var o=t.field.split(".")[1],i=0;i<e.modelForm.attributes.length;i++)if(i.toString()!==o&&e.modelForm.attributes[i].propertyName.trim()===a.trim()&&r(new Error("属性名称重复")),e.modelForm.attributes[i].propertyRemarks){var l=e.modelForm.attributes[i].propertyRemarks.trim(),s=a.trim();0!=l.length&&0==s.length&&r(new Error("请完善属性名"))}r()},trigger:"blur"}],searchArr:[]}},computed:{dialogWidth:function(){return window.innerWidth<=1366?"60%":"50%"}},created:function(){this.search()},mounted:function(){this.searchArr=[{id:"1",label:"品类名称",value:"modelName",type:"input"}]},methods:{sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},toSearch:function(e){this.queryParams.modelName=e.modelName,this.pagination.currentPage=1,this.search()},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeListPage",params:{typeName:this.queryParams.modelName.trim(),page:this.pagination.currentPage,rows:this.pagination.pagesize,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(t){e.tableData=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1}}).catch(function(){e.loading=!1})},del:function(e){var t=this;this.$RequestUtil.post({url:"/device/equipment/countEquipmentList",params:{equTypeId:e.id},success:function(a){a.data>0?t.$confirm("该品类下有"+a.data+"个设备,请先解除关系，再删除！","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"}):t.$confirm("确认删除?","提示",{type:"warning"}).then(function(){t.$RequestUtil.post({url:"/device/equipmentType/deleteEquipmentType",params:{id:e.id},success:function(e){t.$message.success(e.msg),t.pagination.currentPage=1,t.search()}})})}})},edit:function(e){var t=this;return n()(l.a.mark(function a(){return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.currentRow=e,t.modelForm.modelType="edit",t.modelForm.modelName=e.typeName,t.modelForm.modelRemark=e.remarks,a.next=6,t.getAttributes(e.id);case 6:t.addModel_dialogVisible=!0;case 7:case"end":return a.stop()}},a,t)}))()},openAddDialog:function(){this.modelForm.modelType="add",this.addModel_dialogVisible=!0,this.modelForm.attributes.push({propertyName:"",propertyType:"int"})},addModel_close:function(){this.modelForm.modelName="",this.modelForm.modelRemark="",this.modelForm.attributes=[],this.$refs.modelForm.clearValidate()},submitAdd:function(){var e=this;this.$refs.modelForm.validate(function(t){if(t){var a=[];e.modelForm.attributes.forEach(function(e){(e.propertyName||0===e.propertyName)&&a.push(e)});var r="/device/equipmentType/insertEquipmentType",o={typeName:e.modelForm.modelName,remarks:e.modelForm.modelRemark,typePropertyList:a};"edit"===e.modelForm.modelType&&(r="/device/equipmentType/updateEquipmentType",o.id=e.currentRow.id),e.$RequestUtil.postSync({url:r,params:o,success:function(t){e.$message.success(t.msg),e.pagination.currentPage=1,e.search(),e.addModel_dialogVisible=!1}})}})},getAttributes:function(e){var t=this;return new o.a(function(a){t.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeInfo",params:{id:e},success:function(e){t.modelForm.attributes=e.data.typePropertyList,0==t.modelForm.attributes.length&&t.modelForm.attributes.push({propertyName:"",propertyType:"int"}),a()}})})},addAttribute:function(){this.modelForm.attributes.push({propertyName:"",propertyType:"int"})},delAttribute:function(e){this.modelForm.attributes.splice(e,1)},showDetail:function(e){var t=this;this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeInfo",params:{id:e.id},success:function(e){t.modelDetail=e.data,t.detailModel_dialogVisible=!0}})},closeDetailModel:function(){this.modelDetail={}}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window"},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{"search-arr":e.searchArr},on:{clear:function(t){e.queryParams.modelName=""},search:function(t){e.toSearch(t)}}})],1),e._v(" "),e.$PERMISSION.EQUIPMENT_TYPE_WRITE?a("div",{staticClass:"operatebar"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.openAddDialog}},[e._v("新增")])],1):e._e(),e._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-sort":{prop:e.queryParams.orderColumn,order:"descending"},"header-row-class-name":"table-header-color"},on:{"sort-change":e.sortChangeEvent}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"typeName",label:"品类名称",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"remarks",label:"品类备注",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("div",[a("textareaCheckRows",{attrs:{inputType:"pre",rowClass:"value",textValue:e.row.remarks}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"gmtCreate",formatter:function(t){return e.$method.formatterTime(t.gmtCreate)},sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.showDetail(t.row)}}},[e._v("详情")]),e._v(" "),e.$PERMISSION.EQUIPMENT_TYPE_WRITE?a("span",[a("span",{staticClass:"vertical"}),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.edit(t.row)}}},[e._v("编辑")]),e._v(" "),a("span",{staticClass:"vertical"}),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.del(t.row)}}},[e._v("删除")])],1):e._e()]}}])})],1),e._v(" "),a("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],1),e._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{"close-on-click-modal":!1,title:"add"===e.modelForm.modelType?"新增品类":"编辑品类",visible:e.addModel_dialogVisible,width:e.dialogWidth},on:{"update:visible":function(t){e.addModel_dialogVisible=t},close:e.addModel_close}},[a("el-form",{ref:"modelForm",attrs:{model:e.modelForm,"label-width":"100px","label-position":"right",inline:""}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"品类名称：",prop:"modelName",rules:[{required:!0,message:"请输入品类名称",trigger:"blur"}]}},[a("el-input",{staticClass:"form__input",attrs:{maxlength:"50",placeholder:"请输入品类名称"},model:{value:e.modelForm.modelName,callback:function(t){e.$set(e.modelForm,"modelName",t)},expression:"modelForm.modelName"}})],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"品类描述："}},[a("el-input",{staticClass:"form__input",attrs:{type:"textarea",rows:3,maxlength:"200",placeholder:"最长200个字符"},model:{value:e.modelForm.modelRemark,callback:function(t){e.$set(e.modelForm,"modelRemark",t)},expression:"modelForm.modelRemark"}})],1),e._v(" "),a("br"),e._v(" "),a("el-button",{staticClass:"addBtn",attrs:{type:"primary",size:"mini"},on:{click:e.addAttribute}},[e._v("添加属性")]),e._v(" "),a("div",{staticStyle:{"max-height":"300px","overflow-y":"auto"}},e._l(e.modelForm.attributes,function(t,r){return a("div",{key:r},[a("el-form-item",{attrs:{label:"属性名称：",prop:"attributes."+r+".propertyName",rules:e.attributeNameRule}},[a("el-input",{staticClass:"form__input_small",attrs:{placeholder:"属性名称",maxlength:"20"},model:{value:t.propertyName,callback:function(a){e.$set(t,"propertyName","string"==typeof a?a.trim():a)},expression:"attribute.propertyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"属性类型："}},[a("el-select",{staticClass:"form__input_small",model:{value:t.propertyType,callback:function(a){e.$set(t,"propertyType",a)},expression:"attribute.propertyType"}},[a("el-option",{attrs:{value:"int",label:"整数"}}),e._v(" "),a("el-option",{attrs:{value:"float",label:"小数"}}),e._v(" "),a("el-option",{attrs:{value:"string",label:"字符串"}}),e._v(" "),a("el-option",{attrs:{value:"boolean",label:"是/否"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"80px",label:"备注："}},[a("textareaCheckRows",{attrs:{rowClass:"form__input",textValue:t.propertyRemarks,isReadOnly:!1},on:{"update:textValue":function(a){return e.$set(t,"propertyRemarks",a)},"update:text-value":function(a){return e.$set(t,"propertyRemarks",a)}}})],1),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.delAttribute(r)}}},[e._v("删除")])],1)}),0)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitAdd()}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"detailDialog",attrs:{"close-on-click-modal":!1,title:"品类详情",visible:e.detailModel_dialogVisible,width:"750px"},on:{"update:visible":function(t){e.detailModel_dialogVisible=t},close:e.closeDetailModel}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[e._v("品类名称：")]),e._v(" "),a("div",{staticClass:"value"},[e._v(e._s(e.modelDetail.typeName))])]),e._v(" "),a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[e._v("品类备注：")]),e._v(" "),a("textareaCheckRows",{attrs:{rowClass:"value",isEdit:!1,textValue:e.modelDetail.remarks}})],1),e._v(" "),a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[e._v("创建时间：")]),e._v(" "),a("div",{staticClass:"value"},[e._v(e._s(e.$method.formatterTime(e.modelDetail.gmtCreate)))])]),e._v(" "),a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[e._v("修改时间：")]),e._v(" "),a("div",{staticClass:"value"},[e._v(e._s(e.$method.formatterTime(e.modelDetail.gmtModified)))])]),e._v(" "),a("el-table",{attrs:{data:e.modelDetail.typePropertyList}},[a("el-table-column",{attrs:{prop:"propertyName",label:"属性名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"propertyType",label:"属性类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"propertyRemarks",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("div",[a("textareaCheckRows",{attrs:{inputType:"pre",rowClass:"value",textValue:e.row.propertyRemarks}})],1)]}}])})],1)],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(d,m,!1,function(e){a("Gpr/")},"data-v-3a8ab26e",null);t.default=u.exports},"Gpr/":function(e,t){}});