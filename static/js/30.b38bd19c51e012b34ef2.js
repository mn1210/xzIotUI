webpackJsonp([30],{A4nB:function(t,e){},JuoJ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("3cXf");var s=a("lC5x"),i=a.n(s),r=a("J0Oq"),o=a.n(r),n={components:{Pagination:a("NBFj").a},data:function(){return{methodName:"",searchForm:{jobName:"",instructId:"",jobStatus:""},queryParams:{jobName:"",instructId:"",jobStatus:"",orderColumn:"gmtModified",orderType:"DESC"},tableData:[],pagination:{currentPage:1,totalPage:0,pagesize:10},addJobDialog:!1,addJobParamsRule:null,addJobForm:{jobName:"",jobRemark:"",commandId:"",commandName:"",commandParam:"",executionTime:"",params:[{instructKVId:"",instructId:"",instructK:"",instructV:"",instructVT:""}]},commandIdList:[],commandIdOption:[],commandParamList:[],singleCommandList:[],commType:"",firmwareList:[],rulesJobForm:{jobName:[{required:!0,validator:function(t,e,a){if(""!=e){for(var s=/[\uFF00-\uFFFF]/g,i=e.split(""),r=i.length;r--;)if(s.test(i[r]))return void a(new Error("不能使用全角字符"));commonUtils.regExp.noSpecialChar(e)?a():a(new Error("不能包含特殊字符"))}else a(new Error("请输入作业名称"))},trigger:"blur"}],executionTime:[{required:!0,message:"请选择作业执行时间",trigger:"blur"},{required:!0,validator:function(t,e,a){e.getTime()<Date.now()?a(new Error("作业执行时间不能小于当前时间")):a()},trigger:"blur"}],jobRemark:[],commandId:[{required:!0,message:"请选择指令ID",trigger:"blur"}]},batchDTUValue:[],batchDTUList:[],DTUDataList:[],updateJobForm:{jobId:"",jobName:"",jobRemark:"",commandId:"",instructId:"",instructName:"",commandParam:"",executionTime:"",commType:"",params:[{instructKVId:"",instructId:"",instructK:"",instructV:"",instructVT:""}]},editJobDialog:!1,updateBatchDTU:[],batchDTUEdit:[],detailsDTUList:[],detailsForm:{},detailsPagination:{currentPage:1,totalPage:0,pagesize:10},detailsJobDialog:!1,otaCommList:[],pickerOptions1:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},commClass:"",btnAdd:!1,btnEdit:!1,sessionName:"batchJob",failReason:"",showFailDia:!1,loading:!1,searchArr:[]}},computed:{dialogWidth:function(){return window.innerWidth<=1366?"47%":"45%"},formLabelWidth:function(){return window.innerWidth<=1366?"90px":"140px"}},mounted:function(){var t=o()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.searchArr=[{id:"1",label:"作业名称",value:"jobName",type:"input",maxLen:"50"},{id:"2",label:"指令名称",value:"instructId",type:"select",data:[]},{id:"3",label:"状态",value:"jobStatus",type:"select",data:[{value:0,label:"未执行"},{value:1,label:"执行中"},{value:2,label:"已完成"},{value:3,label:"失败"}]}],this.search(),this.searchDTUList(),this.getFirmwareListNoPage(),t.next=6,this.getcommandIdList();case 6:this.searchArr[1].data=this.commandIdOption;case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:{notBeforeToday:function(t){var e=new Date;return e.setHours(0,0,0,0),t<e},sortChangeEvent:function(t){this.queryParams.orderColumn=t.order?t.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(t.order),this.pagination.currentPage=1,this.search()},pageChange:function(t){this.pagination.currentPage=t.page_index,this.pagination.pagesize=t.page_limit,this.search()},search:function(){var t=this;this.loading=!0,this.$RequestUtil.post({url:"/device/batchJobs/getBatchJobsListPage",params:{name:this.queryParams.jobName,instructId:this.queryParams.instructId,status:this.queryParams.jobStatus,page:this.pagination.currentPage,rows:this.pagination.pagesize,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(e){"success"==e.result&&(t.tableData=e.data,t.pagination.totalPage=e.totalPages,t.loading=!1)}}).catch(function(){t.loading=!1})},searchPart:function(t){this.pagination.currentPage=1,this.queryParams.jobName=t.jobName,this.queryParams.instructId=t.instructId,this.queryParams.jobStatus=t.jobStatus,this.search()},clearPart:function(){this.queryParams.jobStatus="",this.queryParams.jobName="",this.queryParams.instructId=""},addJob:function(){this.addJobDialog=!0,this.$refs.addTransfer&&(this.$refs.addTransfer.clearQuery("left"),this.$refs.addTransfer.clearQuery("right"))},getcommandIdList:function(){var t=this;this.$RequestUtil.post({url:"/device/instruct/getInstructList",params:{},success:function(e){if("success"==e.result)for(var a=[],s=[],i=0;i<e.data.length;i++){if(t.commandIdOption.push({value:e.data[i].id,label:e.data[i].instructName}),t.commandIdList.push({id:e.data[i].id,name:e.data[i].instructName,commandType:e.data[i].instructType,methodName:e.data[i].methodName}),1==e.data[i].instructType){a=e.data[i].instructContent;for(var r=0;r<a.length;r++)t.commandParamList.push({paramsName:a[r].instructK,paramsValue:a[r].instructV,paramsType:a[r].instructVT,paramsId:a[r].instructId,instructKVId:a[r].instructKVId})}if(2==e.data[i].instructType){s=e.data[i].instructContent;for(var o=0;o<s.length;o++)t.otaCommList.push({paramsName:s[o].instructK,paramsValue:s[o].instructV,paramsType:s[o].instructVT,paramsId:s[o].instructId,instructKVId:s[o].instructKVId})}}}})},getFirmwareListNoPage:function(){var t=this;this.$RequestUtil.post({url:"/device/firmware/getFirmwareListNoPage",params:{},success:function(e){if("success"==e.result)for(var a=0;a<e.data.length;a++)t.firmwareList.push({id:e.data[a].download,name:e.data[a].firmwareVersion})}})},validaSpecialCharacters:function(t,e,a){this.checkSpecificKey(e)?a():a(new Error("不能包含特殊字符"))},checkSpecificKey:function(t){for(var e=0;e<t.length;e++)if(-1!="[`~!#$^&*()=|{}':;',\\[\\].<>/?~！#￥……&*（）——|{}【】‘；：”“'。，、？]‘'".indexOf(t.substr(e,1)))return!1;return!0},resetJobAdd:function(){this.addJobDialog=!1,this.batchDTUValue=[],this.DTUDataList=[],this.commType="",this.searchDTUList();var t=this.$refs.jobAddForm;null!=t&&t.resetFields()},searchDTUList:function(){var t=this;this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{},success:function(e){t.DTUDataList=[];for(var a=0;a<e.data.length;a++)0!=e.data[a].isEnable&&t.DTUDataList.push({label:e.data[a].imei,key:e.data[a].id,fuzzyQuery:e.data[a].imei})}})},handleChange:function(t,e,a){var s=this;this.batchDTUList=[],this.batchDTUEdit=[];for(var i=[],r=function(e){s.DTUDataList.find(function(a){a.key==t[e]&&i.push({id:a.key,imei:a.label})})},o=0;o<t.length;o++)r(o);this.batchDTUList=i},handleCommandChange:function(t){var e,a=[];this.addJobForm.params=[],e=this.commandIdList.find(function(e){return e.id===t}),this.commType=e.commandType,this.commandName=e.name,this.methodName=e.methodName,this.updateJobForm.commType=e.methodName;var s=this;1==this.commType&&this.commandParamList.find(function(e){if(e.paramsId==t){var i=s.calcWidth(e.paramsName),r=i.labelWidth,o=i.contentWidth;a.push({instructK:e.paramsName,instructV:e.paramsValue,instructVT:e.paramsType,instructId:e.paramsId,instructKVId:e.instructKVId,labelWidth:r,contentWidth:o})}}),2==this.commType&&this.otaCommList.find(function(e){if(e.paramsId==t){var i=s.calcWidth(e.paramsName),r=i.labelWidth,o=i.contentWidth;a.push({instructK:e.paramsName,instructV:e.paramsValue,instructVT:e.paramsType,instructId:e.paramsId,instructKVId:e.instructKVId,labelWidth:r,contentWidth:o})}}),this.addJobForm.params=a,this.addJobForm.params.length>=3?this.commClass="commCss":this.commClass="commCss1",this.updateJobForm.params=a,this.updateJobForm.params.length>=3?this.commClass="commCss":this.commClass="commCss1"},calcWidth:function(t){var e=commonUtils.placeholderLength(t),a=e<=6?10:9,s=(e+2)*a<40?40:(e+2)*a>110?110:(e+2)*a,i=250-s;return window.innerWidth<=1366&&(i=200-(s=(e+2)*(a=e<=6?8.5:7.5)<35?35:(e+2)*a>110?110:(e+2)*a)),{labelWidth:String(s),contentWidth:String(i)}},filterMethod:function(t,e){return e.fuzzyQuery.indexOf(t)>-1},saveBatchJob:function(){var t=this;0!=this.batchDTUValue.length?this.$refs.jobAddForm.validate(function(e){e?(t.btnAdd=!0,t.$RequestUtil.post({url:"/device/batchJobs/addBatchJobs",type:"sync",params:{instructId:t.addJobForm.commandId,name:t.addJobForm.jobName,remarks:t.addJobForm.jobRemark,instructName:t.commandName,methodName:t.methodName,designatedExecuteTime:commonUtils.timestampToDate(t.addJobForm.executionTime),instructContent:t.addJobForm.params,dtuList:t.batchDTUList},success:function(e){"success"==e.result&&(t.$eventBus.$emit("batchMsg",e.data),t.$message.success(e.msg),t.btnAdd=!1,t.addJobDialog=!1,t.search())}}).catch(function(){t.btnAdd=!1})):t.btnAdd=!1}):this.$message({message:"请选择要批量作业的DTU!",type:"warning"})},detailsJob:function(t){var e=this;this.$RequestUtil.post({url:"/device/batchJobs/getBatchJobsDetails",params:{id:t.id,page:this.detailsPagination.currentPage,rows:this.detailsPagination.pagesize},success:function(a){"success"==a.result&&(e.detailsForm=t,e.detailsJobDialog=!0,e.detailsDTUList=a.data,e.detailsPagination.totalPage=a.data.length)}})},pageDetailsChange:function(t){this.detailsPagination.currentPage=t.page_index,this.detailsPagination.pagesize=t.page_limit,this.detailsJob(this.detailsForm)},editJob:function(t){var e=this;0==t.status?this.$RequestUtil.post({url:"/device/batchJobs/getBatchJobsDetails",params:{id:t.id,page:1,rows:10},success:function(a){if("success"==a.result){e.editJobDialog=!0,e.updateJobForm.jobId=t.id,e.updateJobForm.jobName=t.name,e.updateJobForm.jobRemark=t.remarks,e.updateJobForm.commandId=t.instructId.toString(),e.updateJobForm.executionTime=new Date(t.designatedExecuteTime),e.batchDTUValue=[],e.batchDTUEdit=[];var s=[];e.updateBatchDTU=[];for(var i=0;i<a.data.length;i++)e.updateBatchDTU.push(a.data[i].dtuId),e.batchDTUEdit.push({imei:a.data[i].dtuImei,id:a.data[i].dtuId}),e.updateJobForm.commType=a.data[i].instructType,e.updateJobForm.instructName=a.data[i].instructName,e.commandName=a.data[i].instructName,s=a.data[i].instructContent;for(var r=[],o=0;o<s.length;o++){var n=e.calcWidth(s[o].instructK),l=n.labelWidth,c=n.contentWidth;r.push({instructK:s[o].instructK,instructV:s[o].instructV,instructVT:s[o].instructVT,instructId:t.instructId,instructKVId:s[o].instructHistoryId,labelWidth:l,contentWidth:c})}e.updateJobForm.params=r}}}):this.$message({message:"只有未执行的作业可以更新操作",type:"warning"})},updateBatchJob:function(){var t=this;this.$refs.jobEditForm.validate(function(e){e?(t.btnEdit=!0,t.$RequestUtil.post({url:"/device/batchJobs/updateBatchJobs  ",type:"sync",params:{id:t.updateJobForm.jobId,instructId:t.updateJobForm.commandId,name:t.updateJobForm.jobName,instructName:t.commandName,methodName:t.commandName,remarks:t.updateJobForm.jobRemark,designatedExecuteTime:commonUtils.timestampToDate(t.updateJobForm.executionTime),instructContent:t.updateJobForm.params,dtuList:0==t.batchDTUList.length?t.batchDTUEdit:t.batchDTUList},success:function(e){"success"==e.result&&(t.$eventBus.$emit("batchMsg",e.data),t.$message.success(e.msg),t.btnEdit=!1,t.editJobDialog=!1,t.search())}}).catch(function(){t.btnEdit=!1,t.$message.error(res.msg)})):t.btnEdit=!1})},resetJobEdit:function(){this.editJobDialog=!1,this.updateBatchDTU=[],this.DTUDataList=[],this.searchDTUList();var t=this.$refs.jobEditForm;null!=t&&t.resetFields()},resetJobDetails:function(){this.detailsJobDialog=!1,this.updateBatchDTU=[],this.DTUDataList=[],this.detailsDTUList=[],this.searchDTUList();var t=this.$refs.jobEditForm;null!=t&&t.resetFields()},deleteJob:function(t){var e=this;0==t.status?this.$confirm("该作业是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$RequestUtil.post({url:"/device/batchJobs/deleteBatchJobs",type:"sync",params:{id:t.id},success:function(t){"success"==t.result&&(e.$message.success(t.msg),e.search())}})}).catch(function(){}):this.$message.warning("只有未执行的作业可以删除操作")},cellStyle:function(t){var e=t.row,a=t.column,s=(t.rowIndex,t.columnIndex,3==e.status?"color:#F73F3F":"");if("状态"==a.label||"执行情况"==a.label)return s},transformJobSatae:function(t){return 0==t.status?"未执行":1==t.status?"执行中":2==t.status?"已完成":3==t.status?"失败":"未知"},transformDesignatedExecut:function(t){return commonUtils.timestampToDate(t.designatedExecuteTime)},openSmallDialog:function(t){3==t.status&&(this.failReason=t.responseMessage,this.showFailDia=!0)}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list-window",attrs:{id:"batchJob"}},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{searchArr:t.searchArr},on:{clear:function(e){t.clearPart()},search:function(e){t.searchPart(e)}}})],1),t._v(" "),t.$PERMISSION.BATCH_OPERATION_WRITE?a("div",{staticClass:"operatebar"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.addJob}},[t._v("新增")])],1):t._e(),t._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark","cell-style":t.cellStyle,"default-sort":{prop:t.queryParams.orderColumn,order:"descending"}},on:{"sort-change":t.sortChangeEvent}},[a("el-table-column",{attrs:{prop:"name",label:"作业名称",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"instructName",label:"指令名称",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"designatedExecuteTime",label:"执行时间",formatter:t.transformDesignatedExecut,sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",formatter:t.transformJobSatae,label:"状态",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remarks",label:"作业备注",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("div",[a("textareaCheckRows",{attrs:{inputType:"pre",rowClass:"value",textValue:t.row.remarks}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(){return t.detailsJob(e.row)}}},[t._v("详情")]),t._v(" "),t.$PERMISSION.BATCH_OPERATION_WRITE?a("span",{staticClass:"vertical"}):t._e(),t._v(" "),t.$PERMISSION.BATCH_OPERATION_WRITE?a("el-button",{attrs:{type:"text"},on:{click:function(){return t.editJob(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),t.$PERMISSION.BATCH_OPERATION_WRITE?a("span",{staticClass:"vertical"}):t._e(),t._v(" "),t.$PERMISSION.BATCH_OPERATION_WRITE?a("el-button",{attrs:{type:"text"},on:{click:function(){return t.deleteJob(e.row)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),[a("Pagination",{attrs:{total:t.pagination.totalPage},on:{pageChange:t.pageChange}})]],2),t._v(" "),a("el-dialog",{attrs:{title:"新增批量作业",visible:t.addJobDialog,width:t.dialogWidth,"close-on-click-modal":!1,inline:!0},on:{"update:visible":function(e){t.addJobDialog=e},close:t.resetJobAdd}},[a("el-row",[a("el-form",{ref:"jobAddForm",staticClass:"demo-form-inline",staticStyle:{width:"100%"},attrs:{inline:!0,model:t.addJobForm,rules:t.rulesJobForm,"label-width":t.formLabelWidth}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"作业名称：",prop:"jobName"}},[a("el-input",{staticClass:"search-input-wat",attrs:{placeholder:"请输入作业名称"},model:{value:t.addJobForm.jobName,callback:function(e){t.$set(t.addJobForm,"jobName","string"==typeof e?e.trim():e)},expression:"addJobForm.jobName"}})],1),t._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"执行时间：",prop:"executionTime"}},[a("date-picker",{attrs:{type:"datetime","disabled-date":t.notBeforeToday,placeholder:"请选择执行时间"},model:{value:t.addJobForm.executionTime,callback:function(e){t.$set(t.addJobForm,"executionTime",e)},expression:"addJobForm.executionTime"}})],1),t._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"指令名称：",prop:"commandId"}},[a("el-select",{staticClass:"search-input-wat",attrs:{placeholder:"请选择指令名称"},on:{change:t.handleCommandChange},model:{value:t.addJobForm.commandId,callback:function(e){t.$set(t.addJobForm,"commandId",e)},expression:"addJobForm.commandId"}},t._l(t.commandIdList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"作业备注：",prop:"jobRemark"}},[a("el-input",{staticClass:"search-input-wat",attrs:{placeholder:"请输入作业备注",type:"textarea",rows:2,maxlength:"200"},model:{value:t.addJobForm.jobRemark,callback:function(e){t.$set(t.addJobForm,"jobRemark",e)},expression:"addJobForm.jobRemark"}})],1),t._v(" "),""!=t.addJobForm.commandId&&0!=t.addJobForm.params.length?a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"指令参数：",prop:"commandParam"}},[a("div",{class:t.commClass},t._l(t.addJobForm.params,function(e,s){return a("div",{key:s},[1==e.instructVT?a("el-form-item",{staticClass:"el-inputcss",attrs:{label:e.instructK+"：",prop:"params."+s+".instructV",rules:[{required:!0,message:"请输入参数值",trigger:"blur"},{pattern:/^[0-9]*$/,message:"请输入数字",trigger:"blur"}],"label-width":e.labelWidth+"px"}},[a("el-input",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}})],1):t._e(),t._v(" "),2==e.instructVT?a("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"params."+s+".instructV",rules:[{required:!0,message:"请输入参数值",trigger:"blur"},{validator:t.validaSpecialCharacters,trigger:"blur"}],label:e.instructK+"：","label-width":e.labelWidth+"px"}},[a("el-input",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}})],1):t._e(),t._v(" "),3==e.instructVT?a("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"params."+s+".instructV",label:e.instructK+"：",rules:[{required:!0,message:"请选择参数值",trigger:"change"}],"label-width":e.labelWidth+"px"}},[a("el-select",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}},[a("el-option",{attrs:{value:"true"}}),t._v(" "),a("el-option",{attrs:{value:"false"}})],1)],1):t._e(),t._v(" "),4==e.instructVT?a("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"params."+s+".instructV",rules:[{required:!0,message:"请输入参数值",trigger:"blur"},{message:"请输入小数或者整数",trigger:"blur",pattern:/^[0-9]+([.]{1}[0-9]+){0,1}$/}],label:e.instructK+"：","label-width":e.labelWidth+"px"}},[a("el-input",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}})],1):t._e()],1)}),0)]):t._e(),t._v(" "),a("div",{staticStyle:{"text-align":"center","margin-left":"0px"}},[[a("el-transfer",{ref:"addTransfer",staticStyle:{"text-align":"left",display:"inline-block"},attrs:{filterable:"","filter-method":t.filterMethod,"filter-placeholder":"请输入DTU",titles:["全部DTU","批量DTU"],data:t.DTUDataList},on:{change:t.handleChange},model:{value:t.batchDTUValue,callback:function(e){t.batchDTUValue=e},expression:"batchDTUValue"}})]],2)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:t.btnAdd},on:{click:t.saveBatchJob}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑批量作业",width:t.dialogWidth,visible:t.editJobDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.editJobDialog=e},close:t.resetJobEdit}},[a("el-row",[a("el-form",{ref:"jobEditForm",staticClass:"demo-form-inline",staticStyle:{width:"100%"},attrs:{inline:!0,model:t.updateJobForm,rules:t.rulesJobForm,"label-width":t.formLabelWidth}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"作业名称：",prop:"jobName"}},[a("el-input",{staticClass:"search-input-wat",attrs:{disabled:!0,placeholder:"请输入作业名称"},model:{value:t.updateJobForm.jobName,callback:function(e){t.$set(t.updateJobForm,"jobName","string"==typeof e?e.trim():e)},expression:"updateJobForm.jobName"}})],1),t._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"执行时间：",prop:"executionTime"}},[a("date-picker",{attrs:{type:"datetime","disabled-date":t.notBeforeToday,placeholder:"请选择执行时间"},model:{value:t.updateJobForm.executionTime,callback:function(e){t.$set(t.updateJobForm,"executionTime",e)},expression:"updateJobForm.executionTime"}})],1),t._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"指令名称：",prop:"commandId"}},[a("el-select",{staticClass:"search-input-wat",attrs:{placeholder:"请选择指令名称"},on:{change:t.handleCommandChange},model:{value:t.updateJobForm.commandId,callback:function(e){t.$set(t.updateJobForm,"commandId",e)},expression:"updateJobForm.commandId"}},t._l(t.commandIdList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"作业备注：",prop:"jobRemark"}},[a("el-input",{staticClass:"search-input-wat",attrs:{placeholder:"请输入作业备注",type:"textarea",rows:2,maxlength:"200"},model:{value:t.updateJobForm.jobRemark,callback:function(e){t.$set(t.updateJobForm,"jobRemark",e)},expression:"updateJobForm.jobRemark"}})],1),t._v(" "),t._l(t.updateJobForm.params,function(e,s){return a("div",{key:s},[2==t.updateJobForm.commType&&0!=t.updateJobForm.params.length?a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"指令参数：",prop:"params."+s+".instructV",rules:[{required:!0,message:"指令参数不能为空",trigger:"blur"}]}},[a("el-select",{staticClass:"search-input-wat",attrs:{placeholder:"请选择指令固件"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}},t._l(t.firmwareList,function(t){return a("el-option",{key:t.name,staticStyle:{width:"250px !important"},attrs:{label:t.name,value:t.id,title:t.name}})}),1)],1):t._e()],1)}),t._v(" "),1==t.updateJobForm.commType&&0!=t.updateJobForm.params.length?a("el-form-item",{attrs:{label:"指令参数：",prop:"commandParam"}},[a("div",{class:t.commClass},t._l(t.updateJobForm.params,function(e,s){return a("div",{key:s},[a("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"params."+s+".instructV",rules:[{required:!0,message:"请输入参数值",trigger:"blur"},{validator:t.validaSpecialCharacters,trigger:"blur"}],label:e.instructK+"：","label-width":e.labelWidth+"px"}},[a("el-input",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}})],1),t._v(" "),3==e.instructVT?a("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"params."+s+".instructV",label:e.instructK+"：",rules:[{required:!0,message:"请选择参数值",trigger:"change"}],"label-width":e.labelWidth+"px"}},[a("el-select",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}},[a("el-option",{attrs:{value:"true"}}),t._v(" "),a("el-option",{attrs:{value:"false"}})],1)],1):t._e(),t._v(" "),4==e.instructVT?a("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"params."+s+".instructV",rules:[{required:!0,message:"请输入参数值",trigger:"blur"},{message:"请输入小数或者整数",trigger:"change",pattern:/^[0-9]+([.]{1}[0-9]+){0,1}$/}],label:e.instructK+"：","label-width":e.labelWidth+"px"}},[a("el-input",{staticClass:"form__input_small",style:{width:e.contentWidth+"px !important"},model:{value:e.instructV,callback:function(a){t.$set(e,"instructV",a)},expression:"param.instructV"}})],1):t._e()],1)}),0)]):t._e(),t._v(" "),a("div",{staticStyle:{"text-align":"center","margin-left":"0px"}},[[a("el-transfer",{ref:"editTransfer",staticStyle:{"text-align":"left",display:"inline-block"},attrs:{filterable:"","filter-method":t.filterMethod,"filter-placeholder":"请输入DTU",titles:["全部DTU","批量DTU"],data:t.DTUDataList},on:{change:t.handleChange},model:{value:t.updateBatchDTU,callback:function(e){t.updateBatchDTU=e},expression:"updateBatchDTU"}})]],2)],2)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:t.btnEdit},on:{click:t.updateBatchJob}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"作业详情",width:"45%",visible:t.detailsJobDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.detailsJobDialog=e},close:t.resetJobDetails}},[a("el-row",[[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.detailsDTUList,"cell-style":t.cellStyle}},[a("el-table-column",{attrs:{prop:"dtuImei",label:"DTU IMEI号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"instructName",label:"指令名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"instructContent",label:"指令参数","min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.instructContent,function(s,i){return a("div",{key:i},[t._v("\n                "+t._s(e.row.instructContent[i].instructK+"："+e.row.instructContent[i].instructV)+"\n              ")])})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"designatedExecuteTime",label:"执行时间","min-width":"130"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"执行情况"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{class:3==e.row.status?"cursorP colorRed":"",on:{click:function(a){return t.openSmallDialog(e.row)}}},[t._v("\n                "+t._s(0==e.row.status?"未执行":1==e.row.status?"执行中":2==e.row.status?"已完成":3==e.row.status?"失败":"未知")+"\n              ")])]}}])})],1)],t._v(" "),[a("Pagination",{attrs:{total:t.detailsPagination.totalPage},on:{pageChange:t.pageDetailsChange}})],t._v(" "),a("el-dialog",{staticClass:"failDialog",attrs:{title:"失败原因",visible:t.showFailDia,width:"20%","append-to-body":""},on:{"update:visible":function(e){t.showFailDia=e},close:function(e){t.showFailDia=!1}}},[a("div",[t._v(t._s(this.failReason))]),t._v(" "),a("div",{staticStyle:{display:"flex","justify-content":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showFailDia=!1}}},[t._v("关闭")])],1)])],2)],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,l,!1,function(t){a("A4nB"),a("yDzm")},"data-v-08c874bf",null);e.default=c.exports},yDzm:function(t,e){}});