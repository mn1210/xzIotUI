webpackJsonp([31],{"+nD8":function(e,t){},TM5Z:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("ZLEe"),r=i.n(a),s={name:"devicelist",data:function(){return{currentRow:{},addrLoading:!1,addrOption:[],loading:!1,centerDialogVisible:!1,editModalShow:!1,searchForm:{dtuImei:"",dtuStatus:""},queryParams:{dtuImei:"",dtuStatus:"",orderColumn:"",orderType:"DESC"},pagination:{currentPage:1,totalPage:0,pagesize:10},addForm:{imei:"",iccid:"",platform:"",addr:""},rules:{imei:[{required:!0,message:"请输入IMEI号",trigger:"blur"},{pattern:/^[^\u4e00-\u9fa5]{0,}$/,message:"不能输入中文"},{validator:function(e,t,i){void 0==t||commonUtils.regExp.noSpecialChar(t.toString().trim())||i(new Error("不能有特殊字符")),i()},trigger:"blur"}],iccid:[{pattern:/^[^\u4e00-\u9fa5]{0,}$/,message:"不能输入中文"},{validator:function(e,t,i){void 0==t||commonUtils.regExp.noSpecialChar(t.toString().trim())||i(new Error("不能有特殊字符")),i()},trigger:"blur"}],addr:[{required:!0,message:"请输入地址",trigger:"change"}]},editForm:{imei:"",iccid:"",id:"",addr:""},editRules:{imei:[{required:!0,message:"请输入IMEI号",trigger:"blur"},{pattern:/^[^\u4e00-\u9fa5]{0,}$/,message:"不能输入中文"},{validator:function(e,t,i){void 0==t||commonUtils.regExp.noSpecialChar(t.toString().trim())||i(new Error("不能有特殊字符")),i()},trigger:"blur"}],iccid:[{pattern:/^[^\u4e00-\u9fa5]{0,}$/,message:"不能输入中文"},{validator:function(e,t,i){void 0==t||commonUtils.regExp.noSpecialChar(t.toString().trim())||i(new Error("不能有特殊字符")),i()},trigger:"blur"}],addr:[{required:!0,message:"请输入地址",trigger:"blur"}]},tableData:[],searchArr:[],choicedAddress:{},addrObj:{}}},components:{},computed:{labelWidth:function(){return window.innerWidth<=1366?"75px":"80px"},dialogLabelWidth:function(){return window.innerWidth<=1366?"85px":"100px"}},mounted:function(){this.searchArr=[{id:"1",label:"DTU IMEI",value:"dtuImei",type:"input",maxLen:"50"},{id:"2",label:"DTU状态",value:"dtuStatus",type:"select",data:[{label:"在线",value:"1"},{label:"离线",value:"4"},{label:"未激活",value:"0"}]}],this.search()},methods:{sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},searchPart:function(e){this.pagination.currentPage=1,this.queryParams.dtuImei=e.dtuImei,this.queryParams.dtuStatus=e.dtuStatus,this.search()},changeEnable:function(e,t,i){var a=this;this.$confirm("是否"+i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$RequestUtil.post({url:"/device/dtu/upIsEnable",params:{id:e.id,isEnable:1^e.isEnable},success:function(i){"success"==i.result?(a.$message.success(i.msg),a.tableData[t].isEnable=1^e.isEnable,a.pagination.currentPage=1,a.search()):a.$message.error(i.msg)}})})},handleSelectionChange:function(e){this.multipleSelection=e},loadOrg:function(e,t,i){var a=this;i.forEach(function(s){if(s.parentId==t&&0!=s.type){r()(e).includes("list")||(e.list=[]);var o=e.list;o.push(s),a.loadOrg(o[o.length-1],s.id,i)}})},clear:function(e){this.queryParams.dtuImei="",this.queryParams.dtuStatus=""},linkTo:function(e){this.$router.push({path:"/Dtu/DtuList/DtuDetails",name:"DtuDetails",query:{id:e.id}})},formatterState:function(e){var t="";switch(e.status){case 0:t="未激活";break;case 1:t="在线";break;case 2:t="设备离线";break;case 3:t="数据未上传";break;case 4:t="离线"}return t},search:function(){var e=this;this.$RequestUtil.post({url:"/device/dtu/getDtuListPage",params:{page:this.pagination.currentPage,rows:this.pagination.pagesize,imei:this.queryParams.dtuImei,status:this.queryParams.dtuStatus,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(t){e.tableData=t.data,e.loading=!1,e.pagination.totalPage=t.totalPages}})},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},del:function(e){var t=this;this.$RequestUtil.post({url:"/device/dtu/getEquipCountByDtuId",type:"sync",params:{id:e.id},success:function(i){if("success"==i.result){if(i.data>0)return void t.$confirm("该DTU下有"+i.data+"个设备,请先解除关系，再删除！","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"});t.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$RequestUtil.post({url:"/device/dtu/deleteDtu",type:"sync",params:{id:e.id},success:function(e){"success"==e.result?(t.pagination.currentPage=1,t.search(),t.$message({type:"success",message:e.msg})):t.$message({type:"error",message:e.msg})}})}).catch(function(){})}else t.$message({type:"error",message:e.msg})}})},handleClick:function(e){this.editModalShow=!0,this.currentRow=e,this.addrObj.address=e.address,this.addrObj.longitude=e.longitude,this.addrObj.latitude=e.latitude,this.editForm.platform=e.platform,this.editForm.id=e.id,this.editForm.imei=e.imei,this.editForm.iccid=e.iccid,this.editForm.addr=e.address},editSub:function(e){var t=this;this.$refs[e].validate(function(i){i&&t.$RequestUtil.postSync({url:"/device/dtu/updateDtu",params:{id:t.editForm.id,imei:t.editForm.imei,iccid:t.editForm.iccid,address:t.choicedAddress},type:"sync",success:function(i){"success"==i.result?(t.resetForm(e),t.$message({type:"success",message:i.msg}),t.pagination.currentPage=1,t.search()):t.$message({type:"error",message:i.msg})}})})},submitForm:function(e){var t=this;this.$refs[e].validate(function(i){if(!i)return!1;t.$RequestUtil.postSync({url:"/device/dtu/insertDtu",params:{imei:t.addForm.imei,iccid:t.addForm.iccid,address:t.choicedAddress},type:"sync",success:function(i){"success"==i.result?(t.resetForm(e),t.$message({type:"success",message:i.msg}),t.pagination.currentPage=1,t.search()):t.$message({type:"error",message:i.msg})}})})},resetForm:function(e){this.$refs[e].resetFields(),this.editModalShow=!1,this.centerDialogVisible=!1,this.choicedAddress={},this.editForm.addr=""}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"list-window treeDiv"},[i("el-dialog",{attrs:{"close-on-click-modal":!1,title:"新增DTU",visible:e.centerDialogVisible,width:"30%"},on:{"update:visible":function(t){e.centerDialogVisible=t},close:function(t){return e.resetForm("addForm")}}},[i("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules,"label-width":e.dialogLabelWidth,"label-position":"right"}},[i("el-form-item",{staticClass:"add-from el-inputcss",attrs:{label:"IMEI号：",prop:"imei"}},[i("el-input",{staticClass:"add-input",attrs:{placeholder:"请输入IMEI号",maxlength:50},model:{value:e.addForm.imei,callback:function(t){e.$set(e.addForm,"imei","string"==typeof t?t.trim():t)},expression:"addForm.imei"}})],1),e._v(" "),i("el-form-item",{staticClass:"add-from el-inputcss",attrs:{label:"Iccid：",prop:"iccid"}},[i("el-input",{staticClass:"add-input",attrs:{placeholder:"请输入Iccid",maxlength:50},model:{value:e.addForm.iccid,callback:function(t){e.$set(e.addForm,"iccid","string"==typeof t?t.trim():t)},expression:"addForm.iccid"}})],1),e._v(" "),i("el-form-item",{staticClass:"add-from el-inputcss",attrs:{label:"地址：",prop:"addr"}},[i("addressChoice",{attrs:{model:e.addForm.addr,oriAddr:e.choicedAddress,rowClass:"add-input"},on:{"update:model":function(t){return e.$set(e.addForm,"addr",t)},"update:oriAddr":function(t){e.choicedAddress=t},"update:ori-addr":function(t){e.choicedAddress=t}}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("addForm")}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{"close-on-click-modal":!1,title:"编辑DTU",visible:e.editModalShow,width:"30%"},on:{"update:visible":function(t){e.editModalShow=t}}},[i("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":e.dialogLabelWidth,"label-position":"right"}},[i("el-form-item",{staticClass:"edit-form el-inputcss",attrs:{label:"IMEI号：",prop:"imei"}},[i("el-input",{staticClass:"add-input",attrs:{disabled:"",maxlength:50,placeholder:"请输入IMEI号"},model:{value:e.editForm.imei,callback:function(t){e.$set(e.editForm,"imei","string"==typeof t?t.trim():t)},expression:"editForm.imei"}})],1),e._v(" "),i("el-form-item",{staticClass:"edit-form el-inputcss",attrs:{label:"Iccid：",prop:"iccid"}},[i("el-input",{staticClass:"add-input",attrs:{maxlength:50,placeholder:"请输入Iccid"},model:{value:e.editForm.iccid,callback:function(t){e.$set(e.editForm,"iccid","string"==typeof t?t.trim():t)},expression:"editForm.iccid"}})],1),e._v(" "),i("el-form-item",{staticClass:"add-from el-inputcss",attrs:{label:"地址：",prop:"addr"}},[i("addressChoice",{attrs:{oriData:e.addrObj,model:e.editForm.addr,oriAddr:e.choicedAddress,rowClass:"add-input"},on:{"update:model":function(t){return e.$set(e.editForm,"addr",t)},"update:oriAddr":function(t){e.choicedAddress=t},"update:ori-addr":function(t){e.choicedAddress=t}}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editSub("editForm")}}},[e._v("确 定")])],1)],1),e._v(" "),i("div",{staticClass:"searchbar"},[i("searchInput",{attrs:{searchArr:e.searchArr},on:{clear:function(t){e.clear()},search:function(t){e.searchPart(t)}}})],1),e._v(" "),e.$PERMISSION.DTU_WRITE?i("div",{staticClass:"operatebar cz-btn"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v("新增")])],1):e._e(),e._v(" "),i("div",{staticClass:"list-div"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent,"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{prop:"imei",label:"DTU IMEI",align:"left",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{prop:"firmwareVersionName",label:"固件版本",align:"left",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{prop:"status",label:"运行状态",align:"left",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{class:1==t.row.status?"colorGreen":4==t.row.status?"colorRed":""},[e._v("\n            "+e._s(e.formatterState(t.row))+"\n          ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"isEnable",label:"状态",align:"left",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{class:1==t.row.isEnable?"colorGreen":"colorRed"},[e._v("\n            "+e._s(1==t.row.isEnable?"启用":"禁用")+"\n          ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"设备绑定",prop:"countEquipment",formatter:function(e){return e.countEquipment>0?"是":"否"},align:"left",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",align:"left",width:"290"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.linkTo(t.row)}}},[e._v("详情")]),e._v(" "),e.$PERMISSION.DTU_WRITE?i("span",[i("span",{staticClass:"vertical"}),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.handleClick(t.row)}}},[e._v("编辑")]),e._v(" "),i("span",{staticClass:"vertical"}),e._v(" "),t.row.isEnable?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.changeEnable(t.row,t.$index,"禁用")}}},[e._v("禁用")]):i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.changeEnable(t.row,t.$index,"启用")}}},[e._v("启用")]),e._v(" "),i("span",{staticClass:"vertical"}),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.del(t.row)}}},[e._v("删除")])],1):e._e()]}}])})],1),e._v(" "),i("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],1)],1)},staticRenderFns:[]};var n=i("C7Lr")(s,o,!1,function(e){i("cD24"),i("+nD8")},"data-v-04f1b600",null);t.default=n.exports},cD24:function(e,t){}});