webpackJsonp([38],{"45/o":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("3cXf"),r=a.n(i),s=a("ZLEe"),n=a.n(s),o=a("lC5x"),l=a.n(o),p=a("J0Oq"),u=a.n(p),c={data:function(){var e=function(e,t,a){commonUtils.regExp.noSpecialChar(t)||a("有特殊字符"),a()};return{searchArr:[],modelList:[],tableData:[],loading:!1,tableArr:[],isShowDialog:!1,pagination:{totalPage:0,currentPage:1,pagesize:10},queryParams:{kpiKey:"",kpiName:"",equTypeId:"",orderColumn:"gmtModified",orderType:"DESC"},dialogTitle:"",dialogType:"",setForm:{kpiKey:"",kpiName:"",equTypeId:"",kpiUnit:"",kpiDataType:"1",kpiRemarks:""},setFormCZ:{kpiKey:"",kpiName:"",equTypeId:"",kpiUnit:"",kpiDataType:"1",kpiRemarks:""},dataTypeArr:[{value:"1",label:"整数"},{value:"2",label:"小数"},{value:"3",label:"是否"},{value:"4",label:"字符串"}],rules:{kpiKey:[{required:!0,message:"请填入键名",trigger:"blur"},{validator:e,trigger:"blur"},{validator:function(e,t,a){0==/^[A-Za-z]/.test(t)&&a(new Error("字母开头")),0==/^[A-Za-z][A-Za-z0-9]{0,50}$/.test(t)&&a(new Error("字母或数值")),a()},trigger:"blur"}],kpiName:[{required:!0,message:"请填入名称",trigger:"blur"},{validator:e,trigger:"blur"}],equTypeId:[{required:!0,message:"请填入设备品类",trigger:"change"}],kpiUnit:[{required:!0,message:"请填入单位",trigger:"blur"}],kpiDataType:[{required:!0,message:"请填入数据类型",trigger:"change"}],kpiRemarks:[]},isDisabled:!1,hasPoint:3}},computed:{transKpiDataType:function(){var e=this;return function(t){return e.dataTypeArr.filter(function(e){return e.value==t.kpiDataType})[0].label}}},mounted:function(){var e=u()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searchArr=[{id:"1",label:"键名",value:"kpiKey",type:"input",maxLen:"50"},{id:"2",label:"名称",value:"kpiName",type:"input",maxLen:"50"},{id:"3",label:"设备品类",value:"equTypeId",type:"select",data:[]}],this.tableArr=[{id:"1",label:"键名",prop:"kpiKey",width:"100"},{id:"2",label:"名称",prop:"kpiName",width:"100"},{id:"3",label:"单位",prop:"kpiUnit",width:"100"},{id:"4",label:"数据类型",prop:"kpiDataType",width:"100"},{id:"5",label:"设备品类",prop:"typeName",width:"100"},{id:"6",label:"备注",prop:"kpiRemarks",width:"120"}],this.search(),e.next=5,this.getModelList();case 5:this.searchArr[2].data=this.modelList;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{getModelList:function(){var e=this;return this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.typeName,value:e.id,equipmentTypeContent:e.equipmentTypeContent})}),e.modelList=a}})},sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?"typeName"==e.prop?"equTypeId":e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},searchPart:function(e){var t=this;this.pagination.currentPage=1,n()(e).forEach(function(a){t.queryParams[a]=e[a]}),this.search()},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/kpi/getKpiListPage",params:{kpiKey:this.queryParams.kpiKey,kpiName:this.queryParams.kpiName,equTypeId:this.queryParams.equTypeId,page:this.pagination.currentPage,rows:this.pagination.pagesize,orderType:this.queryParams.orderType,orderColumn:this.queryParams.orderColumn},success:function(t){e.tableData=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1,e.$nextTick(function(){})}}).catch(function(){e.loading=!1})},clearPart:function(e){var t=this;n()(e).forEach(function(a){t.queryParams[a]=e[a]})},openDialog:function(e,t){var a=this;return u()(l.a.mark(function i(){return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a.isDisabled=!1,a.dialogType=e,"create"!=e){i.next=6;break}a.dialogTitle="新增KPI",i.next=10;break;case 6:return a.dialogTitle="编辑KPI",a.tableData.forEach(function(e){t==e.id&&(e.equTypeId=String(e.equTypeId),e.kpiDataType=String(e.kpiDataType),a.setForm=JSON.parse(r()(e)))}),i.next=10,a.$RequestUtil.post({url:"/device/kpi/getEquipmentPointCountByKpiId",params:{id:t},success:function(e){"success"==e.result?a.hasPoint=e.data:a.$message({message:"查询该KPI是否有被点位使用出错",type:"error"})}});case 10:a.isShowDialog=!0,a.$nextTick(function(){a.$refs.setForm.clearValidate()});case 12:case"end":return i.stop()}},i,a)}))()},closeDialog:function(){this.setForm=JSON.parse(r()(this.setFormCZ)),this.hasPoint=3,this.isShowDialog=!1},saveKpi:function(){var e=this;this.isDisabled=!0,this.$refs.setForm.validate(function(t){if(t){var a="create"==e.dialogType?"/device/kpi/addKpi":"/device/kpi/updateKpi",i={kpiKey:e.setForm.kpiKey,kpiName:e.setForm.kpiName,kpiUnit:e.setForm.kpiUnit,kpiDataType:e.setForm.kpiDataType,equTypeId:e.setForm.equTypeId,kpiRemarks:e.setForm.kpiRemarks};"change"==e.dialogType&&(i.id=e.setForm.id),e.$RequestUtil.post({url:a,params:i,success:function(t){var a="warn"==t.result?"waring":t.result;e.$message({type:a,message:t.msg}),"success"==t.result&&(e.isShowDialog=!1,e.pagination.currentPage=1,e.search()),e.isDisabled=!1},error:function(t){e.isDisabled=!1}})}else e.isDisabled=!1})},isPointUsed:function(e){var t=this;this.$RequestUtil.post({url:"/device/kpi/getEquipmentPointCountByKpiId",params:{id:e},success:function(a){if("success"==a.result){var i=void 0;switch(a.data){case 0:i="该KPI已被点位配置应用,删除后不再采集此kpi数据，是否删除?";break;case 1:i="该KPI已被点位模板应用,删除会影响功能，是否删除? ";break;case 2:i="该KPI已被点位配置和点位模板应用，删除后不再采集此kpi数据，是否删除?";break;default:i="是否删除？"}t.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.delKpi(e)}).catch()}}})},delKpi:function(e){var t=this;this.$RequestUtil.post({url:"/device/kpi/deleteKpi",params:{id:e},success:function(e){var a="warn"==e.result?"waring":e.result;t.$message({type:a,message:e.msg}),"success"==e.result&&(1==t.tableData.length&&(t.pagination.currentPage=t.pagination.currentPage-1==0?1:t.pagination.currentPage-1),t.search())}})},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window",attrs:{id:"kpiList"}},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{searchArr:e.searchArr},on:{clear:function(t){e.clearPart(t)},search:function(t){e.searchPart(t)},querySelect:function(t){var a=t.queryString,i=t.cb;e.queryBindDtu(a,i)}}})],1),e._v(" "),e.$PERMISSION.KPI_WRITE?a("div",{staticClass:"operatebar"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.openDialog("create","")}}},[e._v("新增")])],1):e._e(),e._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-row-class-name":"table-header-color","default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent}},[e._l(e.tableArr,function(t){return a("el-table-column",{key:t.id,attrs:{prop:t.prop,label:t.label,"min-width":t.width,"show-overflow-tooltip":t.ellipsis,sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("div",["kpiRemarks"==t.prop?a("textareaCheckRows",{attrs:{inputType:"pre",textValue:i.row.kpiRemarks},on:{"update:textValue":function(t){return e.$set(i.row,"kpiRemarks",t)},"update:text-value":function(t){return e.$set(i.row,"kpiRemarks",t)}}}):"kpiDataType"==t.prop?a("div",[e._v(e._s(e.transKpiDataType(i.row)))]):a("div",[e._v(e._s(i.row[t.prop]))])],1)]}}],null,!0)})}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.openDialog("change",t.row.id)}}},[e._v("编辑")]),e._v(" "),a("span",{staticClass:"vertical"}),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.isPointUsed(t.row.id)}}},[e._v("删除")])]}}])})],2),e._v(" "),a("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.isShowDialog,width:"28%","close-on-click-modal":!1},on:{"update:visible":function(t){e.isShowDialog=t},close:e.closeDialog}},[a("div",[a("el-form",{ref:"setForm",attrs:{model:e.setForm,"label-width":"100px",rules:e.rules}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"键名：",prop:"kpiKey"}},[a("el-input",{staticClass:"form__input",attrs:{placeholder:"请输入键名，如：temperature",maxlength:"50",disabled:"change"==this.dialogType},model:{value:e.setForm.kpiKey,callback:function(t){e.$set(e.setForm,"kpiKey",t)},expression:"setForm.kpiKey"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"名称：",prop:"kpiName"}},[a("el-input",{staticClass:"form__input",attrs:{placeholder:"请输入名称，如：温度",maxlength:"50"},model:{value:e.setForm.kpiName,callback:function(t){e.$set(e.setForm,"kpiName",t)},expression:"setForm.kpiName"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"单位：",prop:"kpiUnit"}},[a("el-input",{staticClass:"form__input",attrs:{placeholder:"请输入单位，如：摄氏度",maxlength:"50"},model:{value:e.setForm.kpiUnit,callback:function(t){e.$set(e.setForm,"kpiUnit",t)},expression:"setForm.kpiUnit"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"数据类型：",prop:"kpiDataType"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请选择数据类型"},model:{value:e.setForm.kpiDataType,callback:function(t){e.$set(e.setForm,"kpiDataType",t)},expression:"setForm.kpiDataType"}},e._l(e.dataTypeArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备品类：",prop:"equTypeId"}},[a("el-select",{staticClass:"form__input",attrs:{placeholder:"请选择设备品类",disabled:e.hasPoint<3},model:{value:e.setForm.equTypeId,callback:function(t){e.$set(e.setForm,"equTypeId",t)},expression:"setForm.equTypeId"}},e._l(e.modelList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"备注：",prop:"kpiRemarks"}},[a("el-input",{staticClass:"form__input",attrs:{type:"textarea",placeholder:"请输入备注",maxlength:"255"},model:{value:e.setForm.kpiRemarks,callback:function(t){e.$set(e.setForm,"kpiRemarks",t)},expression:"setForm.kpiRemarks"}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:e.isDisabled},on:{click:e.saveKpi}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var m=a("C7Lr")(c,d,!1,function(e){a("OvY4")},"data-v-7da9ac9f",null);t.default=m.exports},OvY4:function(e,t){}});