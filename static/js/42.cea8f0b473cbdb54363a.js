webpackJsonp([42],{EbYj:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("ZLEe"),r=a.n(s),i=a("lC5x"),n=a.n(i),o=a("J0Oq"),u=a.n(o),l=a("+qDl"),c=a.n(l),h={name:"dataCollection",data:function(){return{loading:!1,tableData:[],payload:[],searchForm:{equNameName:"",equTypeId:"",equAreaId:"",equProject:""},queryParams:{equNameName:"",equTypeId:"",equAreaId:"",equProject:"",orderColumn:"eventTime",orderType:"DESC"},equCodeList:[],equNameList:[],equTypeNameList:[],equAreaList:[],equProjectList:[],pagination:{currentPage:1,totalPage:0,pagesize:10},showMoreData:!1,dialogDataContent:[],styleSear:"style-sear1",btnBoxShow:!1,hidebtn:!1,showbtn:!0,searchclass:"",showTimeRangePanel:!1,searchArr:[]}},mounted:function(){var e=u()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searchArr=[{id:"1",label:"设备名称",value:"equNameName",type:"autoInput"},{id:"2",label:"设备品类",value:"equTypeId",type:"select",data:[]},{id:"3",label:"设备区域",value:"equAreaId",type:"select",data:[]},{id:"4",label:"设备项目",value:"equProject",type:"select",data:[]},{id:"5",label:"采集时间",value:"date",type:"date"}],this.search(),this.searchEquNameList(),e.next=5,this.getEquTypeList();case 5:return e.next=7,this.getEquAreaList();case 7:return e.next=9,this.getEquProjectList();case 9:this.searchArr[1].data=this.equTypeNameList,this.searchArr[2].data=this.equAreaList,this.searchArr[3].data=this.equProjectList;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{toggleTimeRangePanel:function(){this.showTimeRangePanel=!this.showTimeRangePanel},handleRangeClose:function(){this.showTimeRangePanel=!1},sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"eventTime",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},show:function(){this.hidebtn=!0,this.showbtn=!1,this.btnBoxShow=!0,this.searchclass="serheightZ",this.styleSear="style-sear"},hide:function(){this.hidebtn=!1,this.showbtn=!0,this.btnBoxShow=!1,this.searchclass="serheightS",this.styleSear="style-sear1"},openMoreDataDialog:function(e){e.length<=3||(this.dialogDataContent=e,this.showMoreData=!0)},closeDialog:function(){this.showMoreData=!1,this.dialogDataContent=[]},btnSearch:function(e){var t=this;this.pagination.currentPage=1,r()(e).forEach(function(a){t.queryParams[a]=e[a]}),null!=this.queryParams.date&&null!=this.queryParams.date[0]&&null!=this.queryParams.date[1]?(this.queryParams.startTime=commonUtils.translateTimeStrToUTC(this.queryParams.date[0]),this.queryParams.endTime=commonUtils.translateTimeStrToUTC(this.queryParams.date[1])):(this.queryParams.startTime="",this.queryParams.endTime=""),this.search()},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},querySearchName:function(e,t){var a=this.equNameList;t(e?a.filter(this.createFilter(e)):a)},searchEquNameList:function(){var e=this;this.$RequestUtil.post({url:"/device/equipment/getEquipmentNameList",params:{},success:function(t){for(var a=0;a<t.data.length;a++)e.equNameList.push({value:t.data[a].equName,name:t.data[a].equName})}})},createFilter:function(e){return function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1}},getEquTypeList:function(){var e=this;return this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.typeName,value:e.id})}),e.equTypeNameList=a}})},getEquAreaList:function(){var e=this;return this.$RequestUtil.post({url:"/device/area/getAreaList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.areaName,value:e.id})}),e.equAreaList=a}})},getEquProjectList:function(){var e=this;return this.$RequestUtil.post({url:"/device/project/getProjectList",params:{},success:function(t){var a=[];t.data.forEach(function(e){a.push({label:e.projectName,value:e.id})}),e.equProjectList=a}})},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/dataCollection/getDataHistoryListPage",params:{page:this.pagination.currentPage,rows:this.pagination.pagesize,startTime:this.queryParams.startTime,endTime:this.queryParams.endTime,equName:this.queryParams.equNameName,equTypeId:this.queryParams.equTypeId,areaId:this.queryParams.equAreaId,projectId:this.queryParams.equProject,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(t){"success"==t.result&&(t.data.forEach(function(e){e.eventTime=c()(e.eventTime).add(8,"hours")}),e.tableData=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1)}})},derive:function(e){var t=this;e&&(this.loading=!0,this.$RequestUtil.post({url:"/device/dataCollection/exportDataHistoryExcel",params:{startTime:this.queryParams.startTime,endTime:this.queryParams.endTime,equName:this.queryParams.equNameName,equTypeId:this.queryParams.equTypeId,areaId:this.queryParams.equAreaId,projectId:this.queryParams.equProject},success:function(e){a.e(53).then(function(){var s=a("iFss").export_json_to_excel,r=e.data.map(function(e){return e.eventTime=c()(e.eventTime).add(8,"hours").format("YYYY-MM-DD HH:mm:ss"),e});s(["设备编号","设备名称","设备品类","设备项目","采集时间","数据内容"],t.formatJson(["equCode","equName","equTypeName","projectName","eventTime","payLoad"],r),"列表excel")}.bind(null,a)).catch(a.oe),t.loading=!1}}))},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return t[e]})})},refreshs:function(e){var t=this;r()(e).forEach(function(a){t.queryParams[a]=e[a]})},initTable:function(){this.search()},parseTime:function(e){return e?c()(e.eventTime).format("YYYY-MM-DD HH:mm:ss"):""}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window",attrs:{id:"DataHis"}},[a("div",{staticStyle:{width:"100%",heigh:"100%"}},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{"search-arr":e.searchArr,"execl-output":!0},on:{exportExecl:e.derive,clear:function(t){e.refreshs(t)},search:function(t){e.btnSearch(t)},querySelect:function(t){var a=t.queryString,s=t.cb;e.querySearchName(a,s)}}})],1),e._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent}},[a("el-table-column",{attrs:{prop:"equCode",label:"设备编号",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"equName",label:"设备名称",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"equTypeName",label:"设备品类",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"projectName",label:"设备项目",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{formatter:function(t){return e.$method.formatterTime(t.eventTime)},prop:"eventTime",label:"采集时间",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:"数据内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("p",{staticClass:"scopeItem"},[e._v("\n                  "+e._s(t.row.kpiName)+": "+e._s(t.row.kpiValue)+" "+e._s(t.row.kpiUnit)+" "),a("br")])])]}}])})],1),e._v(" "),[a("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],e._v(" "),a("el-dialog",{attrs:{title:"数据内容",visible:e.showMoreData,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showMoreData=t},close:e.closeDialog}},[a("el-scrollbar",{staticClass:"dialogScroll"},[a("div",{staticClass:"dialogContent"},e._l(e.dialogDataContent,function(t,s){return a("div",{key:s,staticClass:"dialogContentOne"},[e._v("\n              "+e._s(t.kpiName)+": "+e._s(t.kpiValue)+" "+e._s(t.kpiUnit)+" \n            ")])}),0)]),e._v(" "),a("div",{staticClass:"flexCenter",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeDialog}},[e._v("关闭")])],1)],1)],2)])])},staticRenderFns:[]};var d=a("C7Lr")(h,m,!1,function(e){a("Knoo")},"data-v-61953b88",null);t.default=d.exports},Knoo:function(e,t){}});