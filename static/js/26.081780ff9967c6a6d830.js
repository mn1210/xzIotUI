webpackJsonp([26],{cAZU:function(t,e){},idyd:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("ZLEe"),i=a.n(s),r=a("rVsN"),n=a.n(r),o=a("lC5x"),l=a.n(o),u=a("J0Oq"),c=a.n(u),d={data:function(){return{dialogVisible:!1,tableData:[],searchform:{dtuImei:"",commandName:"",date:"",states:"",startTime:"",endTime:"",responseMessage:""},queryParams:{responseMessage:"",dtuImei:"",commandName:"",date:"",states:"",startTime:"",endTime:"",orderColumn:"designatedExecuteTime",orderType:"DESC"},pagination:{currentPage:1,totalPage:0,pagesize:10},DTUIMEIList:[],commandNameList:[],detailsDialog:!1,detailsForm:{dtuImei:"",commandName:"",responseMessage:"",setExecutionTime:"",executionTime:"",endTime:"",executionResult:"",sender:"",paramsTableData:[]},sessionName:"comHistory",loading:!1,styleSear:"style-sear1",btnBoxShow:!1,hidebtn:!1,showbtn:!0,searchclass:"",showTimeRangePanel:!1,searchArr:[]}},computed:{},beforeCreate:function(){},created:function(){},beforeMount:function(){},mounted:function(){var t=c()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.searchArr=[{id:"1",label:"DTU IMEI",value:"dtuImei",type:"select",data:[]},{id:"2",label:"指令名称",value:"commandName",type:"select",data:[]},{id:"3",label:"状态",value:"states",type:"select",data:[{value:0,label:"未执行"},{value:1,label:"执行中"},{value:2,label:"已完成"},{value:3,label:"失败"}]},{id:"4",label:"时间范围",value:"date",type:"date"}],this.search(),t.next=4,this.getcommandIdList();case 4:return t.next=6,this.searchDTUList();case 6:this.searchArr[0].data=this.DTUIMEIList,this.searchArr[1].data=this.commandNameList;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},methods:{toggleTimeRangePanel:function(){this.showTimeRangePanel=!this.showTimeRangePanel},handleRangeClose:function(){this.showTimeRangePanel=!1},sortChangeEvent:function(t){this.queryParams.orderColumn=t.order?t.prop:"designatedExecuteTime",this.queryParams.orderType=commonUtils.changeOrderType(t.order),this.pagination.currentPage=1,this.search()},pageChange:function(t){this.pagination.currentPage=t.page_index,this.pagination.pagesize=t.page_limit,this.search()},getcommandIdList:function(){var t=this;return this.$RequestUtil.post({url:"/device/instruct/getInstructList",params:{},success:function(e){if("success"==e.result){t.commandNameList=[];for(var a=0;a<e.data.length;a++)t.commandNameList.push({value:e.data[a].id,label:e.data[a].instructName})}}})},searchDTUList:function(){var t=this;this.$RequestUtil.post({url:"/device/dtu/getDtuList",params:{},success:function(e){if("success"==e.result)for(var a=0;a<e.data.length;a++)t.DTUIMEIList.push({value:e.data[a].id,label:e.data[a].imei})}})},search:function(){var t=this;return this.loading=!0,new n.a(function(e,a){t.$RequestUtil.post({url:"/device/instruct/getInstructHistoryListPage",params:{instructId:t.queryParams.commandName,dtuId:t.queryParams.dtuImei,status:t.queryParams.states,startTime:t.queryParams.startTime,endTime:t.queryParams.endTime,page:t.pagination.currentPage,rows:t.pagination.pagesize,orderColumn:t.queryParams.orderColumn,orderType:t.queryParams.orderType},success:function(s){"success"==s.result&&(e(s),t.tableData=s.data,t.pagination.totalPage=s.totalPages,t.loading=!1),a(t.loading=!1)}})})},searchPart:function(t){var e=this;i()(t).forEach(function(a){e.queryParams[a]=t[a]}),this.queryParams.startTime=this.queryParams.date?this.queryParams.date[0]:"",this.queryParams.endTime=this.queryParams.date?this.queryParams.date[1]:"",this.pagination.currentPage=1,this.search()},clearPart:function(t){var e=this;i()(t).forEach(function(a){e.queryParams[a]=t[a]})},transformCommSataes:function(t){return 0==t.status?"未执行":1==t.status?"执行中":2==t.status?"已完成":3==t.status?"失败":"未知"},detailsCommand:function(t){this.detailsForm.dtuImei=t.dtuImei,this.detailsForm.commandName=t.instructName,this.detailsForm.responseMessage=t.responseMessage,this.detailsForm.executionTime=null==t.designatedExecuteTime?"":this.$method.formatterTime(t.designatedExecuteTime),2==t.status||3==t.status?this.detailsForm.endTime=this.$method.formatterTime(t.gmtModified):this.detailsForm.endTime="",this.detailsForm.executionResult=0==t.status?"未执行":1==t.status?"执行中":2==t.status?"已完成":3==t.status?"失败":"未知",this.detailsForm.sender=t.userName,this.detailsForm.paramsTableData=t.instructContent,this.detailsDialog=!0},resendCommand:function(t){var e=this;if(0!==t.isEnable){var a=0===t.countInstrustHistory&&"UpdateFirmware"!=t.methodName?"该DTU还有未完成指令，本次指令下发会有一定的延后":"是否确认重新下发该条指令？";this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a;e.$RequestUtil.post({url:"/device/instruct/instructResend",params:{id:t.id,equId:t.equId,methodName:t.methodName,dtuId:t.dtuId},type:"sync",success:(a=c()(l.a.mark(function t(a){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("success"!=a.result){t.next=7;break}return e.$message({type:"success",message:a.msg}),t.next=4,e.search();case 4:e.$eventBus.$emit("triggerMsg",e.tableData[0]),t.next=8;break;case 7:"warn"==a.result?e.$message({type:"warning",message:a.msg}):e.$message({type:"error",message:a.msg});case 8:case"end":return t.stop()}},t,e)})),function(t){return a.apply(this,arguments)})})})}else this.$confirm("该DTU已禁用，无法下发指令！","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"})}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list-window",attrs:{id:"commandHistory"}},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{"search-arr":t.searchArr},on:{clear:function(e){t.clearPart(e)},search:function(e){t.searchPart(e)},querySelect:function(e){var a=e.queryString,s=e.cb;t.queryBindDtu(a,s)}}})],1),t._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark","default-sort":{prop:t.queryParams.orderColumn,order:"descending"}},on:{"sort-change":t.sortChangeEvent}},[a("el-table-column",{attrs:{prop:"dtuImei",label:"DTU IMEI",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"instructName",label:"指令名称",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{label:"执行时间",sortable:"custom",prop:"designatedExecuteTime",formatter:function(e){return t.$method.formatterTime(e.designatedExecuteTime)}}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"完成情况",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{class:3==e.row.status?"colorRed":""},[t._v("\n            "+t._s(0==e.row.status?"未执行":1==e.row.status?"执行中":2==e.row.status?"已完成":3==e.row.status?"失败":"未知")+"\n          ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(){return t.detailsCommand(e.row)}}},[t._v("详情")]),t._v(" "),3==e.row.status?a("span",{staticClass:"vertical"}):t._e(),t._v(" "),3==e.row.status?a("el-button",{attrs:{type:"text",disabled:e.row.type>1},on:{click:function(){return t.resendCommand(e.row)}}},[t._v("重发")]):t._e()]}}])})],1),t._v(" "),[a("Pagination",{attrs:{total:t.pagination.totalPage,"page-num":t.pagination.currentPage},on:{pageChange:t.pageChange}})]],2),t._v(" "),a("el-dialog",{attrs:{title:"指令历史详情",width:"650px",visible:t.detailsDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.detailsDialog=e}}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[t._v("DTU IMEI号：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(this.detailsForm.dtuImei))])])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[t._v("指令名称：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(this.detailsForm.commandName))])])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[t._v("执行时间：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(this.detailsForm.executionTime))])])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[t._v("结束时间：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(this.detailsForm.endTime))])])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[t._v("执行结果：")]),t._v(" "),"失败"!==this.detailsForm.executionResult?a("div",{staticClass:"value"},[t._v("\n            "+t._s(this.detailsForm.executionResult)+"\n          ")]):t._e(),t._v(" "),"失败"===this.detailsForm.executionResult?a("div",{staticClass:"value-fail",style:{color:"失败"===this.detailsForm.executionResult?"red":null}},[a("span",{attrs:{type:"ShowReason"},on:{click:function(e){t.dialogVisible=!0}}},[t._v(t._s(this.detailsForm.executionResult))])]):t._e()])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"info"},[a("div",{staticClass:"label"},[t._v("发送人：")]),t._v(" "),a("div",{staticClass:"value"},[t._v(t._s(this.detailsForm.sender))])])])],1),t._v(" "),[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.detailsForm.paramsTableData}},[a("el-table-column",{attrs:{prop:"instructK",label:"参数名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"instructV",label:"参数值"}})],1)]],2),t._v(" "),a("el-dialog",{attrs:{title:"失败原因",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("span",[t._v(t._s(this.detailsForm.responseMessage))]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 定")])],1)])],1)},staticRenderFns:[]};var h=a("C7Lr")(d,m,!1,function(t){a("cAZU"),a("u6lm")},"data-v-5ba330d9",null);e.default=h.exports},u6lm:function(t,e){}});