webpackJsonp([43],{FJwq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={name:"regionList",components:{},data:function(){return{searchForm:{regionName:""},queryParams:{regionName:"",orderColumn:"gmtModified",orderType:"DESC"},pagination:{currentPage:1,totalPage:0,pagesize:10},tableDataRegion:[],addDialog:{isShow:!1},editDialog:{isShow:!1},addRegionForm:{regionName:"",regionRemark:""},editRegionForm:{id:"",regionName:"",regionRemark:""},rules:{regionName:[{required:!0,validator:function(e,t,a){if(""!=t){for(var r=/[\uFF00-\uFFFF]/g,i=t.split(""),o=i.length;o--;)if(r.test(i[o]))return void a(new Error("不能使用全角字符"));commonUtils.regExp.noSpecialChar(t)?a():a(new Error("不能包含特殊字符"))}else a(new Error("请输入区域名称"))},trigger:"blur"}],regionRemark:[]},btnAdd:!1,btnEdit:!1,sessionName:"regionList",loading:!1,searchArr:[]}},mounted:function(){this.searchArr=[{id:"1",label:"区域名称",value:"regionName",type:"input",maxLen:"50"}],this.search()},created:function(){},methods:{sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/area/getAreaListPage",params:{areaName:this.queryParams.regionName.trim(),page:this.pagination.currentPage,rows:this.pagination.pagesize,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(t){"success"==t.result&&(e.tableDataRegion=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1)}}).catch(function(){e.loading=!1})},searchAll:function(e){this.pagination.currentPage=1,this.queryParams.regionName=e.regionName,this.search()},openAddForm:function(){this.addDialog.isShow=!0},insertRegion:function(){var e=this;this.$refs.addForm.validate(function(t){t?(e.btnAdd=!0,e.$RequestUtil.post({url:"/device/area/addArea",type:"sync",params:{areaName:e.addRegionForm.regionName,areaRemarks:e.addRegionForm.regionRemark},success:function(t){"success"==t.result&&(e.$message.success(t.msg),e.btnAdd=!1,e.addDialog.isShow=!1,e.search())}}).catch(function(){e.btnAdd=!1,e.$message.error(res.msg)})):e.btnAdd=!1})},resetAdd:function(){this.addDialog.isShow=!1;var e=this.$refs.addForm;null!=e&&e.resetFields()},edit:function(e){this.editRegionForm.id=e.id,this.editRegionForm.regionName=e.areaName,this.editRegionForm.regionRemark=e.areaRemarks,this.editDialog.isShow=!0},updateRegion:function(){var e=this;this.$refs.editForm.validate(function(t){t?(e.btnEdit=!0,e.$RequestUtil.post({url:"/device/area/updateArea",type:"sync",params:{id:e.editRegionForm.id,areaName:e.editRegionForm.regionName,areaRemarks:e.editRegionForm.regionRemark},success:function(t){"success"==t.result&&(e.$message.success(t.msg),e.btnEdit=!1,e.editDialog.isShow=!1,e.search())}}).catch(function(){e.btnEdit=!1})):e.btnEdit=!1})},resetEdit:function(){this.editDialog.isShow=!1;var e=this.$refs.editForm;null!=e&&e.resetFields()},deleteRegion:function(e){var t=this;0==e.userNum&&0==e.equNum?this.$confirm("确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$RequestUtil.post({url:"/device/area/deleteArea",type:"sync",params:{id:e.id},success:function(e){"success"==e.result&&(t.$message.success(e.msg),t.search())}})}).catch(function(){}):this.$confirm("该区域下有"+e.userNum+"个用户"+e.equNum+"个设备, 请先解绑关系,再删除!","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"}).then(function(){})}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-window"},[a("div",{staticClass:"searchbar"},[a("searchInput",{attrs:{"search-arr":e.searchArr},on:{clear:function(t){e.queryParams.regionName=""},search:function(t){e.searchAll(t)}}})],1),e._v(" "),e.$PERMISSION.AREA_WRITE?a("div",{staticClass:"operatebar"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.openAddForm}},[e._v("新增")])],1):e._e(),e._v(" "),a("div",{staticClass:"list-div"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableDataRegion,"tooltip-effect":"dark","default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent}},[a("el-table-column",{attrs:{prop:"areaName",label:"区域名称",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"areaRemarks",label:"区域备注",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("div",[a("textareaCheckRows",{attrs:{inputType:"pre",textValue:e.row.areaRemarks}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",sortable:"custom",prop:"gmtCreate",formatter:function(t){return e.$method.formatterTime(t.gmtCreate)}}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$PERMISSION.AREA_WRITE?a("el-button",{attrs:{type:"text"},on:{click:function(){return e.edit(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$PERMISSION.AREA_WRITE?a("span",{staticClass:"vertical"}):e._e(),e._v(" "),e.$PERMISSION.AREA_WRITE?a("el-button",{attrs:{type:"text"},on:{click:function(){return e.deleteRegion(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),[a("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})]],2),e._v(" "),a("el-dialog",{attrs:{title:"新增区域",width:"23%",visible:e.addDialog.isShow,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.addDialog,"isShow",t)},close:e.resetAdd}},[a("el-form",{ref:"addForm",staticStyle:{width:"85%"},attrs:{model:e.addRegionForm,rules:e.rules,"label-width":"95px"}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"区域名称：",prop:"regionName"}},[a("el-input",{staticClass:"search-input-wat",attrs:{placeholder:"请输入区域名称",maxlength:"50"},model:{value:e.addRegionForm.regionName,callback:function(t){e.$set(e.addRegionForm,"regionName","string"==typeof t?t.trim():t)},expression:"addRegionForm.regionName"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"区域备注：",prop:"regionRemark"}},[a("el-input",{staticClass:"search-input-wat",attrs:{type:"textarea",rows:3,maxlength:"200",placeholder:"请输入区域备注"},model:{value:e.addRegionForm.regionRemark,callback:function(t){e.$set(e.addRegionForm,"regionRemark",t)},expression:"addRegionForm.regionRemark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnAdd},on:{click:function(t){return e.insertRegion()}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑区域",width:"23%",visible:e.editDialog.isShow,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.editDialog,"isShow",t)},close:e.resetEdit}},[a("el-form",{ref:"editForm",staticStyle:{width:"85%"},attrs:{model:e.editRegionForm,rules:e.rules,"label-width":"95px"}},[a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"区域名称：",prop:"regionName"}},[a("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入区域名称"},model:{value:e.editRegionForm.regionName,callback:function(t){e.$set(e.editRegionForm,"regionName","string"==typeof t?t.trim():t)},expression:"editRegionForm.regionName"}})],1),e._v(" "),a("el-form-item",{staticClass:"el-inputcss",attrs:{label:"区域备注：",prop:"regionRemark"}},[a("el-input",{staticClass:"search-input-wat",attrs:{type:"textarea",rows:3,maxlength:"200",placeholder:"请输入区域备注"},model:{value:e.editRegionForm.regionRemark,callback:function(t){e.$set(e.editRegionForm,"regionRemark",t)},expression:"editRegionForm.regionRemark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateRegion()}}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var o=a("C7Lr")(r,i,!1,function(e){a("qS87")},"data-v-57f65051",null);t.default=o.exports},qS87:function(e,t){}});