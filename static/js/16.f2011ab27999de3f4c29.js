webpackJsonp([16],{"37/J":function(e,t){},EOpO:function(e,t){},Qnxy:function(e,t){},akCh:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("ZLEe"),a=s.n(i),r=s("lC5x"),o=s.n(r),n=s("J0Oq"),l=s.n(n),d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"roleDetail"},[s("el-dialog",{attrs:{"close-on-click-modal":!1,title:"角色详情",visible:e.$parent.detailModel,width:"431px","before-close":e.handleClose},on:{"update:visible":function(t){return e.$set(e.$parent,"detailModel",t)}}},[s("span",{staticClass:"spanClass el-inputcss"},[e._v("所选角色：")]),e._v(" "),s("span",[e._v(e._s(e.roleDetail.roleName))]),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"spanClass el-inputcss"},[e._v("权限列表：")]),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.detailR,"highlight-current-row":"",height:"250"}},[s("el-table-column",{attrs:{type:"index",width:"40"}}),e._v(" "),s("el-table-column",{attrs:{prop:"permissionInfo",label:"权限详情"}})],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.$parent.detailModel=!1}}},[e._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var c=s("C7Lr")({name:"roleDetail",props:["roleDetail"],data:function(){return{detailModel:!1,detailR:[]}},methods:{handleClose:function(e){e()},handleClick:function(e,t){},getList:function(e){this.detailR=e}}},d,!1,function(e){s("Qnxy")},"data-v-fa09e428",null).exports,u=s("kirP"),h={name:"roleList",components:{RoleDetail:c},data:function(){return{loading:!1,selCartList:[],searchform:{roleName:""},queryParams:{roleName:"",orderColumn:"gmtModified",orderType:"DESC"},selectRow:{},currentShowTree:"add",chonseRows:[],addModel:!1,editModel:!1,detailModel:!1,addCart:{roleName:""},editCart:{id:"",roleName:""},pagination:{currentPage:1,totalPage:0,pagesize:10},rules:{roleName:[{required:!0,message:"请输入角色名",trigger:"blur"},{validator:function(e,t,s){commonUtils.regExp.noSpecialChar(t)?s():s(new Error("不能有特殊字符"))},trigger:"blur"}]},parentList:[],permissionList:[],defaultProps:{children:"childList",label:"permissionName",disabled:this.nodeDisable},searchArr:[]}},computed:{labelWidth:function(){return window.innerWidth<=1366?"58px":"60px"}},created:function(){this.search(),this.getRightList()},mounted:function(){this.searchArr=[{id:"1",label:"角色名",value:"roleName",type:"input",maxLen:"50"}]},methods:{sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},toSearch:function(e){this.queryParams.roleName=e.roleName,this.search()},getRoleDetail:function(){var e=l()(o.a.mark(function e(t){var s,i=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentShowTree="editTree",this.editModel=!0,this.editCart.roleName=t.roleName,this.editCart.id=t.id,e.next=6,this.$nextTick();case 6:s=this.$loading({target:".edit_permission_tree",text:"Loading",spinner:"el-icon-loading"}),this.$RequestUtil.post({url:"/user/permission/getByRoleId",params:{id:t.id},success:function(e){if("success"===e.result){i.permissionList=[],i.parentList=[];for(var s=0;s<e.data.allList.length;s++)if(0===e.data.allList[s].parentId){if(1!=t.id&&"ADMIN_HOME_PAGE"==e.data.allList[s].permissionCode)continue;if(1==t.id&&"ADMIN_HOME_PAGE"==e.data.allList[s].permissionCode){i.parentList.unshift(e.data.allList[s]);continue}i.parentList.push(e.data.allList[s])}for(var a=0;a<i.parentList.length;a++){var r={id:"",permissionName:"",childList:[]};r.id=i.parentList[a].id,r.permissionName=i.parentList[a].permissionName,r.childList=[];for(var o=0;o<e.data.allList.length;o++)Number(i.parentList[a].id)===Number(e.data.allList[o].parentId)&&r.childList.push(e.data.allList[o]);i.permissionList.push(r)}i.$nextTick(function(){for(var t=[],s=0;s<e.data.chonseList.length;s++)i.$refs.editTree.getNode(e.data.chonseList[s].id).isLeaf&&t.push(e.data.chonseList[s].id);i.$refs.editTree.setCheckedKeys(t)})}}}).finally(function(){return s.close()});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getRightList:function(){var e=this;this.$RequestUtil.post({url:"/user/permission/getPermissionList",params:{},success:function(t){if("success"===t.result){for(var s=0;s<t.data.length;s++)0===t.data[s].parentId&&e.parentList.push(t.data[s]);for(var i=0;i<e.parentList.length;i++){var a={id:"",permissionName:"",childList:[]};a.id=e.parentList[i].id,a.permissionName=e.parentList[i].permissionName,a.childList=[];for(var r=0;r<t.data.length;r++)Number(e.parentList[i].id)===Number(t.data[r].parentId)&&a.childList.push(t.data[r]);e.permissionList.push(a)}}}})},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/user/role/getRoleListPage",params:{roleName:this.queryParams.roleName.trim(),page:this.pagination.currentPage,rows:this.pagination.pagesize,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(t){"success"===t.result?(e.selCartList=t.data,e.pagination.totalPage=t.totalPages,e.loading=!1):e.$message({message:t.msg,type:"error"})}}).catch(function(){e.loading=!1})},clearPart:function(){this.searchform.roleName=this.queryParams.roleName="",this.pagination.currentPage=1},formatterTime:function(e){var t=new Date(e.gmtModified);return Object(u.a)(t,"yyyy-MM-dd hh:mm")},resetForm:function(e){this.$refs[e].resetFields()},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},toSave:function(){var e=this;this.$refs.addCartForm.validate(function(t){if(!t)return!1;0!==e.$refs.addTree.getCheckedKeys().length?e.$confirm("是否确认保存角色信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.sureSave()}).catch(function(){}):e.$message({message:"请勾选需要需要匹配的权限",type:"warning"})})},sureSave:function(){for(var e=this,t=[],s=0;s<this.$refs.addTree.getCheckedNodes(!1,!0).length;s++){var i=this.$refs.addTree.getCheckedNodes(!1,!0)[s];t.push({perId:i.id})}this.$RequestUtil.postSync({url:"/user/role/addRole",params:{roleName:this.addCart.roleName,idList:t},success:function(t){"success"===t.result?(e.$message({message:t.msg,type:"success"}),e.addModel=!1,e.$refs.addTree.setCheckedKeys([]),e.search(),e.addCart.roleName=""):e.$message({message:t.msg,type:"error"})}})},toUpdate:function(){var e=this;this.$refs.editCartForm.validate(function(t){if(!t)return!1;0!=e.$refs.editTree.getCheckedKeys().length?e.$confirm("是否确认编辑角色信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.sureUpdate()}).catch(function(){}):e.$message({message:"请勾选需要需要匹配的权限",type:"warning"})})},sureUpdate:function(){for(var e=this,t=[],s=0;s<this.$refs.editTree.getCheckedNodes(!1,!0).length;s++){var i=this.$refs.editTree.getCheckedNodes(!1,!0)[s];t.push({perId:i.id})}this.$RequestUtil.postSync({url:"/user/role/updateRole",params:{roleName:this.editCart.roleName,idList:t,id:this.editCart.id},success:function(t){"success"==t.result?(e.$message({message:t.msg,type:"success"}),e.editModel=!1,e.resetForm("editCartForm"),e.search()):e.$message({message:t.msg,type:"error"})}})},handleSelectionChange:function(e){this.chonseRows=e},addHandleClose:function(e){e(),this.$refs.addTree.setCheckedKeys([]),this.resetForm("addCartForm")},editHandleClose:function(e){e(),this.$refs.editTree.setCheckedKeys([]),this.resetForm("editCartForm")},delRole:function(){var e=this;if(0!=this.chonseRows.length){for(var t={},s=0;s<this.chonseRows.length;s++){if(1===this.chonseRows[s].type||2===this.chonseRows[s].type)return void this.$message({message:"系统角色不允许删除",type:"warning"});this.chonseRows[s].coutUserOfRole&&this.chonseRows[s].coutUserOfRole>0&&(t[this.chonseRows[s].roleName]=this.chonseRows[s].coutUserOfRole)}var i=this.$createElement,r=i("p",null,"确认删除此角色？");if(a()(t).length>0){var o=[];a()(t).forEach(function(e){o.push(i("p",null,'角色"'+e+'"下有'+t[e]+"个用户关联"))}),o.push(i("p",null,"删除角色后，会导致对应用户不能正常访问系统，确认删除？”")),r=i("p",null,o)}this.$msgbox({title:"消息",message:r,showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){e.sureDel()}).catch(function(e){})}else this.$message({message:"请勾选需要删除的角色",type:"warning"})},sureDel:function(){for(var e=this,t=[],s=0;s<this.chonseRows.length;s++)t.push(this.chonseRows[s].id);t.length<=0?this.$message({message:"请勾选需要删除的角色",type:"warning"}):this.$RequestUtil.post({url:"/user/role/deleteRole",params:{delList:t},success:function(t){"success"==t.result?(e.search(),e.$message({message:t.msg,type:"success"})):e.$message({message:t.msg,type:"error"})}})},getDetail:function(e){var t=this;this.$RequestUtil.post({url:"/user/permission/getByRoleId",params:{id:e.id},success:function(s){if("success"===s.result){for(var i=new Array,a=0;a<s.data.chonseList.length;a++)i.push(s.data.chonseList[a]);t.selectRow.roleName=e.roleName,t.selectRow.idList=i,t.detailModel=!0,t.$refs.detailCartModel.getList(i)}}})},nodeDisable:function(e,t){return 9===e.id?this.computeNodeDisable(7):35===e.id?this.computeNodeDisable(34):35===e.id?this.computeNodeDisable(34):72===e.id?this.computeNodeDisable(71):74===e.id?this.computeNodeDisable(73):46===e.id?this.computeNodeDisable(45):15===e.id?this.computeNodeDisable(13):27===e.id?this.computeNodeDisable(26):20===e.id?this.computeNodeDisable(19):69===e.id?this.computeNodeDisable(68):76===e.id?this.computeNodeDisable(75):78===e.id?this.computeNodeDisable(77):void 0},computeNodeDisable:function(e){return!this.$refs[this.currentShowTree].getNode(e).checked},nodeCheckChange:function(e,t){7===e.id&&this.computeNodeChecked(9,t),34===e.id&&this.computeNodeChecked(35,t),71===e.id&&this.computeNodeChecked(72,t),73===e.id&&this.computeNodeChecked(74,t),45===e.id&&this.computeNodeChecked(46,t),13===e.id&&this.computeNodeChecked(15,t),26===e.id&&this.computeNodeChecked(27,t),19===e.id&&this.computeNodeChecked(20,t),68===e.id&&this.computeNodeChecked(69,t),75===e.id&&this.computeNodeChecked(76,t),77===e.id&&this.computeNodeChecked(78,t)},computeNodeChecked:function(e,t){t||this.$refs[this.currentShowTree].setChecked(e,!1)}}},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-window"},[s("div",{staticClass:"searchbar"},[s("searchInput",{attrs:{"search-arr":e.searchArr},on:{clear:function(t){e.queryParams.roleName=""},search:function(t){e.toSearch(t)}}})],1),e._v(" "),e.$PERMISSION.ROLE_WRITE&&1!==e.userType?s("div",{staticClass:"operatebar"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(){e.currentShowTree="addTree",e.addModel=!0}}},[e._v("新增")]),e._v(" "),s("el-button",{attrs:{plain:"",size:"small"},on:{click:e.delRole}},[e._v("删除")])],1):e._e(),e._v(" "),s("div",{staticClass:"list-div"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.selCartList,"tooltip-effect":"dark","default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent,"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"80",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{prop:"roleName",label:"角色名","min-width":"120",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{prop:"gmtModified",label:"修改时间","min-width":"120",formatter:e.formatterTime,sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{prop:"nickName",label:"操作员","min-width":"120",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(){return e.getDetail(t.row)}}},[e._v("详情")]),e._v(" "),e.$PERMISSION.ROLE_WRITE?s("span",{staticClass:"vertical"}):e._e(),e._v(" "),e.$PERMISSION.ROLE_WRITE?s("el-button",{attrs:{type:"text"},on:{click:function(){return e.getRoleDetail(t.row)}}},[e._v("编辑")]):e._e()]}}])})],1),e._v(" "),s("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],1),e._v(" "),s("el-dialog",{ref:"addModal",attrs:{"close-on-click-modal":!1,title:"新增角色",visible:e.addModel,width:"20%","custom-class":"myDia","before-close":e.addHandleClose},on:{"update:visible":function(t){e.addModel=t}}},[s("el-row",{attrs:{type:"flex"}},[s("el-col",{attrs:{span:40}},[s("el-form",{ref:"addCartForm",attrs:{model:e.addCart,rules:e.rules,"label-width":"100px","label-position":"right"}},[s("el-form-item",{staticClass:"el-inputcss",staticStyle:{"min-width":"340px"},attrs:{label:"角色名：",prop:"roleName"}},[s("el-input",{attrs:{maxlength:"50",placeholder:"请输入角色名"},model:{value:e.addCart.roleName,callback:function(t){e.$set(e.addCart,"roleName",t)},expression:"addCart.roleName"}})],1),e._v(" "),s("el-form-item",{staticClass:"el-inputcss",attrs:{label:"权限列表："}},[s("el-tree",{ref:"addTree",attrs:{data:e.permissionList,"show-checkbox":"","node-key":"id","highlight-current":"",props:e.defaultProps}})],1)],1)],1)],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{"close-on-click-modal":!1,title:"角色编辑",visible:e.editModel,width:"20%","custom-class":"myDia","before-close":e.editHandleClose},on:{"update:visible":function(t){e.editModel=t}}},[s("el-row",{attrs:{type:"flex"}},[s("el-col",{attrs:{span:40}},[s("el-form",{ref:"editCartForm",attrs:{model:e.editCart,rules:e.rules,"label-width":"100px","label-position":"right"}},[s("el-form-item",{staticClass:"el-inputcss",attrs:{label:"角色名：",prop:"roleName"}},[s("el-input",{attrs:{maxlength:"50",placeholder:"请输入角色名"},model:{value:e.editCart.roleName,callback:function(t){e.$set(e.editCart,"roleName",t)},expression:"editCart.roleName"}})],1),e._v(" "),s("el-form-item",{staticClass:"el-inputcss",attrs:{label:"权限列表："}},[s("el-tree",{ref:"editTree",staticClass:"edit_permission_tree",attrs:{data:e.permissionList,"show-checkbox":"","node-key":"id","highlight-current":"",props:e.defaultProps},on:{"check-change":e.nodeCheckChange}})],1)],1)],1)],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.toUpdate}},[e._v("确 定")])],1)],1),e._v(" "),s("role-detail",{ref:"detailCartModel",attrs:{"role-detail":e.selectRow}})],1)},staticRenderFns:[]};var m=s("C7Lr")(h,p,!1,function(e){s("EOpO"),s("37/J")},"data-v-3f1bf74b",null);t.default=m.exports},kirP:function(e,t,s){"use strict";function i(e){return("00"+e).substr(e.length)}t.a=function(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var a in s)if(new RegExp("("+a+")").test(t)){var r=s[a]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?r:i(r))}return t}}});