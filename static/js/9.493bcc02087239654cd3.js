webpackJsonp([9],{"4Xi4":function(e,t,a){e.exports={default:a("e9I6"),__esModule:!0}},B0Qb:function(e,t,a){var l=a("Wtcz");l(l.S,"Number",{isInteger:a("qgzg")})},BgBL:function(e,t){},HulO:function(e,t){},"IWO+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("ZLEe"),i=a.n(l),n=a("lC5x"),r=a.n(n),s=a("J0Oq"),o=a.n(s),c=a("4Xi4"),d=a.n(c),u={name:"FileView",data:function(){return{flieType:-100,selectId:null,tableData:[],fileName:"",selectData:null,viewTechnologyDialogVisible:!1,W:!1,getIndex:null,sendData:null,permission:JSON.parse(localStorage.getItem("permission"))}},mounted:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=document.documentElement.clientWidth||document.body.clientWidth,e.W=a>=1900,window.onresize=function(){var t=document.documentElement.clientWidth||document.body.clientWidth;e.W=t>=1900};case 3:case"end":return t.stop()}},t,e)}))()},computed:{span:function(){return this.W?5:7},uploadUrl:function(e){return"wuyuan/uploadFirmware"}},methods:{rowClick:function(e,t,a){this.selectData=e,this.getIndex==e.index?(this.getIndex=null,this.selectData=null,this.selectId=null):(this.getIndex=e.index,this.selectId=e.id)},selectedHighlight:function(e){e.row;var t=e.rowIndex;if(this.getIndex===t)return{"background-color":"#faf2d4",color:"#409EFF"}},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;t.index=a},selectFile:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.selectData?(e.$parent.uploadComplete&&((a={}).data=e.selectData,e.$parent.uploadComplete(a)),e.sendData=null,e.selectData=null,e.getIndex=null,e.fileName=null,e.selectId=null,e.viewTechnologyDialogVisible=!1):e.$message.warning("请先选择文件");case 1:case"end":return t.stop()}},t,e)}))()},reload:function(){var e=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.initView();case 1:case"end":return t.stop()}},t,e)}))()},loadFileList:function(e){var t=this;return o()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.$RequestUtil.post({url:"/device/maintenanceSchedule/insertMaintenanceFirmware",params:{fileName:e,pageNum:1,pageSize:20},success:function(e){t.tableData=e.data}});case 1:case"end":return a.stop()}},a,t)}))()},initView:function(e,t){var a=this;return o()(r.a.mark(function l(){return r.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a.selectData=null,a.getIndex=null,a.fileName=null,a.selectId=null,a.sendData=e,void 0!=t&&(a.flieType=t),l.next=8,a.loadFileList();case 8:a.viewTechnologyDialogVisible=!0;case 9:case"end":return l.stop()}},l,a)}))()},search:function(){var e=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadFileList(e.fileName);case 2:case"end":return t.stop()}},t,e)}))()},cancalViewTechnology:function(){this.procedureData=[],this.parameterData=[],this.viewTechnologyDialogVisible=!1},beforeUpload:function(e){var t=e.size/1024/1024;if((t=Math.round(100*t)/100)>=5)return this.$message({type:"error",message:"文件大小不能超过5M,当前上传"+e.name+"大小为"+t+"M"}),!1},uploadComplete:function(){var e=o()(r.a.mark(function e(t,a,l){var i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.$message({type:"success",message:"上传成功"}),this.$parent.uploadComplete&&this.sendData&&(i=this.sendData,i.fileType,i.deviceId,i.deviceTypeId,t.data.id),this.viewTechnologyDialogVisible=!1,this.fileName="",this.search();case 5:case"end":return e.stop()}},e,this)}));return function(t,a,l){return e.apply(this,arguments)}}(),showFile:function(e){if(!this.permission.btn_file_get)return this.$message({type:"error",message:"抱歉，您暂无文件读取权限"}),!1;if(e){var t=e.lastIndexOf("."),a=e.substr(t+1).toLowerCase();["pdf","png","jpg","svg","txt","html","js","art","au","aiff","xbf","jpeg"].includes(a)?window.open(e,"_blank"):window.location.href=e}else this.$message.warning("当前文件不存在")},getFilePath:function(e){if(e){var t="",a=e.split("."),l=a[a.length-1];switch(!0){case"pdf"==l||"pptx"==l:t="../../static/img/pdf.png";break;case"png"==l||"jpg"==l||"svg"==l:t="../../static/img/pic.png";break;case"txt"==l||"doc"==l||"docx"==l:t="../../static/img/txt.png";break;default:t="../../static/img/file.png"}return t}}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"file-view",staticStyle:{"font-family":"NotoSansHans-Regula","font-size":"24px",color:"#333","z-index":"99999999999"},attrs:{title:"选择附件","close-on-click-modal":!1,center:"",visible:e.viewTechnologyDialogVisible,width:"30%"},on:{"update:visible":function(t){e.viewTechnologyDialogVisible=t}}},[a("div",{staticClass:"table_searchbar"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:16}},[a("div",{on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search()}}},[a("span",{staticClass:"title"},[e._v("文件名：")]),e._v(" "),a("el-input",{style:e.W?{maxWidth:"180px"}:{maxWidth:"150px"},attrs:{size:"small",maxlength:"100",placeholder:"文件名"},model:{value:e.fileName,callback:function(t){e.fileName=t},expression:"fileName"}})],1)]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.search()}}},[e._v("查询")])],1)])],1)],1),e._v(" "),a("el-row",{staticStyle:{margin:"15px 0"}},[a("span",{staticStyle:{"font-size":"12px"}},[e._v("默认只显示20个附件，可输入文件名搜索你要的附件")])]),e._v(" "),a("el-table",{staticStyle:{width:"100%","max-height":"322px",overflow:"hidden","overflow-y":"auto"},attrs:{data:e.tableData,height:e.tableData.length>=7?322:"","empty-text":"暂无相关文件","row-class-name":e.tableRowClassName,"row-style":e.selectedHighlight},on:{"row-click":e.rowClick,click:function(t){t.stopPropagation(),e.deleteVisible=!0}}},[a("el-table-column",{attrs:{label:"文件名称","min-width":"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"radio",style:t.row.id==e.selectId?{background:"#409EFF",border:"1px solid #409EFF"}:{}},[a("div",{staticClass:"point"})]),e._v(e._s(t.row.fileName)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"操作人","min-width":"80","show-overflow-tooltip":""}})],1),e._v(" "),a("span",{staticClass:"el-dialog__footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer",center:""},slot:"footer"},[a("el-upload",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{action:e.uploadUrl,"before-upload":e.beforeUpload,"on-success":e.uploadComplete,"show-file-list":!1}},[a("el-button",{attrs:{type:"primary",size:"small"}},[e._v("重新上传")])],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.selectFile}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:e.cancalViewTechnology}},[e._v("取 消")])],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(u,p,!1,function(e){a("cVfm"),a("HulO")},"data-v-6f0a80ac",null).exports,m=a("CEOA"),h={name:"CarePlan",components:{FileView:f},filters:{showContent:function(e,t){for(var a=0;a<e.length;a++)if(e[a].level==t){var l="";switch(Number(e[a].cycleType)){case 1:l="每日";break;case 2:l="每周";break;case 3:l="每月";break;case 4:l="每半年";break;case 5:l="每年";break;case 6:l="每季度"}return e[a].configName+","+l}return""}},data:function(){var e=this;return{currentRow:{},searchArr:[],queryParams:{equCode:"",equName:"",deviceTypeId:"",orderColumn:"gmtModified",orderType:"DESC"},pagination:{currentPage:1,totalPage:0,pagesize:10},DmouserShow:null,DNmouserShow:null,daysAheadOption:[],weekAhead:[1,2,3],monthAhead:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],yearAhead:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],organizationList:[],uploadInfo:{},fileType:null,planDialogVisible:!1,configList:[],configOption:[],W:!1,planData:{idOfSchedule:null,deviceTypeId:null,idOfDevice:null,cycleList:[]},plan:{configName:"",configId:null,level:null,cycleType:null,cycleValue:null,maintenanceWorkerId:null,maintainTime:null,daysAhead:null,serviceOrganizationId:null,serviceType:null,serviceWorkerId:null},weekOption:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dateOption:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],monthOption1:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthOption:["1月 7月","2月 8月","3月 9月","4月 10月","5月 11月","6月 12月"],levelOption:[{label:"一级",value:1},{label:"二级",value:2},{label:"三级",value:3}],quarterOption:["1月 4月 7月 10月","2月 5月 8月 11月","3月 6月 9月 12月"],timeOption:[{label:"每日",value:1},{label:"每周",value:2},{label:"每月",value:3},{label:"每半年",value:4},{label:"每年",value:5}],relatedOptions:[{value:"0",label:"未关联"},{value:"1",label:"已关联"}],selectOption:[],deviceTypeLoading:!1,deviceTypeOptions:[],searchFormTemp:"",searchForm:{equCode:"",equName:"",typeName:"",deviceTypeId:"",isRelated:""},addForm:{idOfSchedule:null,deviceTypeId:null,idOfDevice:null,maintenanceWorkerId:null,serviceWorkerId:null,electricInfo:null,operationManual:null,serviceManual:null,otherInfo:null,businessLeaderId:null,chiefLeaderId:null,equName:"",typeName:"",equManufacturers:"",useDate:null,cycleList:[{id:null,maintenanceScheduleId:null,level:2,cycleType:2,cycleValue:15,configId:null,maintenanceWorkerId:null,serviceType:0}]},viewForm:{deviceId:"",equName:"",typeName:"",serialNumber:"",osType:"",vendor:"",equManufacturers:"",productionDate:"",useDate:""},deviceType:[],tableData:[],addDialogVisible:!1,editDialogVisible:!1,viewDialogVisible:!1,qrCodeDialogVisible:!1,qrCode:null,qrequCode:"",qrequName:"",rules:{daysAhead:[{required:!1,message:"请输入提前派发天数",trigger:"blur"},{validator:function(t,a,l){if(a)if(d()(Number(a))&&Number(a)>0){var i=Number(a);2==e.plan.cycleType?i>=1&&i<=3?l():l(new Error("提前派发天数只能为1-3")):3==e.plan.cycleType?i>=1&&i<=15?l():l(new Error("提前派发天数只能为1-15")):4==e.plan.cycleType||5==e.plan.cycleType?i>=1&&i<=30?l():l(new Error("提前派发天数只能为1-30")):l()}else l(new Error("请输入正整数"));else l()},trigger:"blur"}],equCode:[{required:!0,message:"请输入设备编号",trigger:"blur"}],equName:[{required:!0,message:"请输入设备名称",trigger:"blur"}],deviceTypeId:[{required:!0,message:"请选择设备类型",trigger:"blur"}],configId:[{required:!0,message:"请选择保养方式",trigger:"blur"}],maintenanceWorkerId:[{required:!0,message:"请选择保养人",trigger:"blur"}],cycleType:[{required:!0,message:"请选择保养周期",trigger:"blur"}]},allWorkerSelect:[],data:{token:localStorage.getItem("token")},careUser:[],careUserList:[],repairUser:[],repairUserList:[],permission:JSON.parse(localStorage.getItem("permission")),loading:!1,tableLoading:!1}},computed:{span:function(){return this.W?5:7}},mounted:function(){this.searchArr=[{id:"1",label:"设备编号",type:"input",value:"equCode",maxLen:"16"},{id:"2",label:"设备名称",type:"input",value:"equName",maxLen:"16"}],this.initTable()},deactivated:function(){},methods:{sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},DmouseOver:function(e){var t=this.$refs.Dmover.offsetHeight,a=this.$refs.Dmover.scrollHeight;t<a&&(this.DmouserShow=e)},Donmouseout:function(){this.DmouserShow=null},DNmouseOver:function(e){var t=this.$refs.DNmover.offsetHeight,a=this.$refs.DNmover.scrollHeight;t<a&&(this.DNmouserShow=e)},DNonmouseout:function(){this.DNmouserShow=null},closeSelect:function(e,t,a,l,i){var n=this;return o()(r.a.mark(function l(){var s;return r.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(e){l.next=5;break}return l.next=3,n.loadCareUser(t,i,"");case 3:s=l.sent,"add"==a?n.careUser=s:n.$set(n.careUserList,s);case 5:case"end":return l.stop()}},l,n)}))()},remoteMethod:function(e,t,a,l){var i=this;return o()(r.a.mark(function l(){var n;return r.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return i.loading=!1,l.next=3,i.loadCareUser(t,null,e);case 3:n=l.sent,i.loading=!1,"add"==a?i.careUser=n:i.$set(i.careUserList,n);case 6:case"end":return l.stop()}},l,i)}))()},closeSelect1:function(e,t,a,l,i){var n=this;return o()(r.a.mark(function l(){var s;return r.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(e){l.next=5;break}return l.next=3,n.loadRepairUser(t,i,"");case 3:s=l.sent,"add"==a?n.repairUser=s:n.$set(n.repairUserList,s);case 5:case"end":return l.stop()}},l,n)}))()},remoteMethod1:function(e,t,a,l){var i=this;return o()(r.a.mark(function l(){var n;return r.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return i.loading=!1,l.next=3,i.loadRepairUser(t,null,e);case 3:n=l.sent,i.loading=!1,"add"==a?i.repairUser=n:i.$set(i.repairUserList,n);case 6:case"end":return l.stop()}},l,i)}))()},parseStyle:function(e){return null!=e.workshopId?"green":"red"},parseType:function(e){return 0==e.serviceType?"个人":1==e.serviceType?"部门":void 0},reload:function(){this.initTable(),this.$store.commit("delete_reloadPages","/DeviceCare/CarePlan"),this.$forceUpdate()},deleteFile:function(e,t){var a=this;this.$confirm("此操作将删除该文件, 是否继续?","提示",{cancelButtonClass:"btn-custom-cancel",confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){a.$RequestUtil.post({url:"/device/maintenanceSchedule/deleteMaintenanceFirmware",type:"sync",params:{id:e.id,deleteName:t},success:function(e){a.$message.success("删除成功"),a.initTable()}})})},getFilePath:function(e){if(e){var t="",a=e.split("?code="),l=a[a.length-1].split(".").pop();switch(!0){case"pdf"==l:t="../../../static/img/pdf.png";break;case"pptx"==l:t="../../../static/img/ppt.png";break;case"png"==l||"jpg"==l||"svg"==l:t="../../../static/img/pic.png";break;case"txt"==l||"doc"==l||"docx"==l:t="../../../static/img/txt.png";break;default:t="../../../static/img/file.png"}return t}},selectUploadFile:function(e,t){e.fileType=t,e.deviceId=e.id,this.$refs.fileView.initView(e,t),this.uploadInfo=e,this.fileType=t},uploadUrl:function(e,t){return"wuyuan/upload/uploadPicture"},beforeUpload:function(e,t,a){this.fileType=t,this.currentRow=a;var l=e.size/1024/1024;if((l=Math.round(100*l)/100)>=5)return this.$message({type:"error",message:"文件大小不能超过5M,当前上传"+e.name+"大小为"+l+"M"}),!1},showFile:function(e){if(e){var t=e.lastIndexOf("."),a=e.substr(t+1).toLowerCase();["pdf","png","jpg","svg","txt","html","js","art","au","aiff","xbf","jpeg"].includes(a)?window.open(e,"_blank"):window.location.href=e}else this.$message.warning("当前文件不存在")},uploadComplete:function(e,t,a){var l=this;if(null!=e){this.$message({type:"success",message:"选择成功"});var i={};switch(i.id=this.currentRow.id,this.fileType){case 1:i.electricInfo=e.data.url;break;case 2:i.operationManual=e.data.url;break;case 3:i.serviceManual=e.data.url;break;case 4:i.otherInfo=e.data.url}this.$RequestUtil.post({url:"/device/maintenanceSchedule/insertMaintenanceFirmware",params:i,success:function(e){l.initTable()}})}},parsecycleValue:function(e){var t=e.cycleType,a=[];return 1==t?"每日":(2==t?a=this.weekOption:3==t?a=this.dateOption:4==t?a=this.monthOption:5==t?a=this.monthOption1:6==t&&(a=this.quarterOption),a[e.cycleValue])},cycleTypeChange:function(e,t,a){a||"plan"==t||(this.addForm.cycleList[t].cycleValue=null),"plan"==t?(t=0,this.$set(this.plan,"cycleValue",null),this.$set(this.plan,"daysAhead",null)):1!=a&&this.$set(this.addForm.cycleList[t],"daysAhead",null),2==e?(this.selectOption[t]=this.weekOption,this.daysAheadOption[t]=this.weekAhead):3==e?(this.selectOption[t]=this.dateOption,this.daysAheadOption[t]=this.monthAhead):4==e?(this.selectOption[t]=this.monthOption,this.daysAheadOption[t]=this.yearAhead):5==e?(this.selectOption[t]=this.monthOption1,this.daysAheadOption[t]=this.yearAhead):6==e&&(this.selectOption[t]=this.quarterOption,this.daysAheadOption[t]=this.monthAhead)},addPlan:function(){var e=this;this.$refs.plan.validate(function(t){if(t){var a;e.plan.cycleValue=Number(e.plan.cycleValue),1==e.plan.cycleType&&(e.plan.cycleValue=1,e.plan.daysAhead=null),e.plan.maintenanceScheduleId=e.plan.id,delete e.plan.id,a=e.plan;var l="";l=e.planData.idOfSchedule?"/api/maintenanceSchedule/updateSchedule":"/device/maintenanceSchedule/addMaintenanceCycle",e.$RequestUtil.post({url:l,params:a,success:function(t){e.$message.success("添加成功"),e.initTable(),e.plan={configName:"",configId:null,level:null,cycleType:null,cycleValue:null,maintenanceWorkerId:null,daysAhead:null,serviceOrganizationId:null,serviceType:null,serviceWorkerId:null},e.planData={idOfSchedule:null,deviceTypeId:null,idOfDevice:null,cycleList:[]},e.planDialogVisible=!1,e.selectOption=[]}})}})},cancelpalnDialog:function(){this.plan={configName:"",configId:null,level:null,cycleType:null,cycleValue:null,maintenanceWorkerId:null},this.planData={idOfSchedule:null,deviceTypeId:null,idOfDevice:null,cycleList:[]},this.planDialogVisible=!1,this.selectOption=[]},showPlanDialog:function(e,t,a){var l=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l.$method.openLoading(),a.row.idOfSchedule?l.planData.idOfSchedule=a.row.idOfSchedule:l.planData.idOfSchedule=null,l.planData.cycleList=a.row.cycleList,l.planData.deviceTypeId=a.row.deviceTypeId,l.planData.idOfDevice=a.row.id,l.plan.level=e,l.plan.id=a.row.id,t.next=9,l.loadRepairUser(a.row.id);case 9:l.repairUser=t.sent,l.$RequestUtil.post({url:"/device/inspectionConfig/listInspectionConfig",params:{equId:a.row.deviceId,webLevel:e},success:function(){var e=o()(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.loadCareUser(a.row.id);case 2:return l.careUser=e.sent,e.next=5,l.loadRepairUser(a.row.id);case 5:l.repairUser=e.sent,l.configOption=t.data,l.$method.closeLoading(),l.planDialogVisible=!0;case 9:case"end":return e.stop()}},e,l)}));return function(t){return e.apply(this,arguments)}}()});case 11:case"end":return t.stop()}},t,l)}))()},hasLevel:function(e,t){var a=!1;if(e.cycleList&&0!=e.cycleList.length)return e.cycleList.forEach(function(e){e.level==t&&(a=!0)}),a},levelSelect:function(e,t,a,l){var i=this;return o()(r.a.mark(function n(){var s;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return l||(i.addForm.cycleList[t].configId=null,i.levelOption.forEach(function(e){e.disabled=!1}),i.addForm.cycleList.forEach(function(e){i.levelOption.forEach(function(t){t.value==e.level&&(t.disabled=!0)})})),n.next=3,i.$RequestUtil.post({url:"/device/inspectionConfig/listInspectionConfig",params:{webLevel:e,equId:a}});case 3:s=n.sent,i.configList[t]=s.data.data,i.$set(i.configList,t,s.data.data);case 6:case"end":return n.stop()}},n,i)}))()},loadAllWorkerSelect:function(){var e=this;this.$RequestUtil.get({url:"/api/select/listWorker",params:{},success:function(t){0==t.code&&(e.allWorkerSelect=t.data)}})},loadCareUser:function(e,t,a){var l=this;return o()(r.a.mark(function i(){var n,s;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,l.$RequestUtil.post({url:"/user/user/getWorkerOrderResponsibleUserList",params:{deviceId:e,workerId:t,workerName:a,isMainWorkOrderUser:!0}});case 2:return n=i.sent,s=n.data,i.abrupt("return",s.data);case 5:case"end":return i.stop()}},i,l)}))()},loadRepairUser:function(e,t,a){var l=this;return o()(r.a.mark(function i(){var n,s;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,l.$RequestUtil.post({url:"/user/user/getWorkerOrderArrayUserList",params:{deviceId:e,workerId:t,repairUserName:a}});case 2:return n=i.sent,s=n.data,i.abrupt("return",s.data);case 5:case"end":return i.stop()}},i,l)}))()},removeDetail:function(e){var t=this;this.addForm.cycleList[e].level&&this.levelOption.forEach(function(a){a.value==t.addForm.cycleList[e].level&&(a.disabled=!1)}),this.addForm.cycleList.splice(e,1),this.configList.splice(e,1),this.selectOption.splice(e,1)},addCycleList:function(){var e=this.addForm.cycleList.length;this.configList[e]=[];var t={maintenanceScheduleId:null,level:null,cycleType:null,cycleValue:null,id:null,configId:null,maintenanceWorkerId:null};this.addForm.cycleList.push(t)},cancelViewDialog:function(){this.viewDialogVisible=!1,this.addForm={idOfSchedule:null,deviceTypeId:null,idOfDevice:null,maintenanceWorkerId:null,serviceWorkerId:null,electricInfo:null,operationManual:null,serviceManual:null,otherInfo:null,businessLeaderId:null,chiefLeaderId:null,equName:"",typeName:"",equManufacturers:"",useDate:null,cycleList:[]},this.configList=[],this.selectOption=[]},relatedSelectChange:function(e){if(null===e||0===e||""===e)this.searchForm.isRelated="";else{var t=this.relatedOptions;if(t.length>0)for(var a=0;a<t.length;a++)if(t[a].value===e){this.searchForm.isRelated=t[a].value;break}}},deviceTypeSelectChange:function(e){if(null===e||0===e||""===e)this.searchForm.deviceTypeId="";else{var t=this.deviceTypeOptions;if(t.length>0)for(var a=0;a<t.length;a++)if(t[a].id===e){this.searchForm.deviceTypeId=t[a].id;break}}},searchPart:function(e){var t=this;this.pagination.currentPage=1,i()(e).forEach(function(a){t.queryParams[a]=e[a]}),this.search()},clearSearch:function(){var e=this.searchForm;e.equCode="",e.equName="",e.typeName="",e.deviceTypeId="",e.isRelated=""},search:function(){var e=this;this.tableLoading=!0,this.$RequestUtil.post({url:"/device/maintenanceSchedule/getMaintenanceSchedulePage",params:{page:this.pagination.currentPage,rows:this.pagination.pagesize,equCode:this.queryParams.equCode,equName:this.queryParams.equName,deviceTypeId:this.queryParams.deviceTypeId,orderType:this.queryParams.orderType,orderColumn:this.queryParams.orderColumn},success:function(t){e.tableData=t.data,e.tableData.forEach(function(e){e.cycleList||(e.cycleList=[])}),e.pagination.totalPage=t.totalPages,0==t.data.length&&e.$message.warning("查询不到符合条件的数据")}}).finally(function(){e.tableLoading=!1})},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},initTable:function(){this.search()},addWindowShow:function(){this.addDialogVisible=!0,this.addForm={idOfSchedule:null,deviceTypeId:null,idOfDevice:null,maintenanceWorkerId:null,serviceWorkerId:null,electricInfo:null,operationManual:null,serviceManual:null,otherInfo:null,businessLeaderId:null,chiefLeaderId:null,equName:"",typeName:"",equManufacturers:"",useDate:null,cycleList:[]}},cancelEditDialog:function(){this.editDialogVisible=!1,this.addForm={idOfSchedule:null,deviceTypeId:null,idOfDevice:null,maintenanceWorkerId:null,serviceWorkerId:null,electricInfo:null,operationManual:null,serviceManual:null,otherInfo:null,businessLeaderId:null,chiefLeaderId:null,equName:"",typeName:"",equManufacturers:"",useDate:null,cycleList:[]},this.configList=[],this.selectOption=[],this.levelOption.forEach(function(e){e.disabled=!1})},updateDevice:function(){var e=this;this.$refs.editForm.validate(function(t){if(t){var a="";a=e.addForm.idOfSchedule?"/api/maintenanceSchedule/updateSchedule":"/device/maintenanceSchedule/updateMaintenanceSchedule",e.addForm.cycleList.length>0&&e.addForm.cycleList.forEach(function(t){1==t.cycleType&&(t.cycleValue=1,t.daysAhead=null),t.maintenanceScheduleId=e.addForm.maintenanceScheduleId}),e.$RequestUtil.post({url:a,params:e.addForm,success:function(t){e.addForm={idOfSchedule:null,deviceTypeId:null,idOfDevice:null,maintenanceWorkerId:null,serviceWorkerId:null,electricInfo:null,operationManual:null,serviceManual:null,otherInfo:null,businessLeaderId:null,chiefLeaderId:null,equName:"",typeName:"",equManufacturers:"",useDate:null,cycleList:[]},e.configList=[],e.selectOption=[],e.$message({type:"success",message:"修改成功"}),e.initTable(),e.editDialogVisible=!1,e.levelOption.forEach(function(e){e.disabled=!1})}})}else e.$message({type:"error",message:"请补充必填项!"})})},showEditDialog:function(){var e=o()(r.a.mark(function e(t){var a,l,i=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.a.openLoading(),e.next=3,this.loadCareUser(t.id);case 3:return this.careUserList=e.sent,e.next=6,this.loadRepairUser(t.id);case 6:for(l in this.repairUserList=e.sent,this.addForm.maintenanceScheduleId=t.id,this.addForm.equCode=t.equCode,this.addForm.workshopName=t.workshopName,this.addForm.equName=t.equName,this.addForm.typeName=t.typeName,this.addForm.equManufacturers=t.equManufacturers,this.addForm.useDate=commonUtils.timestampToDate(t.useDate,!0),this.addForm.deviceTypeIdCype=this.parseDeviceType(t),t.idOfSchedule?this.addForm.idOfSchedule=t.idOfSchedule:this.addForm.idOfSchedule=null,this.addForm.deviceTypeId=t.deviceTypeId,this.addForm.idOfDevice=t.id,this.addForm.deviceId=t.deviceId,a=function(e){var a=t.cycleList[e];i.levelOption.forEach(function(e){e.value==a.level&&(e.disabled=!0)}),i.levelSelect(a.level,e,t.deviceId,!0),i.cycleTypeChange(a.cycleType,e,!0)},t.cycleList)a(l);this.addForm.cycleList=commonUtils.cloneObj(t.cycleList),m.a.closeLoading(),this.editDialogVisible=!0;case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),parseLeve:function(e){var t="";switch(Number(e.level)){case 1:t="一级";break;case 2:t="二级";break;case 3:t="三级"}return t},parseTime:function(e){var t="";switch(Number(e.cycleType)){case 1:t="每日";break;case 2:t="每周";break;case 3:t="每月";break;case 4:t="每半年";break;case 5:t="每年";break;case 6:t="每季度"}return t},viewDevice:function(e){this.addForm.id=e.id,this.addForm.equCode=e.equCode,this.addForm.equName=e.equName,this.addForm.typeName=e.typeName,this.addForm.equManufacturers=e.equManufacturers,this.addForm.cycleList=e.cycleList,this.addForm.workshopName=e.workshopName,this.addForm.useDate=commonUtils.timestampToDate(e.useDate,!0),this.viewDialogVisible=!0},deleteDevice:function(e){var t=this;this.$confirm("此操作将清空保养计划，是否继续","提示",{cancelButtonClass:"btn-custom-cancel",confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){t.$RequestUtil.post({url:"/device/maintenanceSchedule/deleteMaintenanceSchedule",type:"sync",params:{id:e.id},success:function(e){-1!=e.code?(t.$message({type:"success",message:"清空成功!"}),t.initTable()):t.$message({type:"error",message:e.msg||e.message})}})})},parseRelation:function(e){return null==e.workshopId?"未关联":"已关联"},parseDeviceType:function(e){var t="";return this.deviceTypeOptions.forEach(function(a){a.id==e.deviceTypeId&&(t=a.deviceType)}),t},parseDate:function(e){if(null!=e.useDate)return commonUtils.timestampToDate(e.useDate,!0)}}},v={render:function(){var e=this,t=this,a=t.$createElement,l=t._self._c||a;return l("div",{staticClass:"list-window",attrs:{id:"cara-plan"}},[l("div",{staticClass:"searchbar"},[l("searchInput",{attrs:{"search-arr":t.searchArr},on:{clear:function(e){t.clearPart(e)},search:function(e){t.searchPart(e)},querySelect:function(e){var a=e.queryString,l=e.cb;t.queryBindDtu(a,l)}}})],1),t._v(" "),l("div",{staticClass:"list-div"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"deviceTable y_Public_table",staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""},on:{"sort-change":t.sortChangeEvent}},[l("el-table-column",{attrs:{prop:"equCode",sortable:"custom",label:"设备编号",width:"110","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.equCode,placement:"top-start"}},[l("div",{staticClass:"y_clamp"},[l("div",[t._v(t._s(e.row.equCode))])])])]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"equName",sortable:"custom",label:"设备名称","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.equName,placement:"top-start"}},[l("div",{staticClass:"y_clamp"},[l("div",[t._v(t._s(e.row.equName))])])])]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"typeName",sortable:"custom",label:"设备品类","min-width":"110","show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{prop:"equManufacturers",sortable:"custom",label:"厂家","min-width":"100","show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"一级保养","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hasLevel(e.row,1)?l("div",[t._v(t._s(t._f("showContent")(e.row.cycleList,1)))]):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"},on:{click:function(a){return t.showPlanDialog(1,e.row.deviceTypeId,e)}}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"二级保养","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hasLevel(e.row,2)?l("div",[t._v(t._s(t._f("showContent")(e.row.cycleList,2)))]):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"},on:{click:function(a){return t.showPlanDialog(2,e.row.deviceTypeId,e)}}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"三级保养","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hasLevel(e.row,3)?l("div",[t._v(t._s(t._f("showContent")(e.row.cycleList,3)))]):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"},on:{click:function(a){return t.showPlanDialog(3,e.row.deviceTypeId,e)}}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"电气资料","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.electricInfo?l("div",{staticStyle:{position:"relative"}},[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.electricInfo,placement:"bottom-end"}},[l("img",{staticStyle:{width:"24px",cursor:"pointer",top:"5px",position:"relative"},attrs:{src:t.getFilePath(e.row.electricInfo)},on:{click:function(a){return t.showFile(e.row.electricInfo)}}})]),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("div",{staticClass:"file-delete",staticStyle:{position:"absolute"},on:{click:function(a){return t.deleteFile(e.row,"electricInfo")}}}):t._e()],1):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"}},[l("el-upload",{attrs:{action:t.uploadUrl(1,e.row),"before-upload":function(a){return t.beforeUpload(a,1,e.row)},"on-success":t.uploadComplete}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"操作手册","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.operationManual?l("div",{staticStyle:{position:"relative"}},[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.operationManual,placement:"bottom-end"}},[l("img",{staticStyle:{width:"24px",cursor:"pointer",top:"5px",position:"relative"},attrs:{src:t.getFilePath(e.row.operationManual)},on:{click:function(a){return t.showFile(e.row.operationManual)}}})]),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("div",{staticClass:"file-delete",staticStyle:{position:"absolute"},on:{click:function(a){return t.deleteFile(e.row,"operationManual")}}}):t._e()],1):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"}},[l("el-upload",{attrs:{action:t.uploadUrl(2,e.row),"before-upload":function(a){return t.beforeUpload(a,2,e.row)},"on-success":t.uploadComplete}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"维修手册","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.serviceManual?l("div",{staticStyle:{position:"relative"}},[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.serviceManual,placement:"bottom-end"}},[l("img",{staticStyle:{width:"24px",cursor:"pointer",top:"5px",position:"relative"},attrs:{src:t.getFilePath(e.row.serviceManual)},on:{click:function(a){return t.showFile(e.row.serviceManual)}}})]),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("div",{staticClass:"file-delete",staticStyle:{position:"absolute"},on:{click:function(a){return t.deleteFile(e.row,"serviceManual")}}}):t._e()],1):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"}},[l("el-upload",{attrs:{action:t.uploadUrl(3,e.row),"before-upload":function(a){return t.beforeUpload(a,3,e.row)},"on-success":t.uploadComplete}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"其他资料","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.otherInfo?l("div",{staticStyle:{position:"relative"}},[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.otherInfo,placement:"bottom-end"}},[l("img",{staticStyle:{width:"24px",cursor:"pointer",top:"5px",position:"relative"},attrs:{src:t.getFilePath(e.row.otherInfo)},on:{click:function(a){return t.showFile(e.row.otherInfo)}}})]),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("div",{staticClass:"file-delete",staticStyle:{position:"absolute"},on:{click:function(a){return t.deleteFile(e.row,"otherInfo")}}}):t._e()],1):l("div",{staticStyle:{width:"24px",height:"24px",border:"dotted #999999 1px","text-align":"center",cursor:"pointer"}},[l("el-upload",{attrs:{action:t.uploadUrl(4,e.row),"before-upload":function(a){return t.beforeUpload(a,4,e.row)},"on-success":t.uploadComplete}},[l("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"16px","margin-top":"2px",color:"#999999"}})])],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"操作",fixed:"right",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.$PERMISSION.MAINTENANCESCHEDULEPAGE_READ?l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.viewDevice(e.row)}}},[t._v("查看")]):t._e(),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("span",{staticClass:"vertical"}):t._e(),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.showEditDialog(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("span",{staticClass:"vertical"}):t._e(),t._v(" "),t.$PERMISSION.MAINTENANCESCHEDULEPAGE_WRITE?l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.deleteDevice(e.row)}}},[t._v("清空")]):t._e()]}}])})],1),t._v(" "),l("Pagination",{attrs:{total:t.pagination.totalPage,"page-num":t.pagination.currentPage},on:{pageChange:t.pageChange}})],1),t._v(" "),l("el-dialog",{attrs:{id:"edit-care-plan",title:"编辑设备保养",visible:t.editDialogVisible,width:5==t.span?"71%":"68%","close-on-click-modal":!1},on:{"update:visible":function(e){t.editDialogVisible=e},close:t.cancelEditDialog}},[l("el-form",{ref:"editForm",staticClass:"add_form",staticStyle:{width:"100%"},attrs:{model:t.addForm,rules:t.rules}},[t.addForm.cycleList.length<3?l("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(e){return t.addCycleList()}}},[t._v("配置保养计划")])],1)],1):t._e(),t._v(" "),l("br"),t._v(" "),l("el-table",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:t.addForm.cycleList}},[l("el-table-column",{attrs:{label:"序号","min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",[l("span",[t._v(t._s(e.$index+1))])])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"保养级别","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",{attrs:{prop:"cycleList["+e.$index+"].level"}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"保养级别",filterable:""},on:{change:function(a){return t.levelSelect(a,e.$index,t.addForm.deviceId)}},model:{value:t.addForm.cycleList[e.$index].level,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"level",a)},expression:"addForm.cycleList[scope.$index].level"}},t._l(t.levelOption,function(e){return l("el-option",{key:e.value,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}),1)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"保养方式",prop:"content","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",{attrs:{prop:"cycleList["+e.$index+"].configId",rules:t.rules.configId}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small","no-data-text":t.addForm.cycleList[e.$index].level?"暂无数据":"请先选择保养级别",placeholder:"请先选择保养级别",filterable:""},model:{value:t.addForm.cycleList[e.$index].configId,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"configId",a)},expression:"addForm.cycleList[scope.$index].configId"}},[t.configList[e.$index]?t._l(t.configList[e.$index],function(e){return l("el-option",{key:e.id,attrs:{label:e.configName,value:e.id}})}):l("el-option",{attrs:{label:t.addForm.cycleList[e.$index].configName,value:t.addForm.cycleList[e.$index].configId}})],2)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"保养周期","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",{attrs:{prop:"cycleList["+e.$index+"].cycleType",rules:t.rules.cycleType}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"保养周期",filterable:""},on:{change:function(a){return t.cycleTypeChange(a,e.$index)}},model:{value:t.addForm.cycleList[e.$index].cycleType,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"cycleType",a)},expression:"addForm.cycleList[scope.$index].cycleType"}},t._l(t.timeOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"保养日","min-width":"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==t.addForm.cycleList[e.$index].cycleType?l("el-form-item",[l("span",{staticStyle:{"padding-left":"10px"}},[t._v("每日")])]):l("el-form-item",{attrs:{prop:"cycleList["+e.$index+"].cycleValue"}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"保养日",filterable:""},model:{value:t.addForm.cycleList[e.$index].cycleValue,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"cycleValue",a)},expression:"addForm.cycleList[scope.$index].cycleValue"}},t._l(t.selectOption[e.$index],function(e,t){return l("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"提前派发天数","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==t.addForm.cycleList[e.$index].cycleType?l("el-form-item",[l("span",{staticStyle:{"padding-left":"10px"}})]):l("el-form-item",[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:" ",filterable:"",clearable:""},model:{value:t.addForm.cycleList[e.$index].daysAhead,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"daysAhead",a)},expression:"addForm.cycleList[scope.$index].daysAhead"}},t._l(t.daysAheadOption[e.$index],function(e){return l("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"保养人","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",{attrs:{prop:"cycleList["+e.$index+"].maintenanceWorkerId",rules:t.rules.maintenanceWorkerId}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",loading:t.loading,placeholder:"选择保养人",filterable:""},on:{"visible-change":function(a){return t.closeSelect(a,t.addForm.id,"edit",e.$index,t.addForm.cycleList[e.$index].maintenanceWorkerId)}},model:{value:t.addForm.cycleList[e.$index].maintenanceWorkerId,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"maintenanceWorkerId",a)},expression:"addForm.cycleList[scope.$index].maintenanceWorkerId"}},t._l(t.careUserList,function(e){return l("el-option",{key:e.id,attrs:{label:e.nickName,value:e.id}})}),1)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"维修人","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",[l("el-select",{attrs:{size:"small"},model:{value:t.addForm.cycleList[e.$index].serviceWorkerId,callback:function(a){t.$set(t.addForm.cycleList[e.$index],"serviceWorkerId",a)},expression:"addForm.cycleList[scope.$index].serviceWorkerId"}},t._l(t.repairUserList,function(e){return l("el-option",{key:e.id,attrs:{label:e.nickName,value:e.id}})}),1)],1)]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"操作",fixed:"right","min-width":"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-form-item",[l("div",{staticClass:"delete",attrs:{type:"primary"},on:{click:function(a){return t.removeDetail(e.$index)}}})])]}}])})],1)],1),t._v(" "),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"primary"},on:{click:t.updateDevice}},[t._v("确 定")])],1)],1),t._v(" "),l("el-dialog",{attrs:{title:"查看设备保养",visible:t.viewDialogVisible,width:"620px","close-on-click-modal":!1},on:{"update:visible":function(e){t.viewDialogVisible=e},close:t.cancelViewDialog}},[l("div",{staticClass:"detail_info"},[l("div",{staticClass:"info"},[l("div",{staticClass:"label"},[t._v("设备编号：")]),t._v(" "),l("div",{staticClass:"value"},[t._v(t._s(t.addForm.equCode))])]),t._v(" "),l("div",{staticClass:"info"},[l("div",{staticClass:"label"},[t._v("设备名称：")]),t._v(" "),l("div",{staticClass:"value"},[t._v(t._s(t.addForm.equName))])]),t._v(" "),l("div",{staticClass:"info"},[l("div",{staticClass:"label"},[t._v("设备品类：")]),t._v(" "),l("div",{staticClass:"value"},[t._v(t._s(t.addForm.typeName))])]),t._v(" "),l("div",{staticClass:"info"},[l("div",{staticClass:"label"},[t._v("设备厂家：")]),t._v(" "),l("div",{staticClass:"value"},[t._v(t._s(t.addForm.equManufacturers))])])]),t._v(" "),l("el-table",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:t.addForm.cycleList}},[l("el-table-column",{attrs:{label:"序号","min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("span",[t._v(t._s(e.$index+1))])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"保养级别","min-width":"100",prop:"level",formatter:t.parseLeve,"show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"保养方式",prop:"configName","min-width":"100","show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"保养周期","min-width":"80",prop:"cycleType",formatter:t.parseTime,"show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"保养日","min-width":"120",prop:"cycleValue",formatter:t.parsecycleValue,"show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"提前派发天数(单位：天)","min-width":"150",prop:"daysAhead","show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"保养人","min-width":"100",prop:"maintenanceWorkerName","show-overflow-tooltip":""}}),t._v(" "),l("el-table-column",{attrs:{label:"维修人","min-width":"100",prop:"serviceWorkerName","show-overflow-tooltip":""}})],1)],1),t._v(" "),l("el-dialog",{attrs:{title:"保养周期",visible:t.planDialogVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(e){t.planDialogVisible=e},close:t.cancelpalnDialog}},[l("el-form",{ref:"plan",staticClass:"add_form",staticStyle:{width:"100%"},attrs:{"label-width":"100px",model:t.plan,rules:t.rules}},[l("el-row",{attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("div",{},[l("el-form-item",{staticClass:"el-inputcss",staticStyle:{display:"inline-block"},attrs:{label:"保养方式：",prop:"configId",rules:t.rules.configId}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small","no-data-text":"暂无数据",placeholder:"保养方式",filterable:""},model:{value:t.plan.configId,callback:function(e){t.$set(t.plan,"configId",e)},expression:"plan.configId"}},t._l(t.configOption,function(e){return l("el-option",{key:e.id,attrs:{label:e.configName,value:e.id}})}),1)],1)],1)])],1),t._v(" "),l("el-row",{attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("div",{},[l("el-form-item",{staticClass:"el-inputcss",staticStyle:{display:"inline-block"},attrs:{label:"保养周期：",prop:"cycleType",rules:t.rules.cycleType}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"保养周期",filterable:""},on:{change:function(e){return t.cycleTypeChange(e,"plan",1)}},model:{value:t.plan.cycleType,callback:function(e){t.$set(t.plan,"cycleType",e)},expression:"plan.cycleType"}},t._l(t.timeOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)])],1),t._v(" "),l("el-row",{directives:[{name:"show",rawName:"v-show",value:1!=t.plan.cycleType,expression:"plan.cycleType!=1"}],attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("div",{},[l("el-form-item",{staticClass:"el-inputcss",staticStyle:{display:"inline-block"},attrs:{label:"保养日："}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"保养日",filterable:""},model:{value:t.plan.cycleValue,callback:function(e){t.$set(t.plan,"cycleValue",e)},expression:"plan.cycleValue"}},t._l(t.selectOption[0],function(e,t){return l("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1)])],1),t._v(" "),l("el-row",{directives:[{name:"show",rawName:"v-show",value:1!=t.plan.cycleType,expression:"plan.cycleType!=1"}],attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("div",{},[l("el-form-item",{staticClass:"el-inputcss",staticStyle:{display:"inline-block"},attrs:{label:"提前派发天数：",prop:"daysAhead",rules:t.rules.daysAhead}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"提前派发天数",filterable:"",clearable:""},model:{value:t.plan.daysAhead,callback:function(e){t.$set(t.plan,"daysAhead",e)},expression:"plan.daysAhead"}},t._l(t.daysAheadOption[0],function(e){return l("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)])],1),t._v(" "),l("el-row",{attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("div",[l("el-form-item",{staticClass:"el-inputcss",staticStyle:{display:"inline-block"},attrs:{label:"保养人：",prop:"maintenanceWorkerId",rules:t.rules.maintenanceWorkerId}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"选择保养人",remote:"","remote-method":function(t){e.remoteMethod(t,e.plan.id,"add")},loading:t.loading,filterable:""},on:{"visible-change":function(e){return t.closeSelect(e,t.plan.id,"add",0,t.plan.maintenanceWorkerId)}},model:{value:t.plan.maintenanceWorkerId,callback:function(e){t.$set(t.plan,"maintenanceWorkerId",e)},expression:"plan.maintenanceWorkerId"}},t._l(t.careUser,function(e){return l("el-option",{key:e.id,attrs:{label:e.nickName,value:e.id}})}),1)],1)],1)])],1),t._v(" "),l("el-row",{attrs:{gutter:20}},[l("el-col",{attrs:{span:24}},[l("div",[l("el-form-item",{staticClass:"el-inputcss",staticStyle:{display:"inline-block"},attrs:{label:"维修人："}},[l("el-select",{staticStyle:{display:"block"},attrs:{size:"small",placeholder:"维修人",remote:"","remote-method":function(t){e.remoteMethod1(t,e.plan.id,"add")},loading:t.loading,filterable:""},on:{"visible-change":function(e){return t.closeSelect1(e,t.plan.id,"add",0,t.plan.serviceWorkerId)}},model:{value:t.plan.serviceWorkerId,callback:function(e){t.$set(t.plan,"serviceWorkerId",e)},expression:"plan.serviceWorkerId"}},t._l(t.repairUser,function(e){return l("el-option",{key:e.id,attrs:{label:e.nickName,value:e.id}})}),1)],1)],1)])],1)],1),t._v(" "),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"primary"},on:{click:t.addPlan}},[t._v("确 定")])],1)],1),t._v(" "),l("FileView",{ref:"fileView"})],1)},staticRenderFns:[]};var y=a("C7Lr")(h,v,!1,function(e){a("cgyv"),a("BgBL")},"data-v-646d2dc3",null);t.default=y.exports},cVfm:function(e,t){},cgyv:function(e,t){},e9I6:function(e,t,a){a("B0Qb"),e.exports=a("ZuHZ").Number.isInteger},qgzg:function(e,t,a){var l=a("+kaZ"),i=Math.floor;e.exports=function(e){return!l(e)&&isFinite(e)&&i(e)===e}}});