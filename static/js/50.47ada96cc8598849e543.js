webpackJsonp([50],{Q6tu:function(e,a){},bykr:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var l=t("rVsN"),s=t.n(l),r=t("3cXf"),i=t.n(r),o=t("ZLEe"),u=t.n(o),n=t("lC5x"),d=t.n(n),c=t("J0Oq"),p=t.n(c),m={name:"alarmRule",components:{},data:function(){return{timeType:"ruleDetail.timeType",sendNeed:"",ruleModel:!1,ruleModelinner:!1,ruleModelType:"add",ruleDetailModel:!1,equTypeList:[],timePeriodList:[],messageTemplateList:[],templateList:[],loading:!1,currentRow:{},searchform:{ruleName:"",level:"",equTypeId:"",ruleType:"",isEnable:""},queryParams:{ruleName:"",level:"",isEnable:"",equTypeId:"",ruleType:"",orderColumn:"",orderType:"DESC"},tableData:[],sendTypeList:[],pagination:{currentPage:1,totalPage:0,pagesize:10},addForm:{name:"",ruleCode:"",remarks:"",alarmSendTypeId:"",level:3,timePeriodId:"0",duration:0,equTypes:[],ruleType:2,ruleDetailList:[],ruleDetailIndex:0,alarmSendTemplateId:""},addFormCZ:{name:"",ruleCode:"",remarks:"",alarmSendTypeId:"",level:3,timePeriodId:"0",duration:0,equTypes:[],ruleType:2,ruleDetailList:[],ruleDetailIndex:0,alarmSendTemplateId:""},rules:{ruleDetailList:[{required:!0,validator:function(e,a,t){0===a.length&&t(new Error("请添加")),t()}}]},expressForm:{ruleKey:[{sequence:0,keyType:1,keyValue:""}],operation:"=",ruleValue:[{sequence:0,keyType:1,keyValue:""}]},ruleDetail:{name:"",english:"",remarks:"",alarmRuleDetailList:[]},btnBoxShow:!1,hidebtn:!1,showbtn:!0,searchclass:"",searchArr:[]}},computed:{sendTypeName:function(){var e=this;return this.ruleDetail.alarmSendTypeId?this.sendTypeList.filter(function(a){return a.id.toString()===e.ruleDetail.alarmSendTypeId})[0].name:""},expressPreView:function(){var e="";return this.expressForm.ruleKey.forEach(function(a,t){if(1===a.keyType)e+="{"+a.keyValue+"} ";else if(2===a.keyType)e+=a.keyValue+" ";else switch(Number(a.keyValue)){case 1:e+="+ ";break;case 2:e+="- ";break;case 3:e+="* ";break;case 4:e+="/ ";break;case 5:e=e.replace(/\S+\s$/,"√$& ")}}),e+=this.expressForm.operation+" ",this.expressForm.ruleValue.forEach(function(a,t){if(1===a.keyType)e+="{"+a.keyValue+"} ";else if(2===a.keyType)e+=a.keyValue+" ";else switch(Number(a.keyValue)){case 1:e+="+ ";break;case 2:e+="- ";break;case 3:e+="* ";break;case 4:e+="/ ";break;case 5:e=e.replace(/\S+\s$/,"√$& ")}}),e}},created:function(){this.search(),this.getConfigInfo(),this.loadSenTypeList(),this.getTimePeriodList(),this.getMessageTemplateList()},mounted:function(){var e=p()(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searchArr=[{id:"1",label:"规则名称",value:"ruleName",type:"input",maxLen:"50"},{id:"2",label:"告警类型",value:"ruleType",type:"select",data:[{value:"1",label:"DTU通信告警"},{value:"2",label:"阈值告警"},{value:"3",label:"设备通讯告警"},{value:"99",label:"自定义告警"}]},{id:"3",label:"告警级别",value:"level",type:"select",data:[{value:"3",label:"低"},{value:"2",label:"中"},{value:"1",label:"高"}]},{id:"4",label:"设备品类",value:"equTypeId",type:"select",data:[]}],e.next=3,this.getModelList();case 3:this.searchArr[3].data=this.equTypeList;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{show:function(){this.hidebtn=!0,this.showbtn=!1,this.btnBoxShow=!0,this.searchclass="serheightZ",this.styleSear="style-sear"},hide:function(){this.hidebtn=!1,this.showbtn=!0,this.btnBoxShow=!1,this.searchclass="serheightS",this.styleSear="style-sear1"},sortChangeEvent:function(e){this.queryParams.orderColumn=e.order?e.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(e.order),this.pagination.currentPage=1,this.search()},parseTime:function(){},parseStatus:function(e){var a="";switch(e.status){case 0:a="待执行";break;case 1:a="执行中";break;case 2:a="已执行"}return a},pageChange:function(e){this.pagination.currentPage=e.page_index,this.pagination.pagesize=e.page_limit,this.search()},getConfigInfo:function(){var e=this;this.$RequestUtil.post({url:"/device/sysPlatformConfigure/getSystemPlatformConfigure",params:{},success:function(a){e.sendNeed=a.data.sendNeed}})},loadSenTypeList:function(){var e=this;this.$RequestUtil.get({url:"/device/alarmSendType/getSendTypeList",params:{},success:function(a){e.sendTypeList=a.data}})},sendTypeChange:function(e){var a=this;this.templateList=this.messageTemplateList.filter(function(a){return a.templateType==e}),this.$set(this.addForm,"alarmSendTemplateId",""),this.$nextTick(function(){a.$refs.alarmSendTemp.clearValidate()})},getMessageTemplateList:function(){var e=this;this.$RequestUtil.get({url:"/device/messageTemplate/getMessageTemplateList",params:{},success:function(a){e.templateList=a.data,e.messageTemplateList=a.data}})},getModelList:function(){var e=this;return this.$RequestUtil.post({url:"/device/equipmentType/getEquipmentTypeList",params:{},success:function(a){var t=[];a.data.forEach(function(e){t.push({label:e.typeName,value:e.id})}),e.equTypeList=t}})},getTimePeriodList:function(){var e=this;return this.$RequestUtil.post({url:"device/timePeriod/getTimePeriodList",params:{},success:function(a){e.timePeriodList=a.data}})},searchPart:function(e){var a=this;this.pagination.currentPage=1,u()(e).forEach(function(t){a.queryParams[t]=e[t]}),this.search()},search:function(){var e=this;this.loading=!0,this.$RequestUtil.post({url:"/device/alarmRule/getAlarmRuleListPage",params:{page:this.pagination.currentPage,rows:this.pagination.pagesize,name:this.queryParams.ruleName,level:this.queryParams.level,equTypeId:this.queryParams.equTypeId,ruleType:this.queryParams.ruleType,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(a){e.tableData=a.data,e.pagination.totalPage=a.totalPages,e.loading=!1}}).catch(function(){e.loading=!1})},ruleModelClose:function(e){this.templateList=[],this.addForm=JSON.parse(i()(this.addFormCZ)),e&&e()},expressPreViewClose:function(){this.$refs.expressForm.resetFields(),this.expressForm.ruleKey.length=this.expressForm.ruleValue.length=1},addRuleLine:function(){var e=this;this.$refs.expressForm.validate(function(a){a&&("add"===e.expressForm.status?e.addForm.ruleDetailList.push({ruleKey:JSON.parse(i()(e.expressForm.ruleKey)),operation:JSON.parse(i()(e.expressForm.operation)),ruleValue:JSON.parse(i()(e.expressForm.ruleValue)),expression:e.expressPreView,correlation:0!=e.addForm.ruleDetailList.length?"and":""}):(e.addForm.ruleDetailList[e.addForm.ruleDetailIndex].ruleKey=JSON.parse(i()(e.expressForm.ruleKey)),e.addForm.ruleDetailList[e.addForm.ruleDetailIndex].operation=JSON.parse(i()(e.expressForm.operation)),e.addForm.ruleDetailList[e.addForm.ruleDetailIndex].ruleValue=JSON.parse(i()(e.expressForm.ruleValue)),e.addForm.ruleDetailList[e.addForm.ruleDetailIndex].expression=e.expressPreView),e.ruleModelinner=!1)})},ruleDetailAdd:function(e){this.expressForm.status="add",this.addForm.ruleDetailIndex=e,this.ruleModelinner=!0},addRuleKey:function(e){3!==this.expressForm.ruleKey[e].keyType&&this.expressForm.ruleKey.push({sequence:this.expressForm.ruleKey.length,keyType:3,keyValue:""}),this.expressForm.ruleKey.push({sequence:this.expressForm.ruleKey.length,keyType:"",keyValue:""})},delRuleKey:function(e){this.expressForm.ruleKey.splice(-1)},addRuleValue:function(e){3!==this.expressForm.ruleValue[e].keyType&&this.expressForm.ruleValue.push({sequence:this.expressForm.ruleValue.length,keyType:3,keyValue:""}),this.expressForm.ruleValue.push({sequence:this.expressForm.ruleValue.length,keyType:"",keyValue:""})},delRuleValue:function(e){this.expressForm.ruleValue.splice(-1)},editRuleLine:function(e){this.addForm.ruleDetailIndex=e,this.expressForm.status="edit",this.expressForm=JSON.parse(i()(this.addForm.ruleDetailList[e])),this.ruleModelinner=!0},delRuleLine:function(e){this.addForm.ruleDetailList.splice(e,1)},clear:function(e){var a=this;u()(e).forEach(function(t){a.queryParams[t]=e[t]})},addRuleSpecfic:function(){var e=this;this.$refs.ruleForm.validate(function(a){if(a){var t="/device/alarmRule/insertAlarmRule";"edit"===e.ruleModelType&&(t="/device/alarmRule/updateAlarmRule"),e.addForm.ruleEquTypeList=e.addForm.equTypes.map(function(e){return{equTypeId:e}}),e.$RequestUtil.postSync({url:t,params:e.addForm,success:function(a){e.$message.success(a.msg),e.ruleModel=!1,e.search()}})}})},delRule:function(e){var a=this;this.$confirm("确认删除？","提示",{type:"warning"}).then(function(){a.$RequestUtil.post({url:"/device/alarmRule/deleteAlarmRule",params:{id:e.id},success:function(e){a.$message.success(e.msg),a.pagination.currentPage=1,a.search()}})})},getRuleDetail:function(e){var a=this,t=this;return new s.a(function(l){t.$RequestUtil.post({url:"/device/alarmRule/getAlarmRuleInfo",params:{id:e.id},success:function(e){a.ruleDetail=JSON.parse(i()(e.data)),0!==e.data.alarmEquipmentTypeList.length&&(a.ruleDetail.alarmEquipmentTypeList=e.data.alarmEquipmentTypeList.map(function(e){return e.typeName}).reduce(function(e,a){return e+","+a})),a.ruleDetail.alarmRuleLevel=e.data.alarmRuleLevel.toString().replace("1","高").replace("2","中").replace("3","低"),a.ruleDetail.alarmRuleRuleType=e.data.alarmRuleRuleType.toString().replace("1","DTU通信告警").replace("2","阈值告警").replace("3","设备通讯告警").replace("3","自定义"),l(e.data)}})})},showRuleDetail:function(e){var a=this;return p()(d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.getRuleDetail(e);case 2:a.ruleDetailModel=!0;case 3:case"end":return t.stop()}},t,a)}))()},editRule:function(e){var a=this;return p()(d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.templateList=a.messageTemplateList.filter(function(a){return a.templateType==e.alarmSendTypeId}),t.next=3,a.$nextTick();case 3:a.currentRow=e,a.ruleModelType="edit",a.addForm.level=e.level,a.addForm.ruleType=e.ruleType,a.addForm.alarmSendTemplateId=e.alarmSendTemplateId,a.addForm.alarmSendTypeId=e.alarmSendTypeId,a.getRuleDetail(e).then(function(t){a.addForm.id=e.id,a.addForm.name=t.alarmRuleName,a.addForm.ruleCode=t.alarmRuleRuleCode,a.addForm.ruleType=t.alarmRuleRuleType,a.addForm.level=t.alarmRuleLevel,a.addForm.equTypes=t.alarmEquipmentTypeList.map(function(e){return e.id}),a.addForm.duration=t.alarmRuleDuration,a.addForm.timePeriodId=t.alarmRuleTimePeriod,a.addForm.remarks=t.alarmRuleRemarks,a.addForm.ruleDetailList=t.alarmRuleDetailList,a.ruleModel=!0});case 10:case"end":return t.stop()}},t,a)}))()},statusChange:function(e){var a=this;this.$confirm("确认"+(1===e.isEnable?"禁用？":"启用？"),"提示",{type:"warning"}).then(function(){a.$RequestUtil.post({url:"/device/alarmRule/isEnableAlarmRule",params:{id:e.id,ruleType:e.ruleType,isEnable:Number(!e.isEnable)},success:function(e){a.$message.success(e.msg),a.pagination.currentPage=1,a.search()}})})}}},v={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"list-window"},[t("div",{staticClass:"searchbar"},[t("searchInput",{attrs:{"search-arr":e.searchArr},on:{clear:function(a){e.clear(a)},search:function(a){e.searchPart(a)}}})],1),e._v(" "),e.$PERMISSION.ALARM_RULE_WRITE?t("div",{staticClass:"operatebar"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(){e.$nextTick(function(){e.ruleModelType="add",e.ruleModel=!0})}}},[e._v("新增")])],1):e._e(),e._v(" "),t("div",{staticClass:"list-div"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-row-class-name":"table-header-color","default-sort":{prop:e.queryParams.orderColumn,order:"descending"}},on:{"sort-change":e.sortChangeEvent}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"规则名称",sortable:"custom"}}),e._v(" "),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"ruleCode",label:"规则编号",sortable:"custom"}}),e._v(" "),t("el-table-column",{attrs:{"show-overflow-tooltip":"",sortable:"custom",prop:"ruleType",formatter:function(e){return e.ruleType.toString().replace("1","DTU通信告警").replace("2","阈值告警").replace("3","设备通讯告警").replace("3","自定义")},label:"告警类型"}}),e._v(" "),t("el-table-column",{attrs:{"show-overflow-tooltip":"",sortable:"custom",prop:"level",formatter:function(e){return e.level.toString().replace("1","高").replace("2","中").replace("3","低")},label:"告警级别"}}),e._v(" "),t("el-table-column",{attrs:{label:"设备品类","show-overflow-tooltip":"",sortable:"custom",prop:"alarmEquipmentTypeList",formatter:function(e){var a=e.alarmEquipmentTypeList.map(function(e){return e.typeName});return 0==a.length?"":a.reduce(function(e,a){return e+","+a})}}}),e._v(" "),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"状态",prop:"isEnable",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:{color:0===a.row.isEnable?"red":"rgb(41, 197, 90)"},attrs:{type:"text",size:"mini"}},[e._v("\n            "+e._s(a.row.isEnable.toString().replace("0","禁用").replace("1","启用"))+"\n          ")])]}}])}),e._v(" "),t("el-table-column",{attrs:{"show-overflow-tooltip":"",sortable:"custom",prop:"gmtCreate",formatter:function(a){return e.$method.formatterTime(a.gmtCreate)},label:"创建时间"}}),e._v(" "),t("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.showRuleDetail(a.row)}}},[e._v("详情")]),e._v(" "),e.$PERMISSION.ALARM_RULE_WRITE?t("span",[t("span",{staticClass:"vertical"}),e._v(" "),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.editRule(a.row)}}},[e._v("编辑")]),e._v(" "),t("span",{staticClass:"vertical"}),e._v(" "),t("el-button",{attrs:{disabled:1===a.row.ruleType,type:"text",size:"mini"},on:{click:function(t){return e.statusChange(a.row)}}},[e._v(e._s(0===a.row.isEnable?"启用":"禁用"))])],1):e._e(),e._v(" "),t("span",{staticClass:"vertical"}),e._v(" "),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.delRule(a.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),t("Pagination",{attrs:{total:e.pagination.totalPage,"page-num":e.pagination.currentPage},on:{pageChange:e.pageChange}})],1),e._v(" "),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"add"===e.ruleModelType?"新增规则":"编辑规则",visible:e.ruleModel,width:"42%"},on:{"update:visible":function(a){e.ruleModel=a},close:function(a){return e.ruleModelClose()},open:function(){e.$refs.ruleForm&&e.$refs.ruleForm.clearValidate()}}},[t("el-dialog",{attrs:{width:"50%","close-on-click-modal":!1,title:"规则表达式",visible:e.ruleModelinner,"append-to-body":""},on:{"update:visible":function(a){e.ruleModelinner=a},close:e.expressPreViewClose}},[t("h4",[e._v("表达式预览:"+e._s(e.expressPreView))]),e._v(" "),t("br"),e._v(" "),t("el-form",{ref:"expressForm",attrs:{model:e.expressForm},model:{value:e.expressForm,callback:function(a){e.expressForm=a},expression:"expressForm"}},[t("el-row",{staticClass:"left-label"},[t("el-col",{attrs:{span:6}},[e._v("规则键")]),e._v(" "),t("el-col",{attrs:{span:16}},e._l(e.expressForm.ruleKey,function(a,l){return t("div",{key:l},[t("el-row",[t("el-col",{attrs:{span:9}},[t("el-form-item",{attrs:{prop:"ruleKey["+l+"].keyType",required:"","show-message":!1}},[t("el-select",{staticClass:"form__input_rule",model:{value:a.keyType,callback:function(t){e.$set(a,"keyType",t)},expression:"item.keyType"}},[0===l||3===e.expressForm.ruleKey[l-1].keyType?t("el-option",{attrs:{label:"字段名",value:1}}):e._e(),e._v(" "),0===l||3===e.expressForm.ruleKey[l-1].keyType?t("el-option",{attrs:{label:"常量",value:2}}):e._e(),e._v(" "),0===l||3===e.expressForm.ruleKey[l-1].keyType&&"5"!==e.expressForm.ruleKey[l-1].keyValue?e._e():t("el-option",{attrs:{label:"运算符",value:3}})],1)],1)],1),e._v(" "),t("el-col",{attrs:{span:10}},[3!==a.keyType?t("el-form-item",{attrs:{prop:"ruleKey["+l+"].keyValue",rules:e.$Global.FORM_RULE.required.concat(e.$Global.FORM_RULE.noSpecialChar)}},[t("el-input",{attrs:{maxlength:"100"},model:{value:a.keyValue,callback:function(t){e.$set(a,"keyValue",t)},expression:"item.keyValue"}})],1):t("el-form-item",{attrs:{prop:"ruleKey["+l+"].keyValue","show-message":!1,required:""}},[t("el-select",{model:{value:a.keyValue,callback:function(t){e.$set(a,"keyValue",t)},expression:"item.keyValue"}},[t("el-option",{attrs:{label:"加号",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"减号",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"乘号",value:"3"}}),e._v(" "),t("el-option",{attrs:{label:"除号",value:"4"}}),e._v(" "),t("el-option",{attrs:{label:"开根号",value:"5"}})],1)],1)],1),e._v(" "),t("el-col",{attrs:{span:4,offset:1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:l===e.expressForm.ruleKey.length-1,expression:"index === expressForm.ruleKey.length-1"}],attrs:{type:"text"},on:{click:function(a){return e.addRuleKey(l)}}},[e._v("添加")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:l===e.expressForm.ruleKey.length-1&&0!=l,expression:"index === expressForm.ruleKey.length-1 && index!=0"}],attrs:{type:"text"},on:{click:function(a){return e.delRuleKey(l)}}},[e._v("删除")])],1)],1)],1)}),0)],1),e._v(" "),t("el-row",{staticClass:"left-label"},[t("el-col",{attrs:{span:6}},[e._v("规则运算符")]),e._v(" "),t("el-col",{attrs:{span:16}},[t("el-form-item",[t("el-select",{staticClass:"form__input_rule",model:{value:e.expressForm.operation,callback:function(a){e.$set(e.expressForm,"operation",a)},expression:"expressForm.operation"}},[t("el-option",{attrs:{value:">"}}),e._v(" "),t("el-option",{attrs:{value:">="}}),e._v(" "),t("el-option",{attrs:{value:"="}}),e._v(" "),t("el-option",{attrs:{value:"<"}}),e._v(" "),t("el-option",{attrs:{value:"<="}}),e._v(" "),t("el-option",{attrs:{value:"is"}}),e._v(" "),t("el-option",{attrs:{value:"isnot"}})],1)],1)],1)],1),e._v(" "),t("el-row",{staticClass:"left-label"},[t("el-col",{attrs:{span:6}},[e._v("规则值")]),e._v(" "),t("el-col",{attrs:{span:16}},e._l(e.expressForm.ruleValue,function(a,l){return t("div",{key:l},[t("el-row",[t("el-col",{attrs:{span:9}},[t("el-form-item",{attrs:{prop:"ruleValue["+l+"].keyType",required:"","show-message":!1}},[t("el-select",{staticClass:"form__input_rule",model:{value:a.keyType,callback:function(t){e.$set(a,"keyType",t)},expression:"item.keyType"}},[0===l||3===e.expressForm.ruleValue[l-1].keyType?t("el-option",{attrs:{label:"字段名",value:1}}):e._e(),e._v(" "),0===l||3===e.expressForm.ruleValue[l-1].keyType?t("el-option",{attrs:{label:"常量",value:2}}):e._e(),e._v(" "),0===l||3===e.expressForm.ruleValue[l-1].keyType&&"5"!==e.expressForm.ruleValue[l-1].keyValue?e._e():t("el-option",{attrs:{label:"运算符",value:3}})],1)],1)],1),e._v(" "),t("el-col",{attrs:{span:10}},[3!==a.keyType?t("el-form-item",{attrs:{prop:"ruleValue["+l+"].keyValue",rules:e.$Global.FORM_RULE.required.concat(e.$Global.FORM_RULE.noSpecialChar)}},[t("el-input",{attrs:{maxlength:"100"},model:{value:a.keyValue,callback:function(t){e.$set(a,"keyValue",t)},expression:"item.keyValue"}})],1):t("el-form-item",{attrs:{prop:"ruleValue["+l+"].keyValue",required:"","show-message":!1}},[t("el-select",{model:{value:a.keyValue,callback:function(t){e.$set(a,"keyValue",t)},expression:"item.keyValue"}},[t("el-option",{attrs:{label:"加号",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"减号",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"乘号",value:"3"}}),e._v(" "),t("el-option",{attrs:{label:"除号",value:"4"}}),e._v(" "),t("el-option",{attrs:{label:"开根号",value:"5"}})],1)],1)],1),e._v(" "),t("el-col",{attrs:{span:4,offset:1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:l===e.expressForm.ruleValue.length-1,expression:"index === expressForm.ruleValue.length-1"}],attrs:{type:"text"},on:{click:function(a){return e.addRuleValue(l)}}},[e._v("添加")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:l===e.expressForm.ruleValue.length-1&&0!=l,expression:"index === expressForm.ruleValue.length-1 && index!= 0"}],attrs:{type:"text"},on:{click:function(a){return e.delRuleValue(l)}}},[e._v("删除")])],1)],1)],1)}),0)],1)],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){e.ruleModelinner=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addRuleLine}},[e._v("确 定")])],1)],1),e._v(" "),e.ruleModel?t("el-form",{ref:"ruleForm",attrs:{rules:e.rules,"label-width":"auto",model:e.addForm,inline:"",width:"900","label-position":"right"}},[t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"规则名称：",prop:"name",rules:e.$Global.FORM_RULE.required.concat(e.$Global.FORM_RULE.noSpecialChar)}},[t("el-input",{staticClass:"form__input_class",attrs:{maxlength:"50",placeholder:"请输入规则名称"},model:{value:e.addForm.name,callback:function(a){e.$set(e.addForm,"name",a)},expression:"addForm.name"}})],1),e._v(" "),t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"规则编号：",prop:"ruleCode",rules:e.$Global.FORM_RULE.required.concat(e.$Global.FORM_RULE.noSpecialChar)}},[t("el-input",{staticClass:"form__input_class",attrs:{maxlength:"50",placeholder:"请输入规则编号"},model:{value:e.addForm.ruleCode,callback:function(a){e.$set(e.addForm,"ruleCode",a)},expression:"addForm.ruleCode"}})],1),e._v(" "),t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"告警类型："}},[t("el-select",{staticClass:"form__input_class",attrs:{disabled:"add"!==e.ruleModelType,placeholder:"请选择告警类型"},model:{value:e.addForm.ruleType,callback:function(a){e.$set(e.addForm,"ruleType",a)},expression:"addForm.ruleType"}},[1===e.addForm.ruleType?t("el-option",{attrs:{label:"DTU通信告警",value:1}}):e._e(),e._v(" "),t("el-option",{attrs:{label:"阈值告警",value:2}}),e._v(" "),t("el-option",{attrs:{label:"设备通讯告警",value:3}})],1)],1),e._v(" "),t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"告警级别："}},[t("el-select",{staticClass:"form__input_class",attrs:{placeholder:"请选择告警级别"},model:{value:e.addForm.level,callback:function(a){e.$set(e.addForm,"level",a)},expression:"addForm.level"}},[t("el-option",{attrs:{label:"低",value:3}}),e._v(" "),t("el-option",{attrs:{label:"中",value:2}}),e._v(" "),t("el-option",{attrs:{label:"高",value:1}})],1)],1),e._v(" "),e.sendNeed?t("el-form-item",{staticClass:"el-inputcss",attrs:{prop:"alarmSendTypeId",label:"推送方式："}},[t("el-select",{staticClass:"form__input_class",attrs:{clearable:"",placeholder:"请选择推送方式"},on:{change:e.sendTypeChange},model:{value:e.addForm.alarmSendTypeId,callback:function(a){e.$set(e.addForm,"alarmSendTypeId",a)},expression:"addForm.alarmSendTypeId"}},e._l(e.sendTypeList,function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1):e._e(),e._v(" "),2===e.addForm.ruleType||3===e.addForm.ruleType?t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"设备品类：",rules:2===e.addForm.ruleType||3===e.addForm.ruleType?e.$Global.FORM_RULE.required:[],"show-message":!1,prop:"equTypes"}},[t("el-select",{staticClass:"form__input_class",attrs:{multiple:"",placeholder:"请选择设备品类"},model:{value:e.addForm.equTypes,callback:function(a){e.$set(e.addForm,"equTypes",a)},expression:"addForm.equTypes"}},e._l(e.equTypeList,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),e.addForm.alarmSendTypeId&&e.sendNeed?t("el-form-item",{ref:"alarmSendTemp",staticClass:"el-inputcss",attrs:{prop:"alarmSendTemplateId",label:"推送模板：",rules:e.sendNeed?e.$Global.FORM_RULE.required:[]}},[t("el-select",{staticClass:"form__input_class",attrs:{placeholder:"请选择推送模板"},model:{value:e.addForm.alarmSendTemplateId,callback:function(a){e.$set(e.addForm,"alarmSendTemplateId",a)},expression:"addForm.alarmSendTemplateId"}},e._l(e.templateList.filter(function(a){return 1===e.addForm.ruleType?1===a.deviceType:0===a.deviceType}),function(a){return t("el-option",{key:a.id,attrs:{label:a.templateName,value:a.id}},[t("el-tooltip",{staticClass:"item",attrs:{transition:"",effect:"dark",content:a.templateSample,placement:"right"}},[t("div",[e._v(e._s(a.templateName))])])],1)}),1)],1):e._e(),e._v(" "),2===e.addForm.ruleType||3===e.addForm.ruleType?t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"持续时间(分)：",prop:"duration",rules:2===e.addForm.ruleType||3===e.addForm.ruleType?e.$Global.FORM_RULE.required.concat(e.$Global.FORM_RULE.number).concat(e.$Global.FORM_RULE.positiveNumber):[]}},[t("el-input",{staticClass:"form__input_class",attrs:{placeholder:"请输入持续时间"},model:{value:e.addForm.duration,callback:function(a){e.$set(e.addForm,"duration",e._n(a))},expression:"addForm.duration"}})],1):e._e(),e._v(" "),2===e.addForm.ruleType||3===e.addForm.ruleType?t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"告警周期："}},[t("el-select",{staticClass:"form__input_class",attrs:{placeholder:"请选择告警周期"},model:{value:e.addForm.timePeriodId,callback:function(a){e.$set(e.addForm,"timePeriodId",a)},expression:"addForm.timePeriodId"}},[t("el-option",{attrs:{label:"全时段",value:"0"}}),e._v(" "),e._l(e.timePeriodList,function(e){return t("el-option",{key:e.id,attrs:{label:e.timeName,value:e.id}})})],2)],1):e._e(),e._v(" "),t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"告警备注：",prop:"remarks"}},[t("el-input",{staticClass:"form__input_class",attrs:{type:"textarea",rows:3,maxlength:200,placeholder:"最多不超过200字符"},model:{value:e.addForm.remarks,callback:function(a){e.$set(e.addForm,"remarks",a)},expression:"addForm.remarks"}})],1),e._v(" "),t("br"),e._v(" "),2===e.addForm.ruleType?t("el-form-item",{staticClass:"el-inputcss",attrs:{label:"规则明细:",prop:"ruleDetailList"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.ruleDetailAdd(e.addForm.ruleDetailList.length)}}},[e._v("添加")])],1):e._e(),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),2===e.addForm.ruleType?t("div",{staticClass:"dialog__list"},e._l(e.addForm.ruleDetailList,function(a,l){return t("div",{key:l,staticClass:"ruleSpecfic"},[0!=l?t("el-form-item",{attrs:{label:"连接符","label-width":"80px"}},[t("el-select",{staticClass:"form__input_small",model:{value:a.correlation,callback:function(t){e.$set(a,"correlation",t)},expression:"rule.correlation"}},[t("el-option",{attrs:{value:"and"}}),e._v(" "),t("el-option",{attrs:{value:"or"}})],1)],1):e._e(),e._v(" "),t("br"),e._v(" "),t("el-row",[t("el-col",{attrs:{span:18,offset:2}},[e._v(e._s(a.expression))]),e._v(" "),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editRuleLine(l)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:function(a){return e.delRuleLine(l)}}},[e._v("删除")])],1)],1)],1)}),0):e._e()],1):e._e(),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.addRuleSpecfic}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"详情",visible:e.ruleDetailModel,width:"620px"},on:{"update:visible":function(a){e.ruleDetailModel=a}}},[t("div",{staticClass:"detail"},[t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("规则名称：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmRuleName))])]),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("规则编号：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmRuleRuleCode))])]),e._v(" "),"DTU通信告警"!==e.ruleDetail.alarmRuleRuleType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("设备品类：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmEquipmentTypeList))])]):e._e(),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("告警级别：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmRuleLevel))])]),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("告警类型：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmRuleRuleType))])]),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("告警状态：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmRuleIsEnable?"启用":"禁用"))])]),e._v(" "),null===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("周期名称：")]),e._v(" "),t("div",{staticClass:"value"},[e._v("全时段")])]):e._e(),e._v(" "),null!==e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("周期名称：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.alarmRuleTimePeriodName))])]):e._e(),e._v(" "),null!==e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("周期类型：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(1==e.ruleDetail.alarmRuleTimePeriodTimeType?"每日":2==e.ruleDetail.alarmRuleTimePeriodTimeType?"每周":3==e.ruleDetail.alarmRuleTimePeriodTimeType?"每月":"具体时间"))])]):e._e(),e._v(" "),1===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.startTime))])]):e._e(),e._v(" "),1===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.endTime))])]):e._e(),e._v(" "),2===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始日期：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(1==e.ruleDetail.startDate?"周一":2==e.ruleDetail.startDate?"周二":3==e.ruleDetail.startDate?"周三":4==e.ruleDetail.startDate?"周四":5==e.ruleDetail.startDate?"周五":6==e.ruleDetail.startDate?"周六":"周日"))])]):e._e(),e._v(" "),2===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束日期：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(1==e.ruleDetail.endDate?"周一":2==e.ruleDetail.endDate?"周二":3==e.ruleDetail.endDate?"周三":4==e.ruleDetail.endDate?"周四":5==e.ruleDetail.endDate?"周五":6==e.ruleDetail.endDate?"周六":"周日"))])]):e._e(),e._v(" "),2===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.startTime))])]):e._e(),e._v(" "),2===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.endTime))])]):e._e(),e._v(" "),3===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始日期：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.startDate+"日"))])]):e._e(),e._v(" "),3===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束日期：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.endDate+"日"))])]):e._e(),e._v(" "),3===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.startTime))])]):e._e(),e._v(" "),3===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.endTime))])]):e._e(),e._v(" "),4===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始日期：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.startDate))])]):e._e(),e._v(" "),4===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束日期：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.endDate))])]):e._e(),e._v(" "),4===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("开始时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.startTime))])]):e._e(),e._v(" "),4===e.ruleDetail.alarmRuleTimePeriodTimeType?t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("结束时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.ruleDetail.endTime))])]):e._e(),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("创建时间：")]),e._v(" "),t("div",{staticClass:"value"},[e._v(e._s(e.$method.formatterTime(e.ruleDetail.alarmRuleGmtCreate)))])]),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"label"},[e._v("告警备注：")]),e._v(" "),t("textareaCheckRows",{attrs:{"row-class":"value","is-edit":!1,"text-value":e.ruleDetail.alarmRuleRemarks}})],1)]),e._v(" "),t("el-table",{directives:[{name:"show",rawName:"v-show",value:"阈值告警"==e.ruleDetail.alarmRuleRuleType,expression:"ruleDetail.alarmRuleRuleType == '阈值告警'"}],attrs:{data:e.ruleDetail.alarmRuleDetailList}},[t("el-table-column",{attrs:{prop:"correlation",label:"关联符"}}),e._v(" "),t("el-table-column",{attrs:{prop:"expression",label:"表达式"}})],1)],1)],1)},staticRenderFns:[]};var _=t("C7Lr")(m,v,!1,function(e){t("Q6tu")},"data-v-0863cf35",null);a.default=_.exports}});