webpackJsonp([44],{IOo6:function(t,e){},b46h:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={name:"projectList",components:{Pagination:r("NBFj").a},data:function(){return{searchForm:{projectName:""},queryParams:{projectName:"",orderColumn:"gmtModified",orderType:"DESC"},tableData:[],pagination:{currentPage:1,totalPage:0,pagesize:10},addDialog:{isShow:!1},addProjectForm:{projectName:"",projectRemark:""},rules:{projectName:[{required:!0,validator:function(t,e,r){if(""!=e){for(var o=/[\uFF00-\uFFFF]/g,a=e.split(""),s=a.length;s--;)if(o.test(a[s]))return void r(new Error("不能使用全角字符"));commonUtils.regExp.noSpecialChar(e)?r():r(new Error("不能包含特殊字符"))}else r(new Error("请输入项目名称"))},trigger:"blur"}],projectRemark:[]},editDialog:{isShow:!1},editProjectForm:{projectId:"",projectName:"",projectRemark:""},equCount:0,btnAdd:!1,btnEdit:!1,sessionName:"projectList",loading:!1,searchArr:[]}},mounted:function(){this.searchArr=[{id:"1",label:"项目名称",value:"projectName",type:"input",maxLen:"15"}],this.search()},created:function(){},methods:{sortChangeEvent:function(t){this.queryParams.orderColumn=t.order?t.prop:"gmtModified",this.queryParams.orderType=commonUtils.changeOrderType(t.order),this.pagination.currentPage=1,this.search()},clickInput:function(){this.$forceUpdate()},pageChange:function(t){this.pagination.currentPage=t.page_index,this.pagination.pagesize=t.page_limit,this.search()},search:function(){var t=this;this.loading=!0,this.$RequestUtil.post({url:"/device/project/getProjectListPage",params:{projectName:this.queryParams.projectName.trim(),page:this.pagination.currentPage,rows:this.pagination.pagesize,orderColumn:this.queryParams.orderColumn,orderType:this.queryParams.orderType},success:function(e){"success"==e.result&&(t.tableData=e.data,t.pagination.totalPage=e.totalPages,t.loading=!1)}}).catch(function(){t.loading=!1})},searchAll:function(t){this.pagination.currentPage=1,this.queryParams.projectName=t.projectName,this.search()},openAddForm:function(){this.addDialog.isShow=!0},resetAdd:function(){this.addDialog.isShow=!1;var t=this.$refs.addForm;null!=t&&t.resetFields()},insertProject:function(){var t=this;this.$refs.addForm.validate(function(e){e?(t.btnAdd=!0,t.$RequestUtil.post({url:"/device/project/addProject",type:"sync",params:{projectName:t.addProjectForm.projectName,projectDesc:t.addProjectForm.projectRemark},success:function(e){"success"==e.result&&(t.$message.success(e.msg),t.addDialog.isShow=!1,t.btnAdd=!1,t.search())}}).catch(function(){t.btnAdd=!1})):t.btnAdd=!1})},deleteProject:function(t){var e=this;0==this.equCount?this.$confirm("确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$RequestUtil.post({url:"/device/project/deleteProject",type:"sync",params:{id:t.id},success:function(t){"success"==t.result&&(e.$message.success(t.msg),e.search())}})}).catch(function(){}):this.$confirm("该项目下有"+this.equCount+"个设备, 请先解绑关系,再删除! ","提示",{showConfirmButton:!1,cancelButtonText:"确定",type:"warning"}).then(function(){})},getProjectEquNum:function(t){var e=this;this.equCount=0,this.$RequestUtil.post({url:"/device/project/getProjectEquNum",type:"sync",params:{projectId:t.id},success:function(r){"success"==r.result&&(e.equCount=r.data,e.deleteProject(t))}})},editProject:function(t){this.editProjectForm.projectId=t.id,this.editProjectForm.projectName=t.projectName,this.editProjectForm.projectRemark=t.projectDesc,this.editDialog.isShow=!0},updateProject:function(){var t=this;this.$refs.editForm.validate(function(e){e?(t.btnEdit=!0,t.$RequestUtil.post({url:"/device/project/updateProject",type:"sync",params:{id:t.editProjectForm.projectId,projectName:t.editProjectForm.projectName,projectDesc:t.editProjectForm.projectRemark},success:function(e){"success"==e.result&&(t.$message.success(e.msg),t.editDialog.isShow=!1,t.editProjectForm={},t.btnEdit=!1,t.search())}}).catch(function(){t.btnEdit=!1})):t.btnEdit=!1})},resetEdit:function(){this.editProjectForm={},this.editDialog.isShow=!1;var t=this.$refs.editForm;null!=t&&t.resetFields()}}},a={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"list-window"},[r("div",{staticClass:"searchbar"},[r("searchInput",{attrs:{"search-arr":t.searchArr},on:{clear:function(e){t.queryParams.projectName=""},search:function(e){t.searchAll(e)}}})],1),t._v(" "),t.$PERMISSION.PROJECT_WRITE?r("div",{staticClass:"operatebar"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.openAddForm}},[t._v("新增")])],1):t._e(),t._v(" "),r("div",{staticClass:"list-div"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark","default-sort":{prop:t.queryParams.orderColumn,order:"descending"}},on:{"sort-change":t.sortChangeEvent}},[r("el-table-column",{attrs:{prop:"projectName",label:"项目名称",sortable:"custom"}}),t._v(" "),r("el-table-column",{attrs:{prop:"projectDesc",label:"项目备注",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(t){return[r("div",[r("textareaCheckRows",{attrs:{inputType:"pre",textValue:t.row.projectDesc}})],1)]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"创建时间",sortable:"custom",prop:"gmtCreate",formatter:function(e){return t.$method.formatterTime(e.gmtCreate)}}}),t._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.$PERMISSION.PROJECT_WRITE?r("el-button",{attrs:{type:"text"},on:{click:function(){return t.editProject(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),t.$PERMISSION.PROJECT_WRITE?r("span",{staticClass:"vertical"}):t._e(),t._v(" "),t.$PERMISSION.PROJECT_WRITE?r("el-button",{attrs:{type:"text"},on:{click:function(){return t.getProjectEquNum(e.row)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),[r("Pagination",{attrs:{total:t.pagination.totalPage,"page-num":t.pagination.currentPage},on:{pageChange:t.pageChange}})]],2),t._v(" "),r("el-dialog",{attrs:{title:"新增项目",width:"23%",visible:t.addDialog.isShow,"close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.addDialog,"isShow",e)},close:t.resetAdd}},[r("el-form",{ref:"addForm",staticStyle:{width:"85%"},attrs:{model:t.addProjectForm,rules:t.rules,"label-width":"95px"}},[r("el-form-item",{staticClass:"el-inputcss",attrs:{label:"项目名称：",prop:"projectName"}},[r("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入项目名称"},model:{value:t.addProjectForm.projectName,callback:function(e){t.$set(t.addProjectForm,"projectName","string"==typeof e?e.trim():e)},expression:"addProjectForm.projectName"}})],1),t._v(" "),r("el-form-item",{staticClass:"el-inputcss",attrs:{label:"项目备注：",prop:"projectRemark"}},[r("el-input",{staticClass:"search-input-wat",attrs:{type:"textarea",rows:3,maxlength:"200",placeholder:"请输入项目名称"},model:{value:t.addProjectForm.projectRemark,callback:function(e){t.$set(t.addProjectForm,"projectRemark",e)},expression:"addProjectForm.projectRemark"}})],1)],1),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:t.btnAdd},on:{click:function(e){return t.insertProject()}}},[t._v("确定")])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"编辑项目",width:"23%",visible:t.editDialog.isShow,"close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.editDialog,"isShow",e)},close:t.resetEdit}},[r("el-form",{ref:"editForm",staticStyle:{width:"85%"},attrs:{model:t.editProjectForm,rules:t.rules,"label-width":"95px"}},[r("el-form-item",{staticClass:"el-inputcss",attrs:{label:"项目名称：",prop:"projectName"}},[r("el-input",{staticClass:"search-input-wat",attrs:{maxlength:"50",placeholder:"请输入项目名称"},on:{input:t.clickInput},model:{value:t.editProjectForm.projectName,callback:function(e){t.$set(t.editProjectForm,"projectName","string"==typeof e?e.trim():e)},expression:"editProjectForm.projectName"}})],1),t._v(" "),r("el-form-item",{staticClass:"el-inputcss",attrs:{label:"项目备注：",prop:"projectRemark"}},[r("el-input",{staticClass:"search-input-wat",attrs:{type:"textarea",rows:3,maxlength:"200",placeholder:"请输入项目名称"},on:{input:t.clickInput},model:{value:t.editProjectForm.projectRemark,callback:function(e){t.$set(t.editProjectForm,"projectRemark",e)},expression:"editProjectForm.projectRemark"}})],1)],1),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:t.btnEdit},on:{click:function(e){return t.updateProject()}}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var s=r("C7Lr")(o,a,!1,function(t){r("IOo6")},"data-v-5046732d",null);e.default=s.exports}});